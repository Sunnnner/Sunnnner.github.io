<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="学无止境,hugo,python,go,java,linux,mysql,redis,nginx,git,github,linux,mysql,redis,nginx,git,github,微服务,个人博客"
  />
  
    
      <title>PyMySQL 数据库操作指南 | 学无止境</title>
    
  
  <link rel="stylesheet" href="/css/reset.css"/>
  <link rel="stylesheet" href="/css/font.css"/>
  <link rel="stylesheet" href="/css/smigle.css"/>
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
</head>

  <body>
    <div id="root">
      <header>
  <div id="brand">
    <a class="icon-link" href="https://sunnnner.github.io/">
      <img
        class="icon"
        src="/images/brandIcon.svg"
      />
    </a>
    <div class="text">
      <a href="https://sunnnner.github.io/"><h1>学无止境</h1></a>
      <h3>少年辛苦终身事,莫向光阴惰寸功。——唐·杜荀鹤《题弟侄书堂》</h3>
    </div>
  </div>
  <nav>
    
      
        
        <a href="/posts/"><b>主页</b></a>
      
         | 
        <a href="/categories/"><b>类别</b></a>
      
         | 
        <a href="/tags/"><b>标签</b></a>
      
    
  </nav>
  <hr />
</header>

      <div id="content">
        
  <main>
    <article>
      <h1 class="title">PyMySQL 数据库操作指南</h1>
      
      <div class="post-meta">
  <strong>
    <span>Posted on</span>
    <time>12.07.2022</time>
    <span>in</span>
    
      <a href="/categories/python">python</a>
  </strong>
  <span> • 427 words</span>
  <span> • 3 minute read</span>
  
  
    <div>
      <span>Tags:</span>
      
        <a href="/tags/pymysql">pymysql</a>
    </div>
  
</div>

      <div class="content"><h2 id="1-基础连接">1. 基础连接</h2>
<h3 id="11-安装pymysql">1.1 安装PyMySQL</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>pip install pymysql
</span></span></code></pre></div><h3 id="12-建立数据库连接">1.2 建立数据库连接</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pymysql
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 创建连接</span>
</span></span><span style="display:flex;"><span>conn <span style="color:#f92672">=</span> pymysql<span style="color:#f92672">.</span>connect(
</span></span><span style="display:flex;"><span>    host<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;localhost&#39;</span>,      <span style="color:#75715e"># MySQL主机地址</span>
</span></span><span style="display:flex;"><span>    port<span style="color:#f92672">=</span><span style="color:#ae81ff">3306</span>,            <span style="color:#75715e"># 端口号（默认3306）</span>
</span></span><span style="display:flex;"><span>    user<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;root&#39;</span>,          <span style="color:#75715e"># 用户名</span>
</span></span><span style="display:flex;"><span>    password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;password&#39;</span>,   <span style="color:#75715e"># 密码</span>
</span></span><span style="display:flex;"><span>    database<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;mydb&#39;</span>,      <span style="color:#75715e"># 数据库名</span>
</span></span><span style="display:flex;"><span>    charset<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf8&#39;</span>        <span style="color:#75715e"># 字符编码</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 使用连接进行操作</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pass</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">finally</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 关闭连接</span>
</span></span><span style="display:flex;"><span>    conn<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><h2 id="2-connection对象">2. Connection对象</h2>
<h3 id="21-主要方法">2.1 主要方法</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 关闭连接</span>
</span></span><span style="display:flex;"><span>conn<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 提交事务</span>
</span></span><span style="display:flex;"><span>conn<span style="color:#f92672">.</span>commit()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 回滚事务</span>
</span></span><span style="display:flex;"><span>conn<span style="color:#f92672">.</span>rollback()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 创建游标</span>
</span></span><span style="display:flex;"><span>cursor <span style="color:#f92672">=</span> conn<span style="color:#f92672">.</span>cursor()
</span></span></code></pre></div><h3 id="22-使用上下文管理器">2.2 使用上下文管理器</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">with</span> pymysql<span style="color:#f92672">.</span>connect(
</span></span><span style="display:flex;"><span>    host<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;localhost&#39;</span>,
</span></span><span style="display:flex;"><span>    user<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;root&#39;</span>,
</span></span><span style="display:flex;"><span>    password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;password&#39;</span>,
</span></span><span style="display:flex;"><span>    database<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;mydb&#39;</span>,
</span></span><span style="display:flex;"><span>    charset<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf8&#39;</span>
</span></span><span style="display:flex;"><span>) <span style="color:#66d9ef">as</span> conn:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> conn<span style="color:#f92672">.</span>cursor() <span style="color:#66d9ef">as</span> cursor:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 执行操作</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">pass</span>
</span></span></code></pre></div><h2 id="3-cursor对象">3. Cursor对象</h2>
<h3 id="31-基本操作">3.1 基本操作</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 创建游标</span>
</span></span><span style="display:flex;"><span>cursor <span style="color:#f92672">=</span> conn<span style="color:#f92672">.</span>cursor()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 执行SQL语句</span>
</span></span><span style="display:flex;"><span>    affected_rows <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#39;SELECT * FROM users&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 获取单行数据</span>
</span></span><span style="display:flex;"><span>    row <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>fetchone()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 获取所有数据</span>
</span></span><span style="display:flex;"><span>    rows <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>fetchall()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">finally</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 关闭游标</span>
</span></span><span style="display:flex;"><span>    cursor<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><h3 id="32-游标方法详解">3.2 游标方法详解</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 执行SQL语句</span>
</span></span><span style="display:flex;"><span>cursor<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#39;SELECT * FROM users WHERE age &gt; </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span>, (<span style="color:#ae81ff">18</span>,))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 执行多条SQL语句</span>
</span></span><span style="display:flex;"><span>cursor<span style="color:#f92672">.</span>executemany(
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;INSERT INTO users (name, age) VALUES (</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">, </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">)&#39;</span>,
</span></span><span style="display:flex;"><span>    [(<span style="color:#e6db74">&#39;Alice&#39;</span>, <span style="color:#ae81ff">20</span>), (<span style="color:#e6db74">&#39;Bob&#39;</span>, <span style="color:#ae81ff">22</span>)]
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 获取下一行数据</span>
</span></span><span style="display:flex;"><span>row <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>fetchone()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 获取指定数量的行</span>
</span></span><span style="display:flex;"><span>rows <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>fetchmany(size<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 获取所有行</span>
</span></span><span style="display:flex;"><span>all_rows <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>fetchall()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 移动游标位置</span>
</span></span><span style="display:flex;"><span>cursor<span style="color:#f92672">.</span>scroll(<span style="color:#ae81ff">2</span>, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;relative&#39;</span>)    <span style="color:#75715e"># 相对当前位置移动</span>
</span></span><span style="display:flex;"><span>cursor<span style="color:#f92672">.</span>scroll(<span style="color:#ae81ff">0</span>, mode<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;absolute&#39;</span>)    <span style="color:#75715e"># 移动到开始位置</span>
</span></span></code></pre></div><h3 id="33-游标属性">3.3 游标属性</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 获取影响的行数</span>
</span></span><span style="display:flex;"><span>affected_rows <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>rowcount
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 获取当前连接对象</span>
</span></span><span style="display:flex;"><span>current_conn <span style="color:#f92672">=</span> cursor<span style="color:#f92672">.</span>connection
</span></span></code></pre></div><h2 id="4-实践示例">4. 实践示例</h2>
<h3 id="41-基本crud操作">4.1 基本CRUD操作</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> pymysql
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pymysql.cursors <span style="color:#f92672">import</span> DictCursor
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_database_connection</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> pymysql<span style="color:#f92672">.</span>connect(
</span></span><span style="display:flex;"><span>        host<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;localhost&#39;</span>,
</span></span><span style="display:flex;"><span>        user<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;root&#39;</span>,
</span></span><span style="display:flex;"><span>        password<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;password&#39;</span>,
</span></span><span style="display:flex;"><span>        database<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;mydb&#39;</span>,
</span></span><span style="display:flex;"><span>        charset<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;utf8&#39;</span>,
</span></span><span style="display:flex;"><span>        cursorclass<span style="color:#f92672">=</span>DictCursor  <span style="color:#75715e"># 返回字典格式的结果</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 查询操作</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">select_users</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> get_database_connection() <span style="color:#66d9ef">as</span> conn:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> conn<span style="color:#f92672">.</span>cursor() <span style="color:#66d9ef">as</span> cursor:
</span></span><span style="display:flex;"><span>            sql <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT * FROM users WHERE age &gt; </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            cursor<span style="color:#f92672">.</span>execute(sql, (<span style="color:#ae81ff">18</span>,))
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> cursor<span style="color:#f92672">.</span>fetchall()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 插入操作</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">insert_user</span>(name, age):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> get_database_connection() <span style="color:#66d9ef">as</span> conn:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> conn<span style="color:#f92672">.</span>cursor() <span style="color:#66d9ef">as</span> cursor:
</span></span><span style="display:flex;"><span>            sql <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;INSERT INTO users (name, age) VALUES (</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">, </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">)&#34;</span>
</span></span><span style="display:flex;"><span>            cursor<span style="color:#f92672">.</span>execute(sql, (name, age))
</span></span><span style="display:flex;"><span>        conn<span style="color:#f92672">.</span>commit()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 更新操作</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">update_user</span>(user_id, new_age):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> get_database_connection() <span style="color:#66d9ef">as</span> conn:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> conn<span style="color:#f92672">.</span>cursor() <span style="color:#66d9ef">as</span> cursor:
</span></span><span style="display:flex;"><span>            sql <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;UPDATE users SET age = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> WHERE id = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            cursor<span style="color:#f92672">.</span>execute(sql, (new_age, user_id))
</span></span><span style="display:flex;"><span>        conn<span style="color:#f92672">.</span>commit()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 删除操作</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">delete_user</span>(user_id):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> get_database_connection() <span style="color:#66d9ef">as</span> conn:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> conn<span style="color:#f92672">.</span>cursor() <span style="color:#66d9ef">as</span> cursor:
</span></span><span style="display:flex;"><span>            sql <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;DELETE FROM users WHERE id = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            cursor<span style="color:#f92672">.</span>execute(sql, (user_id,))
</span></span><span style="display:flex;"><span>        conn<span style="color:#f92672">.</span>commit()
</span></span></code></pre></div><h3 id="42-事务处理">4.2 事务处理</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">transfer_money</span>(from_id, to_id, amount):
</span></span><span style="display:flex;"><span>    conn <span style="color:#f92672">=</span> get_database_connection()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> conn<span style="color:#f92672">.</span>cursor() <span style="color:#66d9ef">as</span> cursor:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 检查余额</span>
</span></span><span style="display:flex;"><span>            cursor<span style="color:#f92672">.</span>execute(
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;SELECT balance FROM accounts WHERE id = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                (from_id,)
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> cursor<span style="color:#f92672">.</span>fetchone()[<span style="color:#e6db74">&#39;balance&#39;</span>] <span style="color:#f92672">&lt;</span> amount:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74">&#34;余额不足&#34;</span>)
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 扣款</span>
</span></span><span style="display:flex;"><span>            cursor<span style="color:#f92672">.</span>execute(
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;UPDATE accounts SET balance = balance - </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> WHERE id = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                (amount, from_id)
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># 入账</span>
</span></span><span style="display:flex;"><span>            cursor<span style="color:#f92672">.</span>execute(
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;UPDATE accounts SET balance = balance + </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> WHERE id = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>,
</span></span><span style="display:flex;"><span>                (amount, to_id)
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 提交事务</span>
</span></span><span style="display:flex;"><span>        conn<span style="color:#f92672">.</span>commit()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> e:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 发生错误时回滚</span>
</span></span><span style="display:flex;"><span>        conn<span style="color:#f92672">.</span>rollback()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> e
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">finally</span>:
</span></span><span style="display:flex;"><span>        conn<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><h2 id="5-安全性考虑">5. 安全性考虑</h2>
<h3 id="51-防止sql注入">5.1 防止SQL注入</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># 错误示例 - 容易遭受SQL注入</span>
</span></span><span style="display:flex;"><span>cursor<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;SELECT * FROM users WHERE name = &#39;</span><span style="color:#e6db74">{</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 正确示例 - 使用参数化查询</span>
</span></span><span style="display:flex;"><span>cursor<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;SELECT * FROM users WHERE name = </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>, (name,))
</span></span></code></pre></div><h3 id="52-最佳实践">5.2 最佳实践</h3>
<ol>
<li>始终使用参数化查询</li>
<li>妥善保管数据库凭证</li>
<li>使用最小权限原则</li>
<li>及时关闭连接和游标</li>
<li>正确处理异常</li>
<li>使用连接池管理连接</li>
</ol></div>
    </article>
  </main>

      </div>
      <footer>
  <hr />
  
  <p class="copyright">
    Copyright © 2025
    <a href="https://sunnnner.github.io/"><strong>Blog Author</strong></a>.
    This work is licensed under the
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> license.
  </p>
  <p class="builtWith">
    备案号:
    <a href="https://beian.miit.gov.cn/" target="_blank">京ICP备2022023134号-1</a>
  </p>
</footer>

    </div>
  </body>
</html>
