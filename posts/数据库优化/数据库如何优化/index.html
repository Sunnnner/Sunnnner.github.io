<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content="学无止境,hugo,python,go,java,linux,mysql,redis,nginx,git,github,linux,mysql,redis,nginx,git,github,微服务,个人博客"
  />
  
    
      <title>数据库如何优化 | 学无止境</title>
    
  
  <link rel="stylesheet" href="/css/reset.css"/>
  <link rel="stylesheet" href="/css/font.css"/>
  <link rel="stylesheet" href="/css/smigle.css"/>
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
</head>

  <body>
    <div id="root">
      <header>
  <div id="brand">
    <a class="icon-link" href="https://sunnnner.github.io/">
      <img
        class="icon"
        src="/images/brandIcon.svg"
      />
    </a>
    <div class="text">
      <a href="https://sunnnner.github.io/"><h1>学无止境</h1></a>
      <h3>少年辛苦终身事,莫向光阴惰寸功。——唐·杜荀鹤《题弟侄书堂》</h3>
    </div>
  </div>
  <nav>
    
      
        
        <a href="/posts/"><b>主页</b></a>
      
         | 
        <a href="/categories/"><b>类别</b></a>
      
         | 
        <a href="/tags/"><b>标签</b></a>
      
    
  </nav>
  <hr />
</header>

      <div id="content">
        
  <main>
    <article>
      <h1 class="title">数据库如何优化</h1>
      
      <div class="post-meta">
  <strong>
    <span>Posted on</span>
    <time>04.02.2019</time>
    <span>in</span>
    
      <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93">数据库</a>
  </strong>
  <span> • 335 words</span>
  <span> • 2 minute read</span>
  
  
    <div>
      <span>Tags:</span>
      
        <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93">数据库</a>
    </div>
  
</div>

      <div class="content"><h2 id="mysql优化详解">MySQL优化详解</h2>
<h3 id="sql语句优化">SQL语句优化</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span><span style="color:#66d9ef">1.</span> SELECT语句优化
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 避免SELECT *，只查询必要字段
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 使用EXPLAIN分析SQL执行计划
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 合理使用索引
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 优化子查询，尽可能使用JOIN
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 使用LIMIT限制结果集大小
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">2.</span> ORDER BY优化
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 索引优化：
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">*</span> 为ORDER BY字段创建索引
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">*</span> 使用覆盖索引
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">*</span> 确保索引字段顺序与ORDER BY一致
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> WHERE + ORDER BY组合优化：
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">*</span> 先进行WHERE过滤，减少排序数据量
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">*</span> 使用索引进行排序
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">*</span> 避免filesort
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">3.</span> INSERT优化
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 批量插入替代单条插入
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 临时禁用索引
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 关闭唯一性检查
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 使用LOAD DATA INFILE批量导入
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 预处理语句批处理
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">4.</span> UPDATE和DELETE优化
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 根据索引字段更新
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 批量更新替代循环单条更新
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 使用TRUNCATE替代DELETE FROM
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 合理使用事务
</span></span></code></pre></div><h3 id="数据库结构优化">数据库结构优化</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span><span style="color:#66d9ef">1.</span> 表结构优化
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 选择合适的数据类型
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 使用UNSIGNED存储非负数
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 使用TIMESTAMP替代DATETIME
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 合理设计字段长度
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 适当冗余字段避免JOIN
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">2.</span> 索引优化
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 主键使用自增ID
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 常用查询字段建立索引
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 避免索引过多
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 定期维护索引统计信息
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 删除无用索引
</span></span></code></pre></div><h2 id="django性能优化">Django性能优化</h2>
<h3 id="查询优化">查询优化</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span><span style="color:#66d9ef">1.</span> QuerySet优化
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 利用查询集缓存
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 使用select_related()和prefetch_related()减少查询
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 使用值查询(values()和values_list())
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 使用批量操作(bulk_create, bulk_update)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 适当使用迭代器
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">2.</span> 数据库操作优化
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 使用F()和Q()对象优化查询
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 合理使用filter和exclude
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 使用exists()替代count()和len()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 使用update()替代save()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 适当使用原生SQL
</span></span></code></pre></div><h3 id="缓存优化">缓存优化</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span><span style="color:#66d9ef">1.</span> Redis缓存策略
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 缓存常用数据
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 使用缓存版本控制
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 设置合理的过期时间
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 实现缓存预热
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 防止缓存穿透和雪崩
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">2.</span> 其他缓存优化
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 使用本地内存缓存
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 模板片段缓存
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 会话缓存
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 静态文件缓存
</span></span></code></pre></div><h2 id="高并发处理">高并发处理</h2>
<h3 id="锁机制">锁机制</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span><span style="color:#66d9ef">1.</span> 悲观锁
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 适用于并发量大的场景
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 实现方式：
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">*</span> SELECT ... FOR UPDATE
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">*</span> 表级锁
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">*</span> 行级锁
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">2.</span> 乐观锁
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 适用于并发冲突少的场景
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 实现方式：
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">*</span> 版本号机制
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">*</span> CAS算法
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">*</span> 时间戳
</span></span></code></pre></div><h3 id="秒杀系统设计">秒杀系统设计</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span><span style="color:#66d9ef">1.</span> 架构设计
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 前端限流
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> Redis缓存
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 消息队列
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 异步处理
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 分布式锁
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">2.</span> 优化策略
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 系统预热
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 动静分离
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 库存预扣减
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 防刷限制
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 降级策略
</span></span></code></pre></div><h2 id="redis使用场景">Redis使用场景</h2>
<h3 id="数据类型应用">数据类型应用</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span><span style="color:#66d9ef">1.</span> String
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 缓存对象
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 计数器
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 分布式锁
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 共享session
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">2.</span> Hash
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 存储对象
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 购物车
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 用户信息
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">3.</span> List
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 消息队列
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 最新N条数据
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 任务队列
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">4.</span> Set
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 去重
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 好友关系
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 黑名单
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">5.</span> Sorted Set
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 排行榜
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 权重排名
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 延时队列
</span></span></code></pre></div><h3 id="高级特性应用">高级特性应用</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span><span style="color:#66d9ef">1.</span> 事务
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> MULTI/EXEC/WATCH
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 原子性操作
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 乐观锁实现
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">2.</span> 发布订阅
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 消息通知
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 实时聊天
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 任务派发
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">3.</span> 持久化
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> RDB快照
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> AOF日志
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 混合持久化
</span></span></code></pre></div><h2 id="mysql存储引擎">MySQL存储引擎</h2>
<h3 id="innodb">InnoDB</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span><span style="color:#66d9ef">1.</span> 特性
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 支持事务(ACID)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 行级锁
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 外键约束
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> MVCC多版本并发控制
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 聚集索引
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">2.</span> 适用场景
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 需要事务支持
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 高并发系统
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 数据一致性要求高
</span></span></code></pre></div><h3 id="myisam">MyISAM</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span><span style="color:#66d9ef">1.</span> 特性
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 表级锁
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 全文索引支持
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 压缩表支持
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 较高的查询性能
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">2.</span> 适用场景
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 读密集型应用
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 无事务需求
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 低并发系统
</span></span></code></pre></div><h2 id="python2和3主要区别">Python2和3主要区别</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-markdown" data-lang="markdown"><span style="display:flex;"><span><span style="color:#66d9ef">1.</span> 语法变化
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> print函数化
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 字符串默认Unicode
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 除法运算符改变
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 异常语法改变
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">2.</span> 标准库变化
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> urllib重组
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> queue替代Queue
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> configparser替代ConfigParser
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> pickle优化
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">3.</span> 内置功能
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> range替代xrange
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> map/filter返回迭代器
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 字典视图对象
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">-</span> 移除cmp函数
</span></span></code></pre></div></div>
    </article>
  </main>

      </div>
      <footer>
  <hr />
  
  <p class="copyright">
    Copyright © 2025
    <a href="https://sunnnner.github.io/"><strong>Blog Author</strong></a>.
    This work is licensed under the
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> license.
  </p>
  <p class="builtWith">
    备案号:
    <a href="https://beian.miit.gov.cn/" target="_blank">京ICP备2022023134号-1</a>
  </p>
</footer>

    </div>
  </body>
</html>
