<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>django on whiteKBlog</title><link>https://sunnnner.github.io/tags/django/</link><description>Recent content in django on whiteKBlog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Fri, 11 Oct 2019 15:28:02 +0800</lastBuildDate><atom:link href="https://sunnnner.github.io/tags/django/index.xml" rel="self" type="application/rss+xml"/><item><title>Djangoæ–‡ä»¶å‹ç¼©</title><link>https://sunnnner.github.io/django%E6%96%87%E4%BB%B6%E5%8E%8B%E7%BC%A9/</link><pubDate>Fri, 11 Oct 2019 15:28:02 +0800</pubDate><guid>https://sunnnner.github.io/django%E6%96%87%E4%BB%B6%E5%8E%8B%E7%BC%A9/</guid><description>&lt;p>ç±»å‹å’Œæ–¹æ³•æ•°æ®å‹ç¼©åˆ†ä¸ºä¸¤ç§ç±»å‹ã€‚&lt;/p>
&lt;p>æœ‰æŸï¼šåœ¨è¿™ç§ç±»å‹çš„å‹ç¼©ä¸­ï¼Œå‹ç¼©æ—¶ä¼šé™ä½æ•°æ®è´¨é‡ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ä¸ºå›¾åƒå’Œè§†é¢‘ï¼‰ã€‚è¿™è¢«å¹¿æ³›ç”¨äºå‹ç¼©å¤šåª’ä½“ã€‚&lt;/p>
&lt;p>æ— æŸï¼šåœ¨è¿™ç§ç±»å‹çš„å‹ç¼©ä¸­ï¼Œæ•°æ®è´¨é‡ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ä¸ºå›¾åƒï¼‰ä¸ä¼šä¸¢å¤±ã€‚å®ƒå¹¿æ³›ç”¨äºå‹ç¼©æ— æ³•æ‰¿å—æ•°æ®ä¸¢å¤±çš„æ•æ„Ÿæ•°æ®ã€‚&lt;/p>
&lt;p>å®‰è£…ä¸é…ç½®&lt;/p>
&lt;p>å®‰è£…pythonå›¾åƒå¤„ç†åº“ Pillow&lt;/p>
&lt;p>`pip install Pillow``&lt;/p>
&lt;p>æˆ‘ä»¬å°†å»ºç«‹ä¸€ä¸ªç®€å•çš„é¡¹ç›®æ¥æ¼”ç¤ºå›¾åƒä¸Šä¼ ä»¥åŠä¸Šä¼ ä¹‹å‰å’Œä¹‹åçš„æ–‡ä»¶å¤§å°ã€‚æ‚¨ä¹Ÿå¯ä»¥å‚è€ƒDjango-docsæˆ–åœ¨æ­¤å¤„ä¸‹è½½å®Œæ•´çš„æºä»£ç ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">py&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pil&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Image&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">io&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">BytesIO&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.core.files.uploadedfile&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">InMemoryUploadedFile&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">File&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Model&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ForeignKey&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">KwsUser&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ‰€å±ç”¨æˆ·&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help_text&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ‰€å±ç”¨æˆ·&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">FileField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">upload_to&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">get_file_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help_text&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ä¸Šä¼ çš„æ–‡ä»¶&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">big_file&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">FileField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">upload_to&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">get_pro_file_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help_text&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ä¸Šä¼ çš„åŸå›¾&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">null&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">blank&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">upload_time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DateTimeField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">auto_now_add&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ä¸Šä¼ æ—¶é—´&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">null&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">blank&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CharField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_length&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ–‡ä»¶å&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help_text&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ–‡ä»¶å&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CharField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_length&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">choices&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">FILETYPE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ–‡ä»¶ç±»å‹&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">AutoField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">primary_key&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># å‰ç«¯æ•°æ®ã€‚ã€‚ã€‚ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">minio_url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">TextField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ–‡ä»¶é“¾æ¥&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">blank&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">big_file_minio_url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">TextField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å¤§å›¾æ–‡ä»¶é“¾æ¥&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">blank&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">save&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="o">**&lt;/span> &lt;span class="n">kwargs&lt;/span>&lt;span class="err">ï¼‰ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">uid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">compressImage&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">super&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="n">File&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="err">ï¼‰&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">save&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="o">**&lt;/span> &lt;span class="n">kwargs&lt;/span>&lt;span class="err">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">compressImage&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="err">ï¼‰ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">imageTemproary&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Image&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">open&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="err">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">outputIoStream&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">BytesIO&lt;/span>&lt;span class="err">ï¼ˆï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">imageTemproaryResized&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">imageTemproary&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">resize&lt;/span>&lt;span class="err">ï¼ˆï¼ˆ&lt;/span>&lt;span class="mi">1020&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">573&lt;/span>&lt;span class="err">ï¼‰ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">imageTemproary&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">save&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="n">outputIoStream&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="nb">format&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;JPEG&amp;#39;&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="n">quality&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">60&lt;/span>&lt;span class="err">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">outputIoStream&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">UploadedImage&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">InMemoryUploadedFile&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="n">outputIoStream&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="s1">&amp;#39;ImageField&amp;#39;&lt;/span>&lt;span class="err">ï¼Œâ€œï¼…&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">jpg&lt;/span>&lt;span class="err">â€&lt;/span> &lt;span class="err">ï¼…&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="s1">&amp;#39;.&amp;#39;&lt;/span>&lt;span class="err">ï¼‰&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="s1">&amp;#39;image / jpeg&amp;#39;&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="n">sys&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">getsizeof&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="n">outputIoStream&lt;/span>&lt;span class="err">ï¼‰ï¼Œ&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="err">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">uploadImage&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨ä¸Šé¢çš„models.pyæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å£°æ˜åç§°çš„å®ç”¨ç¨‹åºæ–¹æ³•compressImageå¹¶å°†å…¶uploadedImageä½œä¸ºå‚æ•°ä¼ é€’ã€‚saveåˆ›å»ºUploadå¯¹è±¡æ—¶åœ¨æ¨¡å—ä¸­è°ƒç”¨æ­¤æ–¹æ³•ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä½¿ç”¨pythonå›¾åƒå¤„ç†åº“Pillowï¼ˆPILï¼‰æ¥å¤„ç†å›¾åƒå¤„ç†ã€‚æˆ‘ä»¬æ‰“å¼€ä¸Šè½½çš„å›¾åƒå¹¶å°†å…¶å­˜å‚¨åœ¨ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ä¸­ï¼ŒimageTemproaryå¹¶åˆå§‹åŒ–BytesIOæµä»¥å¤„ç†å°†æ›´æ”¹å†™å…¥å›¾åƒçš„è¿‡ç¨‹ã€‚æˆ‘ä»¬ä½¿ç”¨æ­¤resize()æ–¹æ³•å°†ä¸Šä¼ çš„å›¾åƒè°ƒæ•´ä¸ºç‰¹å®šå¤§å°ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹å°äºåŸå§‹å¤§å°ï¼‰ï¼Œå¹¶ä½¿ç”¨seek() methodå°†è¾“å‡ºæµæŒ‡é’ˆæµé‡ç½®ä¸ºåˆå§‹ä½ç½®ã€‚æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ä½¿ç”¨Djangoçš„InMemoryUploadedFileï¼Œä»¥è¦†ç›–ç°æœ‰çš„æœªå‹ç¼©çš„å›¾åƒã€‚
æ‚¨å¯ä»¥ç»§ç»­è‡ªå®šä¹‰æ–¹æ³•ï¼Œä»¥æ ¹æ®éœ€è¦æ›´æ”¹å›¾åƒç±»å‹ï¼Œå°ºå¯¸å’Œè´¨é‡çº§åˆ«ã€‚&lt;/p></description></item><item><title>Djangoæ–‡ä»¶å‹ç¼©</title><link>https://sunnnner.github.io/p/django%E6%96%87%E4%BB%B6%E5%8E%8B%E7%BC%A9/</link><pubDate>Fri, 11 Oct 2019 15:28:02 +0800</pubDate><guid>https://sunnnner.github.io/p/django%E6%96%87%E4%BB%B6%E5%8E%8B%E7%BC%A9/</guid><description>&lt;p>ç±»å‹å’Œæ–¹æ³•æ•°æ®å‹ç¼©åˆ†ä¸ºä¸¤ç§ç±»å‹ã€‚&lt;/p>
&lt;p>æœ‰æŸï¼šåœ¨è¿™ç§ç±»å‹çš„å‹ç¼©ä¸­ï¼Œå‹ç¼©æ—¶ä¼šé™ä½æ•°æ®è´¨é‡ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ä¸ºå›¾åƒå’Œè§†é¢‘ï¼‰ã€‚è¿™è¢«å¹¿æ³›ç”¨äºå‹ç¼©å¤šåª’ä½“ã€‚&lt;/p>
&lt;p>æ— æŸï¼šåœ¨è¿™ç§ç±»å‹çš„å‹ç¼©ä¸­ï¼Œæ•°æ®è´¨é‡ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ä¸ºå›¾åƒï¼‰ä¸ä¼šä¸¢å¤±ã€‚å®ƒå¹¿æ³›ç”¨äºå‹ç¼©æ— æ³•æ‰¿å—æ•°æ®ä¸¢å¤±çš„æ•æ„Ÿæ•°æ®ã€‚&lt;/p>
&lt;p>å®‰è£…ä¸é…ç½®&lt;/p>
&lt;p>å®‰è£…pythonå›¾åƒå¤„ç†åº“ Pillow&lt;/p>
&lt;p>`pip install Pillow``&lt;/p>
&lt;p>æˆ‘ä»¬å°†å»ºç«‹ä¸€ä¸ªç®€å•çš„é¡¹ç›®æ¥æ¼”ç¤ºå›¾åƒä¸Šä¼ ä»¥åŠä¸Šä¼ ä¹‹å‰å’Œä¹‹åçš„æ–‡ä»¶å¤§å°ã€‚æ‚¨ä¹Ÿå¯ä»¥å‚è€ƒDjango-docsæˆ–åœ¨æ­¤å¤„ä¸‹è½½å®Œæ•´çš„æºä»£ç ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">py&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">pil&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Image&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">io&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">BytesIO&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.core.files.uploadedfile&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">InMemoryUploadedFile&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">File&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Model&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ForeignKey&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">KwsUser&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ‰€å±ç”¨æˆ·&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help_text&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ‰€å±ç”¨æˆ·&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">FileField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">upload_to&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">get_file_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help_text&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ä¸Šä¼ çš„æ–‡ä»¶&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">big_file&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">FileField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">upload_to&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">get_pro_file_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help_text&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ä¸Šä¼ çš„åŸå›¾&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">null&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">blank&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">upload_time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DateTimeField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">auto_now_add&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ä¸Šä¼ æ—¶é—´&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">null&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">blank&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CharField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_length&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ–‡ä»¶å&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">help_text&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ–‡ä»¶å&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CharField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_length&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">choices&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">FILETYPE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ–‡ä»¶ç±»å‹&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">uid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">AutoField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">primary_key&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># å‰ç«¯æ•°æ®ã€‚ã€‚ã€‚ã€‚&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">minio_url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">TextField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ–‡ä»¶é“¾æ¥&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">blank&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">big_file_minio_url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">TextField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å¤§å›¾æ–‡ä»¶é“¾æ¥&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">blank&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">save&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="o">**&lt;/span> &lt;span class="n">kwargs&lt;/span>&lt;span class="err">ï¼‰ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">uid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">compressImage&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">super&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="n">File&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="err">ï¼‰&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">save&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="o">**&lt;/span> &lt;span class="n">kwargs&lt;/span>&lt;span class="err">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">compressImage&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="err">ï¼‰ï¼š&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">imageTemproary&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Image&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">open&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="err">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">outputIoStream&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">BytesIO&lt;/span>&lt;span class="err">ï¼ˆï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">imageTemproaryResized&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">imageTemproary&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">resize&lt;/span>&lt;span class="err">ï¼ˆï¼ˆ&lt;/span>&lt;span class="mi">1020&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">573&lt;/span>&lt;span class="err">ï¼‰ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">imageTemproary&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">save&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="n">outputIoStream&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="nb">format&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;JPEG&amp;#39;&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="n">quality&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">60&lt;/span>&lt;span class="err">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">outputIoStream&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="err">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">UploadedImage&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">InMemoryUploadedFile&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="n">outputIoStream&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="s1">&amp;#39;ImageField&amp;#39;&lt;/span>&lt;span class="err">ï¼Œâ€œï¼…&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">jpg&lt;/span>&lt;span class="err">â€&lt;/span> &lt;span class="err">ï¼…&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="s1">&amp;#39;.&amp;#39;&lt;/span>&lt;span class="err">ï¼‰&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="s1">&amp;#39;image / jpeg&amp;#39;&lt;/span>&lt;span class="err">ï¼Œ&lt;/span>&lt;span class="n">sys&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">getsizeof&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="n">outputIoStream&lt;/span>&lt;span class="err">ï¼‰ï¼Œ&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="err">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">uploadImage&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>åœ¨ä¸Šé¢çš„models.pyæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å£°æ˜åç§°çš„å®ç”¨ç¨‹åºæ–¹æ³•compressImageå¹¶å°†å…¶uploadedImageä½œä¸ºå‚æ•°ä¼ é€’ã€‚saveåˆ›å»ºUploadå¯¹è±¡æ—¶åœ¨æ¨¡å—ä¸­è°ƒç”¨æ­¤æ–¹æ³•ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä½¿ç”¨pythonå›¾åƒå¤„ç†åº“Pillowï¼ˆPILï¼‰æ¥å¤„ç†å›¾åƒå¤„ç†ã€‚æˆ‘ä»¬æ‰“å¼€ä¸Šè½½çš„å›¾åƒå¹¶å°†å…¶å­˜å‚¨åœ¨ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ä¸­ï¼ŒimageTemproaryå¹¶åˆå§‹åŒ–BytesIOæµä»¥å¤„ç†å°†æ›´æ”¹å†™å…¥å›¾åƒçš„è¿‡ç¨‹ã€‚æˆ‘ä»¬ä½¿ç”¨æ­¤resize()æ–¹æ³•å°†ä¸Šä¼ çš„å›¾åƒè°ƒæ•´ä¸ºç‰¹å®šå¤§å°ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹å°äºåŸå§‹å¤§å°ï¼‰ï¼Œå¹¶ä½¿ç”¨seek() methodå°†è¾“å‡ºæµæŒ‡é’ˆæµé‡ç½®ä¸ºåˆå§‹ä½ç½®ã€‚æˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ä½¿ç”¨Djangoçš„InMemoryUploadedFileï¼Œä»¥è¦†ç›–ç°æœ‰çš„æœªå‹ç¼©çš„å›¾åƒã€‚
æ‚¨å¯ä»¥ç»§ç»­è‡ªå®šä¹‰æ–¹æ³•ï¼Œä»¥æ ¹æ®éœ€è¦æ›´æ”¹å›¾åƒç±»å‹ï¼Œå°ºå¯¸å’Œè´¨é‡çº§åˆ«ã€‚&lt;/p></description></item><item><title>é™æ€æ–‡ä»¶çš„å«ä¹‰ä»¥åŠé…ç½®</title><link>https://sunnnner.github.io/%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E7%9A%84%E5%90%AB%E4%B9%89%E4%BB%A5%E5%8F%8A%E9%85%8D%E7%BD%AE/</link><pubDate>Thu, 10 Oct 2019 15:27:14 +0800</pubDate><guid>https://sunnnner.github.io/%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E7%9A%84%E5%90%AB%E4%B9%89%E4%BB%A5%E5%8F%8A%E9%85%8D%E7%BD%AE/</guid><description>&lt;h1 id="django-staticfile-çš„é…ç½®">Django staticfile çš„é…ç½®&lt;/h1>
&lt;p>èµ·åˆä»¥ä¸ºæ˜¯æˆ‘dockerfileå†™é”™äº†çš„é—®é¢˜ï¼Œçš„ç¡®ä¸æ˜¯dockerfileçš„é—®é¢˜æ˜¯æˆ‘æ²¡æœ‰ç†è§£static_urlä¸static_rootçš„å«ä¹‰&lt;/p>
&lt;p>ğŸ‘ å¦‚æœä¸æ˜¯å‰åç«¯åˆ†ç¦»é¡¹ç›®åœ¨æ¯ä¸ªAPPä¸‹éƒ½åº”è¯¥æœ‰staticä¸templatesæ–‡ä»¶å¤¹å­˜åœ¨ä¸ç„¶djangoæ”¶é›†é™æ€æ–‡ä»¶æ”¶é›†ä¸åˆ°&lt;/p>
&lt;p>STATIC_URLä¸ºDjangoè¿”å›ç»™å‰ç«¯çš„è·¯å¾„å³é¡¹ç›®å†…éƒ¨çš„staticæ–‡ä»¶å¤¹&lt;/p>
&lt;p>STATIC_ROOTä¸ºé™æ€æ–‡ä»¶æ”¶é›†çš„è·¯å¾„å³ python3 manage.py collectstatic çš„æ–‡ä»¶å¤¹&lt;/p>
&lt;p>STATIC_ROOT = os.path.join(BASE_DIR, &amp;lsquo;static&amp;rsquo;) æ„æ€æ˜¯æŠŠæ–‡ä»¶æ”¶é›†åˆ°é¡¹ç›®ä¸‹staticæ–‡ä»¶å¤¹ä¸‹çš„staticæ–‡ä»¶å¤¹ä¸­&lt;/p>
&lt;p>æ‰€ä»¥æ–¹ä¾¿èµ·è§æˆ‘æŠŠ STATIC_ROOT = os.path.join(BASE_DIR, &amp;lsquo;&amp;rsquo;)è®¾ç½®ä¸ºäº†æ”¶é›†åœ¨é¡¹ç›®ä¸‹staticæ–‡ä»¶å¤¹ä¸‹&lt;/p>
&lt;p>å¤§å‘ä¸å°‘å°å‘ä¸æ–­ï¼Œå­¦æ— æ­¢å¢ƒå•Š&lt;/p></description></item><item><title>é™æ€æ–‡ä»¶çš„å«ä¹‰ä»¥åŠé…ç½®</title><link>https://sunnnner.github.io/p/%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E7%9A%84%E5%90%AB%E4%B9%89%E4%BB%A5%E5%8F%8A%E9%85%8D%E7%BD%AE/</link><pubDate>Thu, 10 Oct 2019 15:27:14 +0800</pubDate><guid>https://sunnnner.github.io/p/%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E7%9A%84%E5%90%AB%E4%B9%89%E4%BB%A5%E5%8F%8A%E9%85%8D%E7%BD%AE/</guid><description>&lt;h1 id="django-staticfile-çš„é…ç½®">Django staticfile çš„é…ç½®&lt;/h1>
&lt;p>èµ·åˆä»¥ä¸ºæ˜¯æˆ‘dockerfileå†™é”™äº†çš„é—®é¢˜ï¼Œçš„ç¡®ä¸æ˜¯dockerfileçš„é—®é¢˜æ˜¯æˆ‘æ²¡æœ‰ç†è§£static_urlä¸static_rootçš„å«ä¹‰&lt;/p>
&lt;p>ğŸ‘ å¦‚æœä¸æ˜¯å‰åç«¯åˆ†ç¦»é¡¹ç›®åœ¨æ¯ä¸ªAPPä¸‹éƒ½åº”è¯¥æœ‰staticä¸templatesæ–‡ä»¶å¤¹å­˜åœ¨ä¸ç„¶djangoæ”¶é›†é™æ€æ–‡ä»¶æ”¶é›†ä¸åˆ°&lt;/p>
&lt;p>STATIC_URLä¸ºDjangoè¿”å›ç»™å‰ç«¯çš„è·¯å¾„å³é¡¹ç›®å†…éƒ¨çš„staticæ–‡ä»¶å¤¹&lt;/p>
&lt;p>STATIC_ROOTä¸ºé™æ€æ–‡ä»¶æ”¶é›†çš„è·¯å¾„å³ python3 manage.py collectstatic çš„æ–‡ä»¶å¤¹&lt;/p>
&lt;p>STATIC_ROOT = os.path.join(BASE_DIR, &amp;lsquo;static&amp;rsquo;) æ„æ€æ˜¯æŠŠæ–‡ä»¶æ”¶é›†åˆ°é¡¹ç›®ä¸‹staticæ–‡ä»¶å¤¹ä¸‹çš„staticæ–‡ä»¶å¤¹ä¸­&lt;/p>
&lt;p>æ‰€ä»¥æ–¹ä¾¿èµ·è§æˆ‘æŠŠ STATIC_ROOT = os.path.join(BASE_DIR, &amp;lsquo;&amp;rsquo;)è®¾ç½®ä¸ºäº†æ”¶é›†åœ¨é¡¹ç›®ä¸‹staticæ–‡ä»¶å¤¹ä¸‹&lt;/p>
&lt;p>å¤§å‘ä¸å°‘å°å‘ä¸æ–­ï¼Œå­¦æ— æ­¢å¢ƒå•Š&lt;/p></description></item><item><title>Django Minioå¼€å‘è¿‡ç¨‹</title><link>https://sunnnner.github.io/django-minio%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B/</link><pubDate>Sun, 06 Oct 2019 14:17:12 +0800</pubDate><guid>https://sunnnner.github.io/django-minio%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B/</guid><description>&lt;blockquote>
&lt;p>ä½¿ç”¨Django-minio-storageè¿›è¡Œå¼€å‘minioçš„é™æ€æ–‡ä»¶å­˜å‚¨åŠŸèƒ½ï¼Œæœ¬æ¥å¯»æ€ç”¨minioç›´æ¥è¿›è¡Œå¼€å‘ï¼Œæ—¢ç„¶djangoæœ‰è¿™ä¸ªåŒ…æˆ‘ä»¬å°±æ‹¿æ¥ç”¨ä¸€ä¸‹&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>é¡¹ç›®è¯´æ˜&lt;a class="link" href="https://django-minio-storage.readthedocs.io/en/latest/" target="_blank" rel="noopener"
>django-minio-storage&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="å¼€å‘æœŸé—´é‡åˆ°çš„é—®é¢˜">å¼€å‘æœŸé—´é‡åˆ°çš„é—®é¢˜&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>åƒä¸‡ä¸è¦å¿˜äº†æŠŠminio-storageæ·»åŠ åˆ°app&lt;/p>
&lt;pre>&lt;code> Add minio_storage to INSTALLED_APPS in your project settings.
The last step is setting DEFAULT_FILE_STORAGE to &amp;quot;minio_storage.storage.MinioMediaStorage&amp;quot;, and STATICFILES_STORAGE to &amp;quot;minio_storage.storage.MinioStaticStorage&amp;quot;.
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;p>æ¥ä¸‹æ¥çš„é…ç½®çœ‹å®˜ç½‘é…ç½®å°±è¡Œäº†&lt;/p>
&lt;p>å› ä¸ºæˆ‘ç”¨dockerå†™çš„æ‰€ä»¥minio_storage_endpointå¯ä»¥ä½¿ç”¨dockeré¡¹ç›®åç§°:ç«¯å£å·æˆ–è€…å¤–ç½‘åŸŸåï¼ˆstatic.media.comï¼‰æˆ–è€…å¤–ç½‘IP:ç«¯å£å·&lt;/p>
&lt;p>æµè§ˆå™¨å¤ç”¨minioé™æ€æœåŠ¡å™¨çš„mediaæºå¸¦ç«¯å£å·æ€ä¹ˆåŠï¼Ÿ&lt;/p>
&lt;p>è§£å†³åŠæ³• nginx è´Ÿè½½å‡è¡¡ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">upstream docker {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server docker:9000;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">server {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 80;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name static.media.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location / {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Host $host;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_pass http://docker;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> client_max_body_size 10m;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Django Minioå¼€å‘è¿‡ç¨‹</title><link>https://sunnnner.github.io/p/django-minio%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B/</link><pubDate>Sun, 06 Oct 2019 14:17:12 +0800</pubDate><guid>https://sunnnner.github.io/p/django-minio%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B/</guid><description>&lt;blockquote>
&lt;p>ä½¿ç”¨Django-minio-storageè¿›è¡Œå¼€å‘minioçš„é™æ€æ–‡ä»¶å­˜å‚¨åŠŸèƒ½ï¼Œæœ¬æ¥å¯»æ€ç”¨minioç›´æ¥è¿›è¡Œå¼€å‘ï¼Œæ—¢ç„¶djangoæœ‰è¿™ä¸ªåŒ…æˆ‘ä»¬å°±æ‹¿æ¥ç”¨ä¸€ä¸‹&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>é¡¹ç›®è¯´æ˜&lt;a class="link" href="https://django-minio-storage.readthedocs.io/en/latest/" target="_blank" rel="noopener"
>django-minio-storage&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="å¼€å‘æœŸé—´é‡åˆ°çš„é—®é¢˜">å¼€å‘æœŸé—´é‡åˆ°çš„é—®é¢˜&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>åƒä¸‡ä¸è¦å¿˜äº†æŠŠminio-storageæ·»åŠ åˆ°app&lt;/p>
&lt;pre>&lt;code> Add minio_storage to INSTALLED_APPS in your project settings.
The last step is setting DEFAULT_FILE_STORAGE to &amp;quot;minio_storage.storage.MinioMediaStorage&amp;quot;, and STATICFILES_STORAGE to &amp;quot;minio_storage.storage.MinioStaticStorage&amp;quot;.
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;p>æ¥ä¸‹æ¥çš„é…ç½®çœ‹å®˜ç½‘é…ç½®å°±è¡Œäº†&lt;/p>
&lt;p>å› ä¸ºæˆ‘ç”¨dockerå†™çš„æ‰€ä»¥minio_storage_endpointå¯ä»¥ä½¿ç”¨dockeré¡¹ç›®åç§°:ç«¯å£å·æˆ–è€…å¤–ç½‘åŸŸåï¼ˆstatic.media.comï¼‰æˆ–è€…å¤–ç½‘IP:ç«¯å£å·&lt;/p>
&lt;p>æµè§ˆå™¨å¤ç”¨minioé™æ€æœåŠ¡å™¨çš„mediaæºå¸¦ç«¯å£å·æ€ä¹ˆåŠï¼Ÿ&lt;/p>
&lt;p>è§£å†³åŠæ³• nginx è´Ÿè½½å‡è¡¡ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">upstream docker {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server docker:9000;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">server {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 80;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name static.media.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location / {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Host $host;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_pass http://docker;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> client_max_body_size 10m;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>JWT</title><link>https://sunnnner.github.io/jwt/</link><pubDate>Wed, 02 Oct 2019 14:08:17 +0800</pubDate><guid>https://sunnnner.github.io/jwt/</guid><description>&lt;h1 id="jwtjson-web-token">JWTâ€”â€”Json web token&lt;/h1>
&lt;pre>&lt;code>æ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäºJSONçš„å¼€æ”¾æ ‡å‡†ï¼Œå¯å®ç°æ— çŠ¶æ€ã€åˆ†å¸ƒå¼çš„Webåº”ç”¨æˆæƒã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="11-ä¼ ç»Ÿæ–¹å¼">1.1 ä¼ ç»Ÿæ–¹å¼&lt;/h2>
&lt;p>&lt;a class="link" href="https://www.freebuf.com/blank" target="_blank" rel="noopener"
>XSSçš„åŸç†åˆ†æä¸è§£å‰–&lt;/a>&lt;/p>
&lt;pre>&lt;code>å‰åç«¯åˆ†ç¦»é€šè¿‡Restful APIè¿›è¡Œæ•°æ®äº¤äº’æ—¶ï¼Œå¦‚ä½•éªŒè¯ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯åŠæƒé™ã€‚åœ¨åŸæ¥çš„é¡¹ç›®ä¸­ï¼Œä½¿ç”¨çš„æ˜¯æœ€ä¼ ç»Ÿä¹Ÿæ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼Œå‰ç«¯ç™»å½•ï¼Œåç«¯æ ¹æ®ç”¨æˆ·ä¿¡æ¯ç”Ÿæˆä¸€ä¸ªtokenï¼Œå¹¶ä¿å­˜è¿™ä¸ª token å’Œå¯¹åº”çš„ç”¨æˆ·idåˆ°æ•°æ®åº“æˆ–Sessionä¸­ï¼Œæ¥ç€æŠŠ token ä¼ ç»™ç”¨æˆ·ï¼Œå­˜å…¥æµè§ˆå™¨ cookieï¼Œä¹‹åæµè§ˆå™¨è¯·æ±‚å¸¦ä¸Šè¿™ä¸ªcookieï¼Œåç«¯æ ¹æ®è¿™ä¸ªcookieå€¼æ¥æŸ¥è¯¢ç”¨æˆ·ï¼ŒéªŒè¯æ˜¯å¦è¿‡æœŸã€‚
ä½†è¿™æ ·åšé—®é¢˜å°±å¾ˆå¤šï¼Œå¦‚æœæˆ‘ä»¬çš„é¡µé¢å‡ºç°äº† XSS æ¼æ´ï¼Œç”±äº cookie å¯ä»¥è¢« JavaScript è¯»å–ï¼ŒXSS æ¼æ´ä¼šå¯¼è‡´ç”¨æˆ· token æ³„éœ²ï¼Œè€Œä½œä¸ºåç«¯è¯†åˆ«ç”¨æˆ·çš„æ ‡è¯†ï¼Œcookie çš„æ³„éœ²æ„å‘³ç€ç”¨æˆ·ä¿¡æ¯ä¸å†å®‰å…¨ã€‚å°½ç®¡æˆ‘ä»¬é€šè¿‡è½¬ä¹‰è¾“å‡ºå†…å®¹ï¼Œä½¿ç”¨ CDN ç­‰å¯ä»¥å°½é‡é¿å… XSS æ³¨å…¥ï¼Œä½†è°ä¹Ÿä¸èƒ½ä¿è¯åœ¨å¤§å‹çš„é¡¹ç›®ä¸­ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚
åœ¨è®¾ç½® cookie çš„æ—¶å€™ï¼Œå…¶å®ä½ è¿˜å¯ä»¥è®¾ç½® httpOnly ä»¥åŠ secure(ä¿æŠ¤)é¡¹ã€‚è®¾ç½® httpOnly å cookie å°†ä¸èƒ½è¢« JS è¯»å–ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨çš„æŠŠå®ƒåŠ åœ¨è¯·æ±‚çš„ header å½“ä¸­ï¼Œè®¾ç½® secure çš„è¯ï¼Œcookie å°±åªå…è®¸é€šè¿‡ HTTPS ä¼ è¾“ã€‚secure é€‰é¡¹å¯ä»¥è¿‡æ»¤æ‰ä¸€äº›ä½¿ç”¨ HTTP åè®®çš„ XSS æ³¨å…¥ï¼Œä½†å¹¶ä¸èƒ½å®Œå…¨é˜»æ­¢ã€‚
httpOnly é€‰é¡¹ä½¿å¾— JS ä¸èƒ½è¯»å–åˆ° cookieï¼Œé‚£ä¹ˆ XSS æ³¨å…¥çš„é—®é¢˜ä¹ŸåŸºæœ¬ä¸ç”¨æ‹…å¿ƒäº†ã€‚ä½†è®¾ç½® httpOnly å°±å¸¦æ¥äº†å¦ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¾ˆå®¹æ˜“çš„è¢« XSRFï¼Œå³è·¨ç«™è¯·æ±‚ä¼ªé€ ã€‚å½“ä½ æµè§ˆå™¨å¼€ç€è¿™ä¸ªé¡µé¢çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªé¡µé¢å¯ä»¥å¾ˆå®¹æ˜“çš„è·¨ç«™è¯·æ±‚è¿™ä¸ªé¡µé¢çš„å†…å®¹ã€‚å› ä¸º cookie é»˜è®¤è¢«å‘äº†å‡ºå»ã€‚
å¦å¤–ï¼Œå¦‚æœå°†éªŒè¯ä¿¡æ¯ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œåç«¯æ¯æ¬¡éƒ½éœ€è¦æ ¹æ®tokenæŸ¥å‡ºç”¨æˆ·idï¼Œè¿™å°±å¢åŠ äº†æ•°æ®åº“çš„æŸ¥è¯¢å’Œå­˜å‚¨å¼€é”€ã€‚è‹¥æŠŠéªŒè¯ä¿¡æ¯ä¿å­˜åœ¨sessionä¸­ï¼Œæœ‰åŠ å¤§äº†æœåŠ¡å™¨ç«¯çš„å­˜å‚¨å‹åŠ›ã€‚é‚£æˆ‘ä»¬å¯ä¸å¯ä»¥ä¸è¦æœåŠ¡å™¨å»æŸ¥è¯¢å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬ç”Ÿæˆtokenéµå¾ªä¸€å®šçš„è§„å¾‹ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•æ¥åŠ å¯†ç”¨æˆ·idå½¢æˆtokenï¼Œé‚£ä¹ˆæœåŠ¡ç«¯ä»¥åå…¶å®åªè¦è§£å¯†è¯¥tokenå°±å¯ä»¥çŸ¥é“ç”¨æˆ·çš„idæ˜¯ä»€ä¹ˆäº†ã€‚ä¸è¿‡å‘¢ï¼Œæˆ‘åªæ˜¯ä¸¾ä¸ªä¾‹å­è€Œå·²ï¼Œè¦æ˜¯çœŸè¿™ä¹ˆåšï¼Œåªè¦ä½ çš„å¯¹ç§°åŠ å¯†ç®—æ³•æ³„éœ²äº†ï¼Œå…¶ä»–äººå¯ä»¥é€šè¿‡è¿™ç§åŠ å¯†æ–¹å¼è¿›è¡Œä¼ªé€ tokenï¼Œé‚£ä¹ˆæ‰€æœ‰ç”¨æˆ·ä¿¡æ¯éƒ½ä¸å†å®‰å…¨äº†ã€‚æ©ï¼Œé‚£ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•æ¥åšå‘¢ï¼Œå…¶å®ç°åœ¨æœ‰ä¸ªè§„èŒƒå°±æ˜¯è¿™æ ·åšçš„ï¼Œå°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦ä»‹ç»çš„ JWTã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="json-web-tokenjwt">Json Web Tokenï¼ˆJWTï¼‰&lt;/h2>
&lt;pre>&lt;code>JWT æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†(RFC 7519)ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç”¨äºç®€æ´ï¼Œè‡ªåŒ…å«çš„ç”¨äºé€šä¿¡åŒæ–¹ä¹‹é—´ä»¥ JSON å¯¹è±¡çš„å½¢å¼å®‰å…¨ä¼ é€’ä¿¡æ¯çš„æ–¹æ³•ã€‚JWT å¯ä»¥ä½¿ç”¨ HMAC ç®—æ³•æˆ–è€…æ˜¯ RSA çš„å…¬é’¥å¯†é’¥å¯¹è¿›è¡Œç­¾åã€‚å®ƒå…·å¤‡ä¸¤ä¸ªç‰¹ç‚¹ï¼š
ç®€æ´(Compact)
å¯ä»¥é€šè¿‡URL, POST å‚æ•°æˆ–è€…åœ¨ HTTP header å‘é€ï¼Œå› ä¸ºæ•°æ®é‡å°ï¼Œä¼ è¾“é€Ÿåº¦å¿«
è‡ªåŒ…å«(Self-contained)
è´Ÿè½½ä¸­åŒ…å«äº†æ‰€æœ‰ç”¨æˆ·æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡æŸ¥è¯¢æ•°æ®åº“
&lt;/code>&lt;/pre>
&lt;h2 id="jwt-ç»„æˆ">JWT ç»„æˆ&lt;/h2>
&lt;h3 id="header-å¤´éƒ¨">Header å¤´éƒ¨&lt;/h3>
&lt;pre>&lt;code>å¤´éƒ¨åŒ…å«äº†ä¸¤éƒ¨åˆ†ï¼Œtoken ç±»å‹å’Œé‡‡ç”¨çš„åŠ å¯†ç®—æ³•
&lt;/code>&lt;/pre>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;alg&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;HS256&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;typ&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;JWT&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;pre>&lt;code>å®ƒä¼šä½¿ç”¨ Base64 ç¼–ç ç»„æˆ JWT ç»“æ„çš„ç¬¬ä¸€éƒ¨åˆ†,å¦‚æœä½ ä½¿ç”¨Node.jsï¼Œå¯ä»¥ç”¨Node.jsçš„åŒ…base64urlæ¥å¾—åˆ°è¿™ä¸ªå­—ç¬¦ä¸²ã€‚
Base64æ˜¯ä¸€ç§ç¼–ç ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯å¯ä»¥è¢«ç¿»è¯‘å›åŸæ¥çš„æ ·å­æ¥çš„ã€‚å®ƒå¹¶ä¸æ˜¯ä¸€ç§åŠ å¯†è¿‡ç¨‹ã€‚
&lt;/code>&lt;/pre>
&lt;h3 id="payload-è´Ÿè½½">Payload è´Ÿè½½&lt;/h3>
&lt;pre>&lt;code>è¿™éƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬å­˜æ”¾ä¿¡æ¯çš„åœ°æ–¹äº†ï¼Œä½ å¯ä»¥æŠŠç”¨æˆ· ID ç­‰ä¿¡æ¯æ”¾åœ¨è¿™é‡Œï¼ŒJWT è§„èŒƒé‡Œé¢å¯¹è¿™éƒ¨åˆ†æœ‰è¿›è¡Œäº†æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ï¼Œå¸¸ç”¨çš„ç”± issï¼ˆç­¾å‘è€…ï¼‰ï¼Œexpï¼ˆè¿‡æœŸæ—¶é—´ï¼‰ï¼Œsubï¼ˆé¢å‘çš„ç”¨æˆ·ï¼‰ï¼Œaudï¼ˆæ¥æ”¶æ–¹ï¼‰ï¼Œiatï¼ˆç­¾å‘æ—¶é—´ï¼‰ã€‚
&lt;/code>&lt;/pre>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;iss&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;lion1ou JWT&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;iat&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">1441593502&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;exp&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">1441594722&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;aud&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;www.example.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;sub&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;lion1ou@163.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;pre>&lt;code>åŒæ ·çš„ï¼Œå®ƒä¼šä½¿ç”¨ Base64 ç¼–ç ç»„æˆ JWT ç»“æ„çš„ç¬¬äºŒéƒ¨åˆ†
&lt;/code>&lt;/pre>
&lt;h3 id="signature-ç­¾å">Signature ç­¾å&lt;/h3>
&lt;pre>&lt;code>å‰é¢ä¸¤éƒ¨åˆ†éƒ½æ˜¯ä½¿ç”¨ Base64 è¿›è¡Œç¼–ç çš„ï¼Œå³å‰ç«¯å¯ä»¥è§£å¼€çŸ¥é“é‡Œé¢çš„ä¿¡æ¯ã€‚Signature éœ€è¦ä½¿ç”¨ç¼–ç åçš„ header å’Œ payload ä»¥åŠæˆ‘ä»¬æä¾›çš„ä¸€ä¸ªå¯†é’¥ï¼Œç„¶åä½¿ç”¨ header ä¸­æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆHS256ï¼‰è¿›è¡Œç­¾åã€‚ç­¾åçš„ä½œç”¨æ˜¯ä¿è¯ JWT æ²¡æœ‰è¢«ç¯¡æ”¹è¿‡ã€‚
ä¸‰ä¸ªéƒ¨åˆ†é€šè¿‡.è¿æ¥åœ¨ä¸€èµ·å°±æ˜¯æˆ‘ä»¬çš„ JWT äº†ï¼Œå®ƒå¯èƒ½é•¿è¿™ä¸ªæ ·å­ï¼Œé•¿åº¦è²Œä¼¼å’Œä½ çš„åŠ å¯†ç®—æ³•å’Œç§é’¥æœ‰å…³ç³»
```text
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjU3ZmVmMTY0ZTU0YWY2NGZmYzUzZGJkNSIsInhzcmYiOiI0ZWE1YzUwOGE2NTY2ZTc2MjQwNTQzZjhmZWIwNmZkNDU3Nzc3YmUzOTU0OWM0MDE2NDM2YWZkYTY1ZDIzMzBlIiwiaWF0IjoxNDc2NDI3OTMzfQ.PA3QjeyZSUh7H0GfE0vJaKW4LjKJuC3dVLQiY4hii8s
```
å…¶å®åˆ°è¿™ä¸€æ­¥å¯èƒ½å°±æœ‰äººä¼šæƒ³äº†ï¼ŒHTTP è¯·æ±‚æ€»ä¼šå¸¦ä¸Š tokenï¼Œè¿™æ ·è¿™ä¸ª token ä¼ æ¥ä¼ å»å ç”¨ä¸å¿…è¦çš„å¸¦å®½å•Šã€‚å¦‚æœä½ è¿™ä¹ˆæƒ³äº†ï¼Œé‚£ä½ å¯ä»¥å»äº†è§£ä¸‹ HTTP2ï¼ŒHTTP2 å¯¹å¤´éƒ¨è¿›è¡Œäº†å‹ç¼©ï¼Œç›¸ä¿¡ä¹Ÿè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚
&lt;/code>&lt;/pre>
&lt;h3 id="ç­¾åçš„ç›®çš„">ç­¾åçš„ç›®çš„&lt;/h3>
&lt;pre>&lt;code>æœ€åä¸€æ­¥ç­¾åçš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šæ˜¯å¯¹å¤´éƒ¨ä»¥åŠè´Ÿè½½å†…å®¹è¿›è¡Œç­¾åï¼Œé˜²æ­¢å†…å®¹è¢«çªœæ”¹ã€‚å¦‚æœæœ‰äººå¯¹å¤´éƒ¨ä»¥åŠè´Ÿè½½çš„å†…å®¹è§£ç ä¹‹åè¿›è¡Œä¿®æ”¹ï¼Œå†è¿›è¡Œç¼–ç ï¼Œæœ€ååŠ ä¸Šä¹‹å‰çš„ç­¾åç»„åˆå½¢æˆæ–°çš„JWTçš„è¯ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ç«¯ä¼šåˆ¤æ–­å‡ºæ–°çš„å¤´éƒ¨å’Œè´Ÿè½½å½¢æˆçš„ç­¾åå’ŒJWTé™„å¸¦ä¸Šçš„ç­¾åæ˜¯ä¸ä¸€æ ·çš„ã€‚å¦‚æœè¦å¯¹æ–°çš„å¤´éƒ¨å’Œè´Ÿè½½è¿›è¡Œç­¾åï¼Œåœ¨ä¸çŸ¥é“æœåŠ¡å™¨åŠ å¯†æ—¶ç”¨çš„å¯†é’¥çš„è¯ï¼Œå¾—å‡ºæ¥çš„ç­¾åä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚
&lt;/code>&lt;/pre>
&lt;h3 id="ä¿¡æ¯æš´éœ²">ä¿¡æ¯æš´éœ²&lt;/h3>
&lt;pre>&lt;code>åœ¨è¿™é‡Œå¤§å®¶ä¸€å®šä¼šé—®ä¸€ä¸ªé—®é¢˜ï¼šBase64æ˜¯ä¸€ç§ç¼–ç ï¼Œæ˜¯å¯é€†çš„ï¼Œé‚£ä¹ˆæˆ‘çš„ä¿¡æ¯ä¸å°±è¢«æš´éœ²äº†å—ï¼Ÿ
æ˜¯çš„ã€‚æ‰€ä»¥ï¼Œåœ¨JWTä¸­ï¼Œä¸åº”è¯¥åœ¨è´Ÿè½½é‡Œé¢åŠ å…¥ä»»ä½•æ•æ„Ÿçš„æ•°æ®ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼ è¾“çš„æ˜¯ç”¨æˆ·çš„User IDã€‚è¿™ä¸ªå€¼å®é™…ä¸Šä¸æ˜¯ä»€ä¹ˆæ•æ„Ÿå†…å®¹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¢«çŸ¥é“ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚ä½†æ˜¯åƒå¯†ç è¿™æ ·çš„å†…å®¹å°±ä¸èƒ½è¢«æ”¾åœ¨JWTä¸­äº†ã€‚å¦‚æœå°†ç”¨æˆ·çš„å¯†ç æ”¾åœ¨äº†JWTä¸­ï¼Œé‚£ä¹ˆæ€€æœ‰æ¶æ„çš„ç¬¬ä¸‰æ–¹é€šè¿‡Base64è§£ç å°±èƒ½å¾ˆå¿«åœ°çŸ¥é“ä½ çš„å¯†ç äº†ã€‚
å› æ­¤JWTé€‚åˆç”¨äºå‘Webåº”ç”¨ä¼ é€’ä¸€äº›éæ•æ„Ÿä¿¡æ¯ã€‚JWTè¿˜ç»å¸¸ç”¨äºè®¾è®¡ç”¨æˆ·è®¤è¯å’Œæˆæƒç³»ç»Ÿï¼Œç”šè‡³å®ç°Webåº”ç”¨çš„å•ç‚¹ç™»å½•ã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="jwt-ä½¿ç”¨">JWT ä½¿ç”¨&lt;/h2>
&lt;pre>&lt;code>1.é¦–å…ˆï¼Œå‰ç«¯é€šè¿‡Webè¡¨å•å°†è‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç å‘é€åˆ°åç«¯çš„æ¥å£ã€‚è¿™ä¸€è¿‡ç¨‹ä¸€èˆ¬æ˜¯ä¸€ä¸ªHTTP POSTè¯·æ±‚ã€‚å»ºè®®çš„æ–¹å¼æ˜¯é€šè¿‡SSLåŠ å¯†çš„ä¼ è¾“ï¼ˆhttpsåè®®ï¼‰ï¼Œä»è€Œé¿å…æ•æ„Ÿä¿¡æ¯è¢«å—…æ¢ã€‚
2.åç«¯æ ¸å¯¹ç”¨æˆ·åå’Œå¯†ç æˆåŠŸåï¼Œå°†ç”¨æˆ·çš„idç­‰å…¶ä»–ä¿¡æ¯ä½œä¸ºJWT Payloadï¼ˆè´Ÿè½½ï¼‰ï¼Œå°†å…¶ä¸å¤´éƒ¨åˆ†åˆ«è¿›è¡ŒBase64ç¼–ç æ‹¼æ¥åç­¾åï¼Œå½¢æˆä¸€ä¸ªJWTã€‚å½¢æˆçš„JWTå°±æ˜¯ä¸€ä¸ªå½¢åŒlll.zzz.xxxçš„å­—ç¬¦ä¸²ã€‚
3.åç«¯å°†JWTå­—ç¬¦ä¸²ä½œä¸ºç™»å½•æˆåŠŸçš„è¿”å›ç»“æœè¿”å›ç»™å‰ç«¯ã€‚å‰ç«¯å¯ä»¥å°†è¿”å›çš„ç»“æœä¿å­˜åœ¨localStorageæˆ–sessionStorageä¸Šï¼Œé€€å‡ºç™»å½•æ—¶å‰ç«¯åˆ é™¤ä¿å­˜çš„JWTå³å¯ã€‚
4.å‰ç«¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶å°†JWTæ”¾å…¥HTTP Headerä¸­çš„Authorizationä½ã€‚(è§£å†³XSSå’ŒXSRFé—®é¢˜)
5.åç«¯æ£€æŸ¥æ˜¯å¦å­˜åœ¨ï¼Œå¦‚å­˜åœ¨éªŒè¯JWTçš„æœ‰æ•ˆæ€§ã€‚ä¾‹å¦‚ï¼Œæ£€æŸ¥ç­¾åæ˜¯å¦æ­£ç¡®ï¼›æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸï¼›æ£€æŸ¥Tokençš„æ¥æ”¶æ–¹æ˜¯å¦æ˜¯è‡ªå·±ï¼ˆå¯é€‰ï¼‰ã€‚
6.éªŒè¯é€šè¿‡ååç«¯ä½¿ç”¨JWTä¸­åŒ…å«çš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œå…¶ä»–é€»è¾‘æ“ä½œï¼Œè¿”å›ç›¸åº”ç»“æœã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="å’Œsessionæ–¹å¼å­˜å‚¨idçš„å·®å¼‚">å’ŒSessionæ–¹å¼å­˜å‚¨idçš„å·®å¼‚&lt;/h2>
&lt;pre>&lt;code>Sessionæ–¹å¼å­˜å‚¨ç”¨æˆ·idçš„æœ€å¤§å¼Šç—…åœ¨äºSessionæ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„ï¼Œæ‰€ä»¥éœ€è¦å ç”¨å¤§é‡æœåŠ¡å™¨å†…å­˜ï¼Œå¯¹äºè¾ƒå¤§å‹åº”ç”¨è€Œè¨€å¯èƒ½è¿˜è¦ä¿å­˜è®¸å¤šçš„çŠ¶æ€ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå¤§å‹åº”ç”¨è¿˜éœ€è¦å€ŸåŠ©ä¸€äº›KVæ•°æ®åº“å’Œä¸€ç³»åˆ—ç¼“å­˜æœºåˆ¶æ¥å®ç°Sessionçš„å­˜å‚¨ã€‚
è€ŒJWTæ–¹å¼å°†ç”¨æˆ·çŠ¶æ€åˆ†æ•£åˆ°äº†å®¢æˆ·ç«¯ä¸­ï¼Œå¯ä»¥æ˜æ˜¾å‡è½»æœåŠ¡ç«¯çš„å†…å­˜å‹åŠ›ã€‚é™¤äº†ç”¨æˆ·idä¹‹å¤–ï¼Œè¿˜å¯ä»¥å­˜å‚¨å…¶ä»–çš„å’Œç”¨æˆ·ç›¸å…³çš„ä¿¡æ¯ï¼Œä¾‹å¦‚è¯¥ç”¨æˆ·æ˜¯å¦æ˜¯ç®¡ç†å‘˜ã€ç”¨æˆ·æ‰€åœ¨çš„åˆ†ç»„ç­‰ã€‚è™½è¯´JWTæ–¹å¼è®©æœåŠ¡å™¨æœ‰ä¸€äº›è®¡ç®—å‹åŠ›ï¼ˆä¾‹å¦‚åŠ å¯†ã€ç¼–ç å’Œè§£ç ï¼‰ï¼Œä½†æ˜¯è¿™äº›å‹åŠ›ç›¸æ¯”ç£ç›˜å­˜å‚¨è€Œè¨€å¯èƒ½å°±ä¸ç®—ä»€ä¹ˆäº†ã€‚å…·ä½“æ˜¯å¦é‡‡ç”¨ï¼Œéœ€è¦åœ¨ä¸åŒåœºæ™¯ä¸‹ç”¨æ•°æ®è¯´è¯ã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="å•ç‚¹ç™»å½•">å•ç‚¹ç™»å½•&lt;/h2>
&lt;pre>&lt;code>Sessionæ–¹å¼æ¥å­˜å‚¨ç”¨æˆ·idï¼Œä¸€å¼€å§‹ç”¨æˆ·çš„Sessionåªä¼šå­˜å‚¨åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šã€‚å¯¹äºæœ‰å¤šä¸ªå­åŸŸåçš„ç«™ç‚¹ï¼Œæ¯ä¸ªå­åŸŸåè‡³å°‘ä¼šå¯¹åº”ä¸€å°ä¸åŒçš„æœåŠ¡å™¨ï¼Œä¾‹å¦‚ï¼šwww.taobao.comï¼Œnv.taobao.comï¼Œnz.taobao.comï¼Œlogin.taobao.comã€‚æ‰€ä»¥å¦‚æœè¦å®ç°åœ¨login.taobao.comç™»å½•åï¼Œåœ¨å…¶ä»–çš„å­åŸŸåä¸‹ä¾ç„¶å¯ä»¥å–åˆ°Sessionï¼Œè¿™è¦æ±‚æˆ‘ä»¬åœ¨å¤šå°æœåŠ¡å™¨ä¸ŠåŒæ­¥Sessionã€‚ä½¿ç”¨JWTçš„æ–¹å¼åˆ™æ²¡æœ‰è¿™ä¸ªé—®é¢˜çš„å­˜åœ¨ï¼Œå› ä¸ºç”¨æˆ·çš„çŠ¶æ€å·²ç»è¢«ä¼ é€åˆ°äº†å®¢æˆ·ç«¯ã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="æ€»ç»“ä¼˜ç‚¹">æ€»ç»“ä¼˜ç‚¹&lt;/h2>
&lt;pre>&lt;code>ä¹Ÿå°±æ˜¯è¯´ç›¸æ¯”äºä¼ ç»ŸåŸºäºcookieçš„sessionï¼ŒåŸºäºtokençš„jwtæœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š
Cookieæ˜¯ä¸å…è®¸å®åŸŸè®¿é—®çš„ï¼Œè¿™ä¸€ç‚¹å¯¹Tokenæœºåˆ¶æ˜¯ä¸å­˜åœ¨çš„ï¼Œå‰ææ˜¯ä¼ è¾“çš„ç”¨æˆ·è®¤è¯ä¿¡æ¯é€šè¿‡HTTPå¤´ä¼ è¾“.
æ— çŠ¶æ€(ä¹Ÿç§°ï¼šæœåŠ¡ç«¯å¯æ‰©å±•è¡Œ):Tokenæœºåˆ¶åœ¨æœåŠ¡ç«¯ä¸éœ€è¦å­˜å‚¨sessionä¿¡æ¯ï¼Œå› ä¸ºToken è‡ªèº«åŒ…å«äº†æ‰€æœ‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ï¼Œåªéœ€è¦åœ¨å®¢æˆ·ç«¯çš„cookieæˆ–æœ¬åœ°ä»‹è´¨å­˜å‚¨çŠ¶æ€ä¿¡æ¯.
æ›´é€‚ç”¨CDN: å¯ä»¥é€šè¿‡å†…å®¹åˆ†å‘ç½‘ç»œè¯·æ±‚ä½ æœåŠ¡ç«¯çš„æ‰€æœ‰èµ„æ–™ï¼ˆå¦‚ï¼šjavascriptï¼ŒHTML,å›¾ç‰‡ç­‰ï¼‰ï¼Œè€Œä½ çš„æœåŠ¡ç«¯åªè¦æä¾›APIå³å¯.
å»è€¦: ä¸éœ€è¦ç»‘å®šåˆ°ä¸€ä¸ªç‰¹å®šçš„èº«ä»½éªŒè¯æ–¹æ¡ˆã€‚Tokenå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ç”Ÿæˆï¼Œåªè¦åœ¨ä½ çš„APIè¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä½ å¯ä»¥è¿›è¡ŒTokenç”Ÿæˆè°ƒç”¨å³å¯.
æ›´é€‚ç”¨äºç§»åŠ¨åº”ç”¨: å½“ä½ çš„å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªåŸç”Ÿå¹³å°ï¼ˆiOS, Androidï¼ŒWindows 8ç­‰ï¼‰æ—¶ï¼ŒCookieæ˜¯ä¸è¢«æ”¯æŒçš„ï¼ˆä½ éœ€è¦é€šè¿‡Cookieå®¹å™¨è¿›è¡Œå¤„ç†ï¼‰ï¼Œè¿™æ—¶é‡‡ç”¨Tokenè®¤è¯æœºåˆ¶å°±ä¼šç®€å•å¾—å¤šã€‚
CSRF:å› ä¸ºä¸å†ä¾èµ–äºCookieï¼Œæ‰€ä»¥ä½ å°±ä¸éœ€è¦è€ƒè™‘å¯¹CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰çš„é˜²èŒƒã€‚
æ€§èƒ½: ä¸€æ¬¡ç½‘ç»œå¾€è¿”æ—¶é—´ï¼ˆé€šè¿‡æ•°æ®åº“æŸ¥è¯¢sessionä¿¡æ¯ï¼‰æ€»æ¯”åšä¸€æ¬¡HMACSHA256è®¡ç®— çš„TokenéªŒè¯å’Œè§£æè¦è´¹æ—¶å¾—å¤š.
ä¸éœ€è¦ä¸ºç™»å½•é¡µé¢åšç‰¹æ®Šå¤„ç†: å¦‚æœä½ ä½¿ç”¨Protractor åšåŠŸèƒ½æµ‹è¯•çš„æ—¶å€™ï¼Œä¸å†éœ€è¦ä¸ºç™»å½•é¡µé¢åšç‰¹æ®Šå¤„ç†.
åŸºäºæ ‡å‡†åŒ–:ä½ çš„APIå¯ä»¥é‡‡ç”¨æ ‡å‡†åŒ–çš„ JSON Web Token (JWT). è¿™ä¸ªæ ‡å‡†å·²ç»å­˜åœ¨å¤šä¸ªåç«¯åº“ï¼ˆ.NET, Ruby, Java,Python, PHPï¼‰å’Œå¤šå®¶å…¬å¸çš„æ”¯æŒï¼ˆå¦‚ï¼šFirebase,Google, Microsoftï¼‰.&lt;/code>&lt;/pre></description></item><item><title>JWT</title><link>https://sunnnner.github.io/p/jwt/</link><pubDate>Wed, 02 Oct 2019 14:08:17 +0800</pubDate><guid>https://sunnnner.github.io/p/jwt/</guid><description>&lt;h1 id="jwtjson-web-token">JWTâ€”â€”Json web token&lt;/h1>
&lt;pre>&lt;code>æ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäºJSONçš„å¼€æ”¾æ ‡å‡†ï¼Œå¯å®ç°æ— çŠ¶æ€ã€åˆ†å¸ƒå¼çš„Webåº”ç”¨æˆæƒã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="11-ä¼ ç»Ÿæ–¹å¼">1.1 ä¼ ç»Ÿæ–¹å¼&lt;/h2>
&lt;p>&lt;a class="link" href="https://www.freebuf.com/blank" target="_blank" rel="noopener"
>XSSçš„åŸç†åˆ†æä¸è§£å‰–&lt;/a>&lt;/p>
&lt;pre>&lt;code>å‰åç«¯åˆ†ç¦»é€šè¿‡Restful APIè¿›è¡Œæ•°æ®äº¤äº’æ—¶ï¼Œå¦‚ä½•éªŒè¯ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯åŠæƒé™ã€‚åœ¨åŸæ¥çš„é¡¹ç›®ä¸­ï¼Œä½¿ç”¨çš„æ˜¯æœ€ä¼ ç»Ÿä¹Ÿæ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼Œå‰ç«¯ç™»å½•ï¼Œåç«¯æ ¹æ®ç”¨æˆ·ä¿¡æ¯ç”Ÿæˆä¸€ä¸ªtokenï¼Œå¹¶ä¿å­˜è¿™ä¸ª token å’Œå¯¹åº”çš„ç”¨æˆ·idåˆ°æ•°æ®åº“æˆ–Sessionä¸­ï¼Œæ¥ç€æŠŠ token ä¼ ç»™ç”¨æˆ·ï¼Œå­˜å…¥æµè§ˆå™¨ cookieï¼Œä¹‹åæµè§ˆå™¨è¯·æ±‚å¸¦ä¸Šè¿™ä¸ªcookieï¼Œåç«¯æ ¹æ®è¿™ä¸ªcookieå€¼æ¥æŸ¥è¯¢ç”¨æˆ·ï¼ŒéªŒè¯æ˜¯å¦è¿‡æœŸã€‚
ä½†è¿™æ ·åšé—®é¢˜å°±å¾ˆå¤šï¼Œå¦‚æœæˆ‘ä»¬çš„é¡µé¢å‡ºç°äº† XSS æ¼æ´ï¼Œç”±äº cookie å¯ä»¥è¢« JavaScript è¯»å–ï¼ŒXSS æ¼æ´ä¼šå¯¼è‡´ç”¨æˆ· token æ³„éœ²ï¼Œè€Œä½œä¸ºåç«¯è¯†åˆ«ç”¨æˆ·çš„æ ‡è¯†ï¼Œcookie çš„æ³„éœ²æ„å‘³ç€ç”¨æˆ·ä¿¡æ¯ä¸å†å®‰å…¨ã€‚å°½ç®¡æˆ‘ä»¬é€šè¿‡è½¬ä¹‰è¾“å‡ºå†…å®¹ï¼Œä½¿ç”¨ CDN ç­‰å¯ä»¥å°½é‡é¿å… XSS æ³¨å…¥ï¼Œä½†è°ä¹Ÿä¸èƒ½ä¿è¯åœ¨å¤§å‹çš„é¡¹ç›®ä¸­ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚
åœ¨è®¾ç½® cookie çš„æ—¶å€™ï¼Œå…¶å®ä½ è¿˜å¯ä»¥è®¾ç½® httpOnly ä»¥åŠ secure(ä¿æŠ¤)é¡¹ã€‚è®¾ç½® httpOnly å cookie å°†ä¸èƒ½è¢« JS è¯»å–ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨çš„æŠŠå®ƒåŠ åœ¨è¯·æ±‚çš„ header å½“ä¸­ï¼Œè®¾ç½® secure çš„è¯ï¼Œcookie å°±åªå…è®¸é€šè¿‡ HTTPS ä¼ è¾“ã€‚secure é€‰é¡¹å¯ä»¥è¿‡æ»¤æ‰ä¸€äº›ä½¿ç”¨ HTTP åè®®çš„ XSS æ³¨å…¥ï¼Œä½†å¹¶ä¸èƒ½å®Œå…¨é˜»æ­¢ã€‚
httpOnly é€‰é¡¹ä½¿å¾— JS ä¸èƒ½è¯»å–åˆ° cookieï¼Œé‚£ä¹ˆ XSS æ³¨å…¥çš„é—®é¢˜ä¹ŸåŸºæœ¬ä¸ç”¨æ‹…å¿ƒäº†ã€‚ä½†è®¾ç½® httpOnly å°±å¸¦æ¥äº†å¦ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¾ˆå®¹æ˜“çš„è¢« XSRFï¼Œå³è·¨ç«™è¯·æ±‚ä¼ªé€ ã€‚å½“ä½ æµè§ˆå™¨å¼€ç€è¿™ä¸ªé¡µé¢çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªé¡µé¢å¯ä»¥å¾ˆå®¹æ˜“çš„è·¨ç«™è¯·æ±‚è¿™ä¸ªé¡µé¢çš„å†…å®¹ã€‚å› ä¸º cookie é»˜è®¤è¢«å‘äº†å‡ºå»ã€‚
å¦å¤–ï¼Œå¦‚æœå°†éªŒè¯ä¿¡æ¯ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œåç«¯æ¯æ¬¡éƒ½éœ€è¦æ ¹æ®tokenæŸ¥å‡ºç”¨æˆ·idï¼Œè¿™å°±å¢åŠ äº†æ•°æ®åº“çš„æŸ¥è¯¢å’Œå­˜å‚¨å¼€é”€ã€‚è‹¥æŠŠéªŒè¯ä¿¡æ¯ä¿å­˜åœ¨sessionä¸­ï¼Œæœ‰åŠ å¤§äº†æœåŠ¡å™¨ç«¯çš„å­˜å‚¨å‹åŠ›ã€‚é‚£æˆ‘ä»¬å¯ä¸å¯ä»¥ä¸è¦æœåŠ¡å™¨å»æŸ¥è¯¢å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬ç”Ÿæˆtokenéµå¾ªä¸€å®šçš„è§„å¾‹ï¼Œæ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•æ¥åŠ å¯†ç”¨æˆ·idå½¢æˆtokenï¼Œé‚£ä¹ˆæœåŠ¡ç«¯ä»¥åå…¶å®åªè¦è§£å¯†è¯¥tokenå°±å¯ä»¥çŸ¥é“ç”¨æˆ·çš„idæ˜¯ä»€ä¹ˆäº†ã€‚ä¸è¿‡å‘¢ï¼Œæˆ‘åªæ˜¯ä¸¾ä¸ªä¾‹å­è€Œå·²ï¼Œè¦æ˜¯çœŸè¿™ä¹ˆåšï¼Œåªè¦ä½ çš„å¯¹ç§°åŠ å¯†ç®—æ³•æ³„éœ²äº†ï¼Œå…¶ä»–äººå¯ä»¥é€šè¿‡è¿™ç§åŠ å¯†æ–¹å¼è¿›è¡Œä¼ªé€ tokenï¼Œé‚£ä¹ˆæ‰€æœ‰ç”¨æˆ·ä¿¡æ¯éƒ½ä¸å†å®‰å…¨äº†ã€‚æ©ï¼Œé‚£ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•æ¥åšå‘¢ï¼Œå…¶å®ç°åœ¨æœ‰ä¸ªè§„èŒƒå°±æ˜¯è¿™æ ·åšçš„ï¼Œå°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦ä»‹ç»çš„ JWTã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="json-web-tokenjwt">Json Web Tokenï¼ˆJWTï¼‰&lt;/h2>
&lt;pre>&lt;code>JWT æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†(RFC 7519)ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç”¨äºç®€æ´ï¼Œè‡ªåŒ…å«çš„ç”¨äºé€šä¿¡åŒæ–¹ä¹‹é—´ä»¥ JSON å¯¹è±¡çš„å½¢å¼å®‰å…¨ä¼ é€’ä¿¡æ¯çš„æ–¹æ³•ã€‚JWT å¯ä»¥ä½¿ç”¨ HMAC ç®—æ³•æˆ–è€…æ˜¯ RSA çš„å…¬é’¥å¯†é’¥å¯¹è¿›è¡Œç­¾åã€‚å®ƒå…·å¤‡ä¸¤ä¸ªç‰¹ç‚¹ï¼š
ç®€æ´(Compact)
å¯ä»¥é€šè¿‡URL, POST å‚æ•°æˆ–è€…åœ¨ HTTP header å‘é€ï¼Œå› ä¸ºæ•°æ®é‡å°ï¼Œä¼ è¾“é€Ÿåº¦å¿«
è‡ªåŒ…å«(Self-contained)
è´Ÿè½½ä¸­åŒ…å«äº†æ‰€æœ‰ç”¨æˆ·æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œé¿å…äº†å¤šæ¬¡æŸ¥è¯¢æ•°æ®åº“
&lt;/code>&lt;/pre>
&lt;h2 id="jwt-ç»„æˆ">JWT ç»„æˆ&lt;/h2>
&lt;h3 id="header-å¤´éƒ¨">Header å¤´éƒ¨&lt;/h3>
&lt;pre>&lt;code>å¤´éƒ¨åŒ…å«äº†ä¸¤éƒ¨åˆ†ï¼Œtoken ç±»å‹å’Œé‡‡ç”¨çš„åŠ å¯†ç®—æ³•
&lt;/code>&lt;/pre>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;alg&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;HS256&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;typ&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;JWT&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;pre>&lt;code>å®ƒä¼šä½¿ç”¨ Base64 ç¼–ç ç»„æˆ JWT ç»“æ„çš„ç¬¬ä¸€éƒ¨åˆ†,å¦‚æœä½ ä½¿ç”¨Node.jsï¼Œå¯ä»¥ç”¨Node.jsçš„åŒ…base64urlæ¥å¾—åˆ°è¿™ä¸ªå­—ç¬¦ä¸²ã€‚
Base64æ˜¯ä¸€ç§ç¼–ç ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯å¯ä»¥è¢«ç¿»è¯‘å›åŸæ¥çš„æ ·å­æ¥çš„ã€‚å®ƒå¹¶ä¸æ˜¯ä¸€ç§åŠ å¯†è¿‡ç¨‹ã€‚
&lt;/code>&lt;/pre>
&lt;h3 id="payload-è´Ÿè½½">Payload è´Ÿè½½&lt;/h3>
&lt;pre>&lt;code>è¿™éƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬å­˜æ”¾ä¿¡æ¯çš„åœ°æ–¹äº†ï¼Œä½ å¯ä»¥æŠŠç”¨æˆ· ID ç­‰ä¿¡æ¯æ”¾åœ¨è¿™é‡Œï¼ŒJWT è§„èŒƒé‡Œé¢å¯¹è¿™éƒ¨åˆ†æœ‰è¿›è¡Œäº†æ¯”è¾ƒè¯¦ç»†çš„ä»‹ç»ï¼Œå¸¸ç”¨çš„ç”± issï¼ˆç­¾å‘è€…ï¼‰ï¼Œexpï¼ˆè¿‡æœŸæ—¶é—´ï¼‰ï¼Œsubï¼ˆé¢å‘çš„ç”¨æˆ·ï¼‰ï¼Œaudï¼ˆæ¥æ”¶æ–¹ï¼‰ï¼Œiatï¼ˆç­¾å‘æ—¶é—´ï¼‰ã€‚
&lt;/code>&lt;/pre>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;iss&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;lion1ou JWT&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;iat&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">1441593502&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;exp&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">1441594722&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;aud&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;www.example.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;sub&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;lion1ou@163.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;pre>&lt;code>åŒæ ·çš„ï¼Œå®ƒä¼šä½¿ç”¨ Base64 ç¼–ç ç»„æˆ JWT ç»“æ„çš„ç¬¬äºŒéƒ¨åˆ†
&lt;/code>&lt;/pre>
&lt;h3 id="signature-ç­¾å">Signature ç­¾å&lt;/h3>
&lt;pre>&lt;code>å‰é¢ä¸¤éƒ¨åˆ†éƒ½æ˜¯ä½¿ç”¨ Base64 è¿›è¡Œç¼–ç çš„ï¼Œå³å‰ç«¯å¯ä»¥è§£å¼€çŸ¥é“é‡Œé¢çš„ä¿¡æ¯ã€‚Signature éœ€è¦ä½¿ç”¨ç¼–ç åçš„ header å’Œ payload ä»¥åŠæˆ‘ä»¬æä¾›çš„ä¸€ä¸ªå¯†é’¥ï¼Œç„¶åä½¿ç”¨ header ä¸­æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆHS256ï¼‰è¿›è¡Œç­¾åã€‚ç­¾åçš„ä½œç”¨æ˜¯ä¿è¯ JWT æ²¡æœ‰è¢«ç¯¡æ”¹è¿‡ã€‚
ä¸‰ä¸ªéƒ¨åˆ†é€šè¿‡.è¿æ¥åœ¨ä¸€èµ·å°±æ˜¯æˆ‘ä»¬çš„ JWT äº†ï¼Œå®ƒå¯èƒ½é•¿è¿™ä¸ªæ ·å­ï¼Œé•¿åº¦è²Œä¼¼å’Œä½ çš„åŠ å¯†ç®—æ³•å’Œç§é’¥æœ‰å…³ç³»
```text
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjU3ZmVmMTY0ZTU0YWY2NGZmYzUzZGJkNSIsInhzcmYiOiI0ZWE1YzUwOGE2NTY2ZTc2MjQwNTQzZjhmZWIwNmZkNDU3Nzc3YmUzOTU0OWM0MDE2NDM2YWZkYTY1ZDIzMzBlIiwiaWF0IjoxNDc2NDI3OTMzfQ.PA3QjeyZSUh7H0GfE0vJaKW4LjKJuC3dVLQiY4hii8s
```
å…¶å®åˆ°è¿™ä¸€æ­¥å¯èƒ½å°±æœ‰äººä¼šæƒ³äº†ï¼ŒHTTP è¯·æ±‚æ€»ä¼šå¸¦ä¸Š tokenï¼Œè¿™æ ·è¿™ä¸ª token ä¼ æ¥ä¼ å»å ç”¨ä¸å¿…è¦çš„å¸¦å®½å•Šã€‚å¦‚æœä½ è¿™ä¹ˆæƒ³äº†ï¼Œé‚£ä½ å¯ä»¥å»äº†è§£ä¸‹ HTTP2ï¼ŒHTTP2 å¯¹å¤´éƒ¨è¿›è¡Œäº†å‹ç¼©ï¼Œç›¸ä¿¡ä¹Ÿè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚
&lt;/code>&lt;/pre>
&lt;h3 id="ç­¾åçš„ç›®çš„">ç­¾åçš„ç›®çš„&lt;/h3>
&lt;pre>&lt;code>æœ€åä¸€æ­¥ç­¾åçš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šæ˜¯å¯¹å¤´éƒ¨ä»¥åŠè´Ÿè½½å†…å®¹è¿›è¡Œç­¾åï¼Œé˜²æ­¢å†…å®¹è¢«çªœæ”¹ã€‚å¦‚æœæœ‰äººå¯¹å¤´éƒ¨ä»¥åŠè´Ÿè½½çš„å†…å®¹è§£ç ä¹‹åè¿›è¡Œä¿®æ”¹ï¼Œå†è¿›è¡Œç¼–ç ï¼Œæœ€ååŠ ä¸Šä¹‹å‰çš„ç­¾åç»„åˆå½¢æˆæ–°çš„JWTçš„è¯ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ç«¯ä¼šåˆ¤æ–­å‡ºæ–°çš„å¤´éƒ¨å’Œè´Ÿè½½å½¢æˆçš„ç­¾åå’ŒJWTé™„å¸¦ä¸Šçš„ç­¾åæ˜¯ä¸ä¸€æ ·çš„ã€‚å¦‚æœè¦å¯¹æ–°çš„å¤´éƒ¨å’Œè´Ÿè½½è¿›è¡Œç­¾åï¼Œåœ¨ä¸çŸ¥é“æœåŠ¡å™¨åŠ å¯†æ—¶ç”¨çš„å¯†é’¥çš„è¯ï¼Œå¾—å‡ºæ¥çš„ç­¾åä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚
&lt;/code>&lt;/pre>
&lt;h3 id="ä¿¡æ¯æš´éœ²">ä¿¡æ¯æš´éœ²&lt;/h3>
&lt;pre>&lt;code>åœ¨è¿™é‡Œå¤§å®¶ä¸€å®šä¼šé—®ä¸€ä¸ªé—®é¢˜ï¼šBase64æ˜¯ä¸€ç§ç¼–ç ï¼Œæ˜¯å¯é€†çš„ï¼Œé‚£ä¹ˆæˆ‘çš„ä¿¡æ¯ä¸å°±è¢«æš´éœ²äº†å—ï¼Ÿ
æ˜¯çš„ã€‚æ‰€ä»¥ï¼Œåœ¨JWTä¸­ï¼Œä¸åº”è¯¥åœ¨è´Ÿè½½é‡Œé¢åŠ å…¥ä»»ä½•æ•æ„Ÿçš„æ•°æ®ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼ è¾“çš„æ˜¯ç”¨æˆ·çš„User IDã€‚è¿™ä¸ªå€¼å®é™…ä¸Šä¸æ˜¯ä»€ä¹ˆæ•æ„Ÿå†…å®¹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¢«çŸ¥é“ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚ä½†æ˜¯åƒå¯†ç è¿™æ ·çš„å†…å®¹å°±ä¸èƒ½è¢«æ”¾åœ¨JWTä¸­äº†ã€‚å¦‚æœå°†ç”¨æˆ·çš„å¯†ç æ”¾åœ¨äº†JWTä¸­ï¼Œé‚£ä¹ˆæ€€æœ‰æ¶æ„çš„ç¬¬ä¸‰æ–¹é€šè¿‡Base64è§£ç å°±èƒ½å¾ˆå¿«åœ°çŸ¥é“ä½ çš„å¯†ç äº†ã€‚
å› æ­¤JWTé€‚åˆç”¨äºå‘Webåº”ç”¨ä¼ é€’ä¸€äº›éæ•æ„Ÿä¿¡æ¯ã€‚JWTè¿˜ç»å¸¸ç”¨äºè®¾è®¡ç”¨æˆ·è®¤è¯å’Œæˆæƒç³»ç»Ÿï¼Œç”šè‡³å®ç°Webåº”ç”¨çš„å•ç‚¹ç™»å½•ã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="jwt-ä½¿ç”¨">JWT ä½¿ç”¨&lt;/h2>
&lt;pre>&lt;code>1.é¦–å…ˆï¼Œå‰ç«¯é€šè¿‡Webè¡¨å•å°†è‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç å‘é€åˆ°åç«¯çš„æ¥å£ã€‚è¿™ä¸€è¿‡ç¨‹ä¸€èˆ¬æ˜¯ä¸€ä¸ªHTTP POSTè¯·æ±‚ã€‚å»ºè®®çš„æ–¹å¼æ˜¯é€šè¿‡SSLåŠ å¯†çš„ä¼ è¾“ï¼ˆhttpsåè®®ï¼‰ï¼Œä»è€Œé¿å…æ•æ„Ÿä¿¡æ¯è¢«å—…æ¢ã€‚
2.åç«¯æ ¸å¯¹ç”¨æˆ·åå’Œå¯†ç æˆåŠŸåï¼Œå°†ç”¨æˆ·çš„idç­‰å…¶ä»–ä¿¡æ¯ä½œä¸ºJWT Payloadï¼ˆè´Ÿè½½ï¼‰ï¼Œå°†å…¶ä¸å¤´éƒ¨åˆ†åˆ«è¿›è¡ŒBase64ç¼–ç æ‹¼æ¥åç­¾åï¼Œå½¢æˆä¸€ä¸ªJWTã€‚å½¢æˆçš„JWTå°±æ˜¯ä¸€ä¸ªå½¢åŒlll.zzz.xxxçš„å­—ç¬¦ä¸²ã€‚
3.åç«¯å°†JWTå­—ç¬¦ä¸²ä½œä¸ºç™»å½•æˆåŠŸçš„è¿”å›ç»“æœè¿”å›ç»™å‰ç«¯ã€‚å‰ç«¯å¯ä»¥å°†è¿”å›çš„ç»“æœä¿å­˜åœ¨localStorageæˆ–sessionStorageä¸Šï¼Œé€€å‡ºç™»å½•æ—¶å‰ç«¯åˆ é™¤ä¿å­˜çš„JWTå³å¯ã€‚
4.å‰ç«¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶å°†JWTæ”¾å…¥HTTP Headerä¸­çš„Authorizationä½ã€‚(è§£å†³XSSå’ŒXSRFé—®é¢˜)
5.åç«¯æ£€æŸ¥æ˜¯å¦å­˜åœ¨ï¼Œå¦‚å­˜åœ¨éªŒè¯JWTçš„æœ‰æ•ˆæ€§ã€‚ä¾‹å¦‚ï¼Œæ£€æŸ¥ç­¾åæ˜¯å¦æ­£ç¡®ï¼›æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸï¼›æ£€æŸ¥Tokençš„æ¥æ”¶æ–¹æ˜¯å¦æ˜¯è‡ªå·±ï¼ˆå¯é€‰ï¼‰ã€‚
6.éªŒè¯é€šè¿‡ååç«¯ä½¿ç”¨JWTä¸­åŒ…å«çš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œå…¶ä»–é€»è¾‘æ“ä½œï¼Œè¿”å›ç›¸åº”ç»“æœã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="å’Œsessionæ–¹å¼å­˜å‚¨idçš„å·®å¼‚">å’ŒSessionæ–¹å¼å­˜å‚¨idçš„å·®å¼‚&lt;/h2>
&lt;pre>&lt;code>Sessionæ–¹å¼å­˜å‚¨ç”¨æˆ·idçš„æœ€å¤§å¼Šç—…åœ¨äºSessionæ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„ï¼Œæ‰€ä»¥éœ€è¦å ç”¨å¤§é‡æœåŠ¡å™¨å†…å­˜ï¼Œå¯¹äºè¾ƒå¤§å‹åº”ç”¨è€Œè¨€å¯èƒ½è¿˜è¦ä¿å­˜è®¸å¤šçš„çŠ¶æ€ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå¤§å‹åº”ç”¨è¿˜éœ€è¦å€ŸåŠ©ä¸€äº›KVæ•°æ®åº“å’Œä¸€ç³»åˆ—ç¼“å­˜æœºåˆ¶æ¥å®ç°Sessionçš„å­˜å‚¨ã€‚
è€ŒJWTæ–¹å¼å°†ç”¨æˆ·çŠ¶æ€åˆ†æ•£åˆ°äº†å®¢æˆ·ç«¯ä¸­ï¼Œå¯ä»¥æ˜æ˜¾å‡è½»æœåŠ¡ç«¯çš„å†…å­˜å‹åŠ›ã€‚é™¤äº†ç”¨æˆ·idä¹‹å¤–ï¼Œè¿˜å¯ä»¥å­˜å‚¨å…¶ä»–çš„å’Œç”¨æˆ·ç›¸å…³çš„ä¿¡æ¯ï¼Œä¾‹å¦‚è¯¥ç”¨æˆ·æ˜¯å¦æ˜¯ç®¡ç†å‘˜ã€ç”¨æˆ·æ‰€åœ¨çš„åˆ†ç»„ç­‰ã€‚è™½è¯´JWTæ–¹å¼è®©æœåŠ¡å™¨æœ‰ä¸€äº›è®¡ç®—å‹åŠ›ï¼ˆä¾‹å¦‚åŠ å¯†ã€ç¼–ç å’Œè§£ç ï¼‰ï¼Œä½†æ˜¯è¿™äº›å‹åŠ›ç›¸æ¯”ç£ç›˜å­˜å‚¨è€Œè¨€å¯èƒ½å°±ä¸ç®—ä»€ä¹ˆäº†ã€‚å…·ä½“æ˜¯å¦é‡‡ç”¨ï¼Œéœ€è¦åœ¨ä¸åŒåœºæ™¯ä¸‹ç”¨æ•°æ®è¯´è¯ã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="å•ç‚¹ç™»å½•">å•ç‚¹ç™»å½•&lt;/h2>
&lt;pre>&lt;code>Sessionæ–¹å¼æ¥å­˜å‚¨ç”¨æˆ·idï¼Œä¸€å¼€å§‹ç”¨æˆ·çš„Sessionåªä¼šå­˜å‚¨åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šã€‚å¯¹äºæœ‰å¤šä¸ªå­åŸŸåçš„ç«™ç‚¹ï¼Œæ¯ä¸ªå­åŸŸåè‡³å°‘ä¼šå¯¹åº”ä¸€å°ä¸åŒçš„æœåŠ¡å™¨ï¼Œä¾‹å¦‚ï¼šwww.taobao.comï¼Œnv.taobao.comï¼Œnz.taobao.comï¼Œlogin.taobao.comã€‚æ‰€ä»¥å¦‚æœè¦å®ç°åœ¨login.taobao.comç™»å½•åï¼Œåœ¨å…¶ä»–çš„å­åŸŸåä¸‹ä¾ç„¶å¯ä»¥å–åˆ°Sessionï¼Œè¿™è¦æ±‚æˆ‘ä»¬åœ¨å¤šå°æœåŠ¡å™¨ä¸ŠåŒæ­¥Sessionã€‚ä½¿ç”¨JWTçš„æ–¹å¼åˆ™æ²¡æœ‰è¿™ä¸ªé—®é¢˜çš„å­˜åœ¨ï¼Œå› ä¸ºç”¨æˆ·çš„çŠ¶æ€å·²ç»è¢«ä¼ é€åˆ°äº†å®¢æˆ·ç«¯ã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="æ€»ç»“ä¼˜ç‚¹">æ€»ç»“ä¼˜ç‚¹&lt;/h2>
&lt;pre>&lt;code>ä¹Ÿå°±æ˜¯è¯´ç›¸æ¯”äºä¼ ç»ŸåŸºäºcookieçš„sessionï¼ŒåŸºäºtokençš„jwtæœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š
Cookieæ˜¯ä¸å…è®¸å®åŸŸè®¿é—®çš„ï¼Œè¿™ä¸€ç‚¹å¯¹Tokenæœºåˆ¶æ˜¯ä¸å­˜åœ¨çš„ï¼Œå‰ææ˜¯ä¼ è¾“çš„ç”¨æˆ·è®¤è¯ä¿¡æ¯é€šè¿‡HTTPå¤´ä¼ è¾“.
æ— çŠ¶æ€(ä¹Ÿç§°ï¼šæœåŠ¡ç«¯å¯æ‰©å±•è¡Œ):Tokenæœºåˆ¶åœ¨æœåŠ¡ç«¯ä¸éœ€è¦å­˜å‚¨sessionä¿¡æ¯ï¼Œå› ä¸ºToken è‡ªèº«åŒ…å«äº†æ‰€æœ‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ï¼Œåªéœ€è¦åœ¨å®¢æˆ·ç«¯çš„cookieæˆ–æœ¬åœ°ä»‹è´¨å­˜å‚¨çŠ¶æ€ä¿¡æ¯.
æ›´é€‚ç”¨CDN: å¯ä»¥é€šè¿‡å†…å®¹åˆ†å‘ç½‘ç»œè¯·æ±‚ä½ æœåŠ¡ç«¯çš„æ‰€æœ‰èµ„æ–™ï¼ˆå¦‚ï¼šjavascriptï¼ŒHTML,å›¾ç‰‡ç­‰ï¼‰ï¼Œè€Œä½ çš„æœåŠ¡ç«¯åªè¦æä¾›APIå³å¯.
å»è€¦: ä¸éœ€è¦ç»‘å®šåˆ°ä¸€ä¸ªç‰¹å®šçš„èº«ä»½éªŒè¯æ–¹æ¡ˆã€‚Tokenå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ç”Ÿæˆï¼Œåªè¦åœ¨ä½ çš„APIè¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä½ å¯ä»¥è¿›è¡ŒTokenç”Ÿæˆè°ƒç”¨å³å¯.
æ›´é€‚ç”¨äºç§»åŠ¨åº”ç”¨: å½“ä½ çš„å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªåŸç”Ÿå¹³å°ï¼ˆiOS, Androidï¼ŒWindows 8ç­‰ï¼‰æ—¶ï¼ŒCookieæ˜¯ä¸è¢«æ”¯æŒçš„ï¼ˆä½ éœ€è¦é€šè¿‡Cookieå®¹å™¨è¿›è¡Œå¤„ç†ï¼‰ï¼Œè¿™æ—¶é‡‡ç”¨Tokenè®¤è¯æœºåˆ¶å°±ä¼šç®€å•å¾—å¤šã€‚
CSRF:å› ä¸ºä¸å†ä¾èµ–äºCookieï¼Œæ‰€ä»¥ä½ å°±ä¸éœ€è¦è€ƒè™‘å¯¹CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰çš„é˜²èŒƒã€‚
æ€§èƒ½: ä¸€æ¬¡ç½‘ç»œå¾€è¿”æ—¶é—´ï¼ˆé€šè¿‡æ•°æ®åº“æŸ¥è¯¢sessionä¿¡æ¯ï¼‰æ€»æ¯”åšä¸€æ¬¡HMACSHA256è®¡ç®— çš„TokenéªŒè¯å’Œè§£æè¦è´¹æ—¶å¾—å¤š.
ä¸éœ€è¦ä¸ºç™»å½•é¡µé¢åšç‰¹æ®Šå¤„ç†: å¦‚æœä½ ä½¿ç”¨Protractor åšåŠŸèƒ½æµ‹è¯•çš„æ—¶å€™ï¼Œä¸å†éœ€è¦ä¸ºç™»å½•é¡µé¢åšç‰¹æ®Šå¤„ç†.
åŸºäºæ ‡å‡†åŒ–:ä½ çš„APIå¯ä»¥é‡‡ç”¨æ ‡å‡†åŒ–çš„ JSON Web Token (JWT). è¿™ä¸ªæ ‡å‡†å·²ç»å­˜åœ¨å¤šä¸ªåç«¯åº“ï¼ˆ.NET, Ruby, Java,Python, PHPï¼‰å’Œå¤šå®¶å…¬å¸çš„æ”¯æŒï¼ˆå¦‚ï¼šFirebase,Google, Microsoftï¼‰.&lt;/code>&lt;/pre></description></item><item><title>TOKENéªŒè¯è¯¦è§£</title><link>https://sunnnner.github.io/token%E9%AA%8C%E8%AF%81%E8%AF%A6%E8%A7%A3/</link><pubDate>Tue, 01 Oct 2019 14:03:37 +0800</pubDate><guid>https://sunnnner.github.io/token%E9%AA%8C%E8%AF%81%E8%AF%A6%E8%A7%A3/</guid><description>&lt;h1 id="ä¸ºä»€ä¹ˆä½¿ç”¨tokenéªŒè¯">ä¸ºä»€ä¹ˆä½¿ç”¨tokenéªŒè¯&lt;/h1>
&lt;ul>
&lt;li>åœ¨webé¢†åŸŸåŸºäºtokençš„èº«ä»½éªŒè¯éšå¤„å¯å˜ï¼Œåœ¨å¤§å¤šè¯´ä½¿ç”¨web APIçš„äº’è”ç½‘å…¬å¸ä¸­ï¼Œtokensæ˜¯å¤šç”¨æˆ·ä¸‹å¤„ç†è®¤è¯çš„æœ€ä½³æ–¹å¼&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸€ä¸‹å‡ ç‚¹ç‰¹æ€§ä¼šè®©ä½ åœ¨ç¨‹åºä¸­ä½¿ç”¨åŸºäºtoken-çš„èº«ä»½éªŒè¯">ä¸€ä¸‹å‡ ç‚¹ç‰¹æ€§ä¼šè®©ä½ åœ¨ç¨‹åºä¸­ä½¿ç”¨åŸºäºToken çš„èº«ä»½éªŒè¯&lt;/h2>
&lt;ul>
&lt;li>æ— çŠ¶æ€ã€å¯æ‰©å±•&lt;/li>
&lt;li>æ”¯æŒç§»åŠ¨è®¾å¤‡&lt;/li>
&lt;li>è·¨ç¨‹åºè°ƒç”¨&lt;/li>
&lt;li>å®‰å…¨&lt;/li>
&lt;li>é‚£äº›ä½¿ç”¨åŸºäºTokençš„èº«ä»½éªŒè¯çš„å¤§ä½¬ä»¬&lt;/li>
&lt;li>å¤§éƒ¨åˆ†ä½ è§åˆ°è¿‡çš„APIå’ŒWEBåº”ç”¨éƒ½æ˜¯ç”¨tokensï¼Œåˆ—å¦‚facebook, twitter, google+, githubç­‰&lt;/li>
&lt;/ul>
&lt;h2 id="tokençš„èµ·æº">Tokençš„èµ·æº&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>åœ¨ä»‹ç»åŸºäºtokençš„èº«ä»½éªŒè¯çš„åŸç†ä¸ä¼˜åŠ¿ä¹‹å‰ï¼Œä¸å¦¨å…ˆçœ‹çœ‹ä¹‹å‰çš„è®¤è¯éƒ½æ˜¯æ€ä¹ˆåšçš„&lt;/p>
&lt;pre>&lt;code> åŸºäºæœåŠ¡å™¨çš„éªŒè¯
æˆ‘ä»¬éƒ½æ˜¯çŸ¥é“HTTPåè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œè¿™ç§æ— çŠ¶æ€æ„å‘³ç€ç¨‹åºéœ€è¦éªŒè¯æ¯ä¸€æ¬¡è¯·æ±‚ï¼Œä»è€Œè¾¨åˆ«å®¢æˆ·ç«¯çš„èº«ä»½ã€‚
åœ¨è¿™ä¹‹å‰ï¼Œç¨‹åºéƒ½æ˜¯é€šè¿‡åœ¨æœåŠ¡ç«¯å­˜å‚¨çš„ç™»å½•ä¿¡æ¯æ¥è¾¨åˆ«è¯·æ±‚çš„ã€‚è¿™ç§æ–¹å¼ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡å­˜å‚¨Sessionæ¥å®Œæˆã€‚
éšç€Webï¼Œåº”ç”¨ç¨‹åºï¼Œå·²ç»ç§»åŠ¨ç«¯çš„å…´èµ·ï¼Œè¿™ç§éªŒè¯çš„æ–¹å¼é€æ¸æš´éœ²å‡ºäº†é—®é¢˜ã€‚å°¤å…¶æ˜¯åœ¨å¯æ‰©å±•æ€§æ–¹é¢ã€‚
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h2 id="åŸºäºæœåŠ¡å™¨çš„éªŒè¯æ–¹å¼æš´éœ²çš„ä¸€äº›é—®é¢˜">åŸºäºæœåŠ¡å™¨çš„éªŒè¯æ–¹å¼æš´éœ²çš„ä¸€äº›é—®é¢˜&lt;/h2>
&lt;pre>&lt;code>1ã€sessionï¼šæ¯æ¬¡è®¤è¯ç”¨æˆ·å‘èµ·è¯·æ±‚æ—¶ï¼Œ æœåŠ¡å™¨éœ€è¦å»åˆ›å»ºä¸€ä¸ªè®°å½•æ¥å­˜å‚¨ä¿¡æ¯ï¼Œ å½“è¶Šæ¥è¶Šå¤šçš„ç”¨æˆ·å‘è¯·æ±‚æ—¶ï¼Œ å†…å­˜çš„å¼€é”€ä¹Ÿä¼šä¸æ–­å¢åŠ 
2ã€å¯è·æŒ¯å…´ï¼šåœ¨æœåŠ¡ç«¯çš„å†…å­˜ä¸­ä½¿ç”¨sessionå­˜å‚¨çš„ç™»å½•ä¿¡æ¯ï¼ŒåŠæ‰€è€Œæ¥çš„æ˜¯å¯æ‰©å±•æ€§é—®é¢˜
3ã€CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰ï¼š å½“æˆ‘ä»¬éœ€è¦è®©æ•°æ®è·¨å¤šå°ç§»åŠ¨è®¾å¤‡ä¸Šä½¿ç”¨æ—¶ï¼Œ è·¨åŸŸèµ„æºå…±äº«å›äº‹ä¸€ä¸ªè®©äººå¤´ç–¼çš„é—®é¢˜ï¼Œ åœ¨ä½¿ç”¨ajaxæŠ“å–å¦ä¸€ä¸ªåŸŸçš„èµ„æºï¼Œå°±å¯ä»¥ä¼šå‡ºç°ç¦æ­¢è¯·æ±‚çš„æƒ…å†µ
4ã€CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ï¼š ç”¨æˆ·åœ¨è®¿é—®é“¶è¡Œç½‘ç«™æ—¶ï¼Œ ä»–ä»¬å¾ˆå®¹æ˜“å—åˆ°è·¨ç«™è¯·æ±‚ä¼ªé€ çš„æ”»å‡»ï¼Œ å¹¶ä¸”èƒ½å¤Ÿè¢«åˆ©ç”¨å…¶è®¿é—®å…¶ä»–ç½‘ç«™
åœ¨è¿™äº›é—®é¢˜ä¸­ï¼Œå¯æ‰©å±•æ€§æ˜¯æœ€çªå‡ºï¼Œå› æ­¤æˆ‘ä»¬æœ‰å¿…è¦å»å¯»æ±‚ä¸€ç§æ›´æœ‰è¡Œä¹‹æœ‰æ•ˆçš„æ–¹æ³•
&lt;/code>&lt;/pre>
&lt;h2 id="åŸºäºtokençš„éªŒè¯åŸç†">åŸºäºTOKENçš„éªŒè¯åŸç†&lt;/h2>
&lt;pre>&lt;code>åŸºäºTokençš„èº«ä»½éªŒè¯æ˜¯æ— çŠ¶æ€çš„ï¼Œæˆ‘ä»¬ä¸å°†ç”¨æˆ·ä¿¡æ¯å­˜åœ¨æœåŠ¡å™¨æˆ–Sessionä¸­ã€‚
è¿™ç§æ¦‚å¿µè§£å†³äº†åœ¨æœåŠ¡ç«¯å­˜å‚¨ä¿¡æ¯æ—¶çš„è®¸å¤šé—®é¢˜
ã€€ã€€NoSessionæ„å‘³ç€ä½ çš„ç¨‹åºå¯ä»¥æ ¹æ®éœ€è¦å»å¢å‡æœºå™¨ï¼Œè€Œä¸ç”¨å»æ‹…å¿ƒç”¨æˆ·æ˜¯å¦ç™»å½•ã€‚
åŸºäºTokençš„èº«ä»½éªŒè¯çš„è¿‡ç¨‹å¦‚ä¸‹:
1.ç”¨æˆ·é€šè¿‡ç”¨æˆ·åå’Œå¯†ç å‘é€è¯·æ±‚ã€‚
2.ç¨‹åºéªŒè¯ã€‚
3.ç¨‹åºè¿”å›ä¸€ä¸ªç­¾åçš„token ç»™å®¢æˆ·ç«¯ã€‚
4.å®¢æˆ·ç«¯å‚¨å­˜token,å¹¶ä¸”æ¯æ¬¡ç”¨äºæ¯æ¬¡å‘é€è¯·æ±‚ã€‚
5.æœåŠ¡ç«¯éªŒè¯tokenå¹¶è¿”å›æ•°æ®ã€‚
æ¯ä¸€æ¬¡è¯·æ±‚éƒ½éœ€è¦tokenã€‚tokenåº”è¯¥åœ¨HTTPçš„å¤´éƒ¨å‘é€ä»è€Œä¿è¯äº†Httpè¯·æ±‚æ— çŠ¶æ€ã€‚æˆ‘ä»¬åŒæ ·é€šè¿‡è®¾ç½®æœåŠ¡å™¨å±æ€§Access-Control-Allow-Origin:* ï¼Œè®©æœåŠ¡å™¨èƒ½æ¥å—åˆ°æ¥è‡ªæ‰€æœ‰åŸŸçš„è¯·æ±‚ã€‚éœ€è¦ä¸»è¦çš„æ˜¯ï¼Œåœ¨ACAOå¤´éƒ¨æ ‡æ˜(designating)*æ—¶ï¼Œä¸å¾—å¸¦æœ‰åƒHTTPè®¤è¯ï¼Œå®¢æˆ·ç«¯SSLè¯ä¹¦å’Œcookiesçš„è¯ä¹¦ã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="ä»£ç å®ä¾‹æµç¨‹">ä»£ç å®ä¾‹æµç¨‹ï¼š&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">username&lt;/span> &lt;span class="nx">pwd&lt;/span> &lt;span class="nx">client_type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//æ¥å£åˆ¤æ–­
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">token&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">uid&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">æŸ¥è¯¢tokenè¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">$token&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nx">where&lt;/span> &lt;span class="nx">uid&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="nx">uid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">$token&lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="nx">token&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ç™»å½•æˆåŠŸ&lt;/span>&lt;span class="err">ï¼ï¼&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">è¿”å›token&lt;/span> &lt;span class="nx">å’Œ&lt;/span> &lt;span class="nx">uid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ç™»å½•å¤±è´¥&lt;/span>&lt;span class="err">ï¼ï¼&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">usename&lt;/span> &lt;span class="nx">powd&lt;/span> &lt;span class="nx">client_type&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">æ£€éªŒç”¨æˆ·åå’Œå¯†ç &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="nx">æ­£ç¡®&lt;/span>&lt;span class="err">ï¼‰&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">å¾—åˆ°uid&lt;/span> &lt;span class="nx">å¹¶&lt;/span> &lt;span class="nx">ç”Ÿæˆtoken&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="nx">md5&lt;/span>&lt;span class="p">(&lt;/span> &lt;span class="nx">uid&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">pwd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">time&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="nx">è‡ªå·±å®šä¹‰è§„åˆ™&lt;/span> &lt;span class="p">)&lt;/span>&lt;span class="err">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">uidä¸å­˜åœ¨&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">into&lt;/span> &lt;span class="nx">token&lt;/span> &lt;span class="nx">è¡¨&lt;/span> &lt;span class="nx">id&lt;/span> &lt;span class="nx">uid&lt;/span> &lt;span class="nx">token&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">where&lt;/span> &lt;span class="nx">uid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nx">$uid&lt;/span> &lt;span class="nx">ä¿®æ”¹token&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">è¿”å›token&lt;/span> &lt;span class="nx">å’Œ&lt;/span> &lt;span class="nx">uid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">è¿”å›é”™è¯¯ä¿¡æ¯&lt;/span>&lt;span class="err">ï¼›&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å®¢æˆ·ç«¯cè¿›è¡Œæ–‡ä»¶å­˜å‚¨uid-å’Œtoken">å®¢æˆ·ç«¯cè¿›è¡Œæ–‡ä»¶å­˜å‚¨uid å’Œtoken&lt;/h2>
&lt;pre>&lt;code>ä¸‹æ¬¡å†æ¬¡ç™»å½•æ—¶ä½¿ç”¨uidå’Œtoken
å®ç°äº†ç”¨æˆ·ç™»å½•çš„äº’è¸¢
å½“æˆ‘ä»¬åœ¨ç¨‹åºä¸­è®¤è¯äº†ä¿¡æ¯å¹¶å–å¾—tokenä¹‹åï¼Œæˆ‘ä»¬ä¾¿èƒ½é€šè¿‡è¿™ä¸ªTokenåšè®¸å¤šçš„äº‹æƒ…ã€‚
æˆ‘ä»¬ç”šè‡³èƒ½åŸºäºåˆ›å»ºä¸€ä¸ªåŸºäºæƒé™çš„tokenä¼ ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºï¼Œè¿™äº›ç¬¬ä¸‰æ–¹ç¨‹åºèƒ½å¤Ÿè·å–åˆ°æˆ‘ä»¬çš„æ•°æ®ï¼ˆå½“ç„¶åªæœ‰åœ¨æˆ‘ä»¬å…è®¸çš„ç‰¹å®šçš„tokenï¼‰
&lt;/code>&lt;/pre>
&lt;h2 id="tokensçš„ä¼˜åŠ¿">Tokensçš„ä¼˜åŠ¿&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>æ— çŠ¶æ€ã€å¯æ‰©å±•&lt;/p>
&lt;pre>&lt;code> åœ¨å®¢æˆ·ç«¯å­˜å‚¨çš„Tokensæ˜¯æ— çŠ¶æ€çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢«æ‰©å±•ã€‚åŸºäºè¿™ç§æ— çŠ¶æ€å’Œä¸å­˜å‚¨Sessionä¿¡æ¯ï¼Œè´Ÿè½½è´Ÿè½½å‡è¡¡å™¨èƒ½å¤Ÿå°†ç”¨æˆ·ä¿¡æ¯ä»ä¸€ä¸ªæœåŠ¡ä¼ åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šã€‚
å¦‚æœæˆ‘ä»¬å°†å·²éªŒè¯çš„ç”¨æˆ·çš„ä¿¡æ¯ä¿å­˜åœ¨Sessionä¸­ï¼Œåˆ™æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦ç”¨æˆ·å‘å·²éªŒè¯çš„æœåŠ¡å™¨å‘é€éªŒè¯ä¿¡æ¯(ç§°ä¸ºSessionäº²å’Œæ€§)ã€‚ç”¨æˆ·é‡å¤§æ—¶ï¼Œå¯èƒ½ä¼šé€ æˆä¸€äº›æ‹¥å µã€‚ä½†æ˜¯ä¸è¦ç€æ€¥ã€‚ä½¿ç”¨tokensä¹‹åè¿™äº›é—®é¢˜éƒ½è¿åˆƒè€Œè§£ï¼Œå› ä¸ºtokensè‡ªå·±holdä½äº†ç”¨æˆ·çš„éªŒè¯ä¿¡æ¯ã€‚
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h2 id="å®‰å…¨æ€§">å®‰å…¨æ€§&lt;/h2>
&lt;pre>&lt;code>è¯·æ±‚ä¸­å‘é€tokenè€Œä¸å†æ˜¯å‘é€cookieèƒ½å¤Ÿé˜²æ­¢CSRF(è·¨ç«™è¯·æ±‚ä¼ªé€ )ã€‚å³ä½¿åœ¨å®¢æˆ·ç«¯ä½¿ç”¨cookieå­˜å‚¨tokenï¼Œcookieä¹Ÿä»…ä»…æ˜¯ä¸€ä¸ªå­˜å‚¨æœºåˆ¶è€Œä¸æ˜¯ç”¨äºè®¤è¯ã€‚ä¸å°†ä¿¡æ¯å­˜å‚¨åœ¨Sessionä¸­ï¼Œè®©æˆ‘ä»¬å°‘äº†å¯¹sessionæ“ä½œã€‚
tokenæ˜¯æœ‰æ—¶æ•ˆçš„ï¼Œä¸€æ®µæ—¶é—´ä¹‹åç”¨æˆ·éœ€è¦é‡æ–°éªŒè¯ã€‚æˆ‘ä»¬ä¹Ÿä¸ä¸€å®šéœ€è¦ç­‰åˆ°tokenè‡ªåŠ¨å¤±æ•ˆï¼Œtokenæœ‰æ’¤å›çš„æ“ä½œï¼Œé€šè¿‡token revocataionå¯ä»¥ä½¿ä¸€ä¸ªç‰¹å®šçš„tokenæˆ–æ˜¯ä¸€ç»„æœ‰ç›¸åŒè®¤è¯çš„tokenæ— æ•ˆã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="å¯æ‰©å±•æ€§">å¯æ‰©å±•æ€§ï¼ˆï¼‰&lt;/h2>
&lt;pre>&lt;code>Tokensèƒ½å¤Ÿåˆ›å»ºä¸å…¶å®ƒç¨‹åºå…±äº«æƒé™çš„ç¨‹åºã€‚ä¾‹å¦‚ï¼Œèƒ½å°†ä¸€ä¸ªéšä¾¿çš„ç¤¾äº¤å¸å·å’Œè‡ªå·±çš„å¤§å·(Fackbookæˆ–æ˜¯Twitter)è”ç³»èµ·æ¥ã€‚å½“é€šè¿‡æœåŠ¡ç™»å½•Twitter(æˆ‘ä»¬å°†è¿™ä¸ªè¿‡ç¨‹Buffer)æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›Bufferé™„åˆ°Twitterçš„æ•°æ®æµä¸Š(we are allowing Buffer to post to our Twitter stream)ã€‚
ä½¿ç”¨tokensæ—¶ï¼Œå¯ä»¥æä¾›å¯é€‰çš„æƒé™ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºã€‚å½“ç”¨æˆ·æƒ³è®©å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºè®¿é—®å®ƒä»¬çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å»ºç«‹è‡ªå·±çš„APIï¼Œå¾—å‡ºç‰¹æ®Šæƒé™çš„tokensã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="å¤šå¹³å°è·¨åŸŸ">å¤šå¹³å°è·¨åŸŸ&lt;/h2>
&lt;pre>&lt;code>æˆ‘ä»¬æå‰å…ˆæ¥è°ˆè®ºä¸€ä¸‹CORS(è·¨åŸŸèµ„æºå…±äº«)ï¼Œå¯¹åº”ç”¨ç¨‹åºå’ŒæœåŠ¡è¿›è¡Œæ‰©å±•çš„æ—¶å€™ï¼Œéœ€è¦ä»‹å…¥å„ç§å„ç§çš„è®¾å¤‡å’Œåº”ç”¨ç¨‹åºã€‚
Having our API just serve data, we can also make the design choice to serve assets from a CDN. This eliminates the issues that CORS brings up after we set a quick header configuration for our application.
åªè¦ç”¨æˆ·æœ‰ä¸€ä¸ªé€šè¿‡äº†éªŒè¯çš„tokenï¼Œæ•°æ®å’Œèµ„æºå°±èƒ½å¤Ÿåœ¨ä»»ä½•åŸŸä¸Šè¢«è¯·æ±‚åˆ°ã€‚
&lt;/code>&lt;/pre>
&lt;p>&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> Access&lt;!-- raw HTML omitted -->-Control&lt;!-- raw HTML omitted -->-Allow&lt;!-- raw HTML omitted -->-Origin&lt;!-- raw HTML omitted -->: &lt;!-- raw HTML omitted -->* &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p>
&lt;h2 id="åŸºäºæ ‡å‡†">åŸºäºæ ‡å‡†&lt;/h2>
&lt;pre>&lt;code>åˆ›å»ºtokençš„æ—¶å€™ï¼Œä½ å¯ä»¥è®¾å®šä¸€äº›é€‰é¡¹ã€‚æˆ‘ä»¬åœ¨åç»­çš„æ–‡ç« ä¸­ä¼šè¿›è¡Œæ›´åŠ è¯¦å°½çš„æè¿°ï¼Œä½†æ˜¯æ ‡å‡†çš„ç”¨æ³•ä¼šåœ¨JSON Web Tokensä½“ç°ã€‚
æœ€è¿‘çš„ç¨‹åºå’Œæ–‡æ¡£æ˜¯ä¾›ç»™JSON Web Tokensçš„ã€‚å®ƒæ”¯æŒä¼—å¤šçš„è¯­è¨€ã€‚è¿™æ„å‘³åœ¨æœªæ¥çš„ä½¿ç”¨ä¸­ä½ å¯ä»¥çœŸæ­£çš„è½¬æ¢ä½ çš„è®¤è¯æœºåˆ¶ã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;pre>&lt;code>è¿™ç¯‡æ–‡ç« ä»…ä»…æ˜¯ä»‹ç»äº†ä¸ºä»€ä¹ˆé€‰æ‹©åŸºäºTokençš„èº«ä»½éªŒè¯ï¼Œå¹¶ä¸”æ€æ ·ä½¿ç”¨å®ƒã€‚
&lt;/code>&lt;/pre></description></item><item><title>TOKENéªŒè¯è¯¦è§£</title><link>https://sunnnner.github.io/p/token%E9%AA%8C%E8%AF%81%E8%AF%A6%E8%A7%A3/</link><pubDate>Tue, 01 Oct 2019 14:03:37 +0800</pubDate><guid>https://sunnnner.github.io/p/token%E9%AA%8C%E8%AF%81%E8%AF%A6%E8%A7%A3/</guid><description>&lt;h1 id="ä¸ºä»€ä¹ˆä½¿ç”¨tokenéªŒè¯">ä¸ºä»€ä¹ˆä½¿ç”¨tokenéªŒè¯&lt;/h1>
&lt;ul>
&lt;li>åœ¨webé¢†åŸŸåŸºäºtokençš„èº«ä»½éªŒè¯éšå¤„å¯å˜ï¼Œåœ¨å¤§å¤šè¯´ä½¿ç”¨web APIçš„äº’è”ç½‘å…¬å¸ä¸­ï¼Œtokensæ˜¯å¤šç”¨æˆ·ä¸‹å¤„ç†è®¤è¯çš„æœ€ä½³æ–¹å¼&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸€ä¸‹å‡ ç‚¹ç‰¹æ€§ä¼šè®©ä½ åœ¨ç¨‹åºä¸­ä½¿ç”¨åŸºäºtoken-çš„èº«ä»½éªŒè¯">ä¸€ä¸‹å‡ ç‚¹ç‰¹æ€§ä¼šè®©ä½ åœ¨ç¨‹åºä¸­ä½¿ç”¨åŸºäºToken çš„èº«ä»½éªŒè¯&lt;/h2>
&lt;ul>
&lt;li>æ— çŠ¶æ€ã€å¯æ‰©å±•&lt;/li>
&lt;li>æ”¯æŒç§»åŠ¨è®¾å¤‡&lt;/li>
&lt;li>è·¨ç¨‹åºè°ƒç”¨&lt;/li>
&lt;li>å®‰å…¨&lt;/li>
&lt;li>é‚£äº›ä½¿ç”¨åŸºäºTokençš„èº«ä»½éªŒè¯çš„å¤§ä½¬ä»¬&lt;/li>
&lt;li>å¤§éƒ¨åˆ†ä½ è§åˆ°è¿‡çš„APIå’ŒWEBåº”ç”¨éƒ½æ˜¯ç”¨tokensï¼Œåˆ—å¦‚facebook, twitter, google+, githubç­‰&lt;/li>
&lt;/ul>
&lt;h2 id="tokençš„èµ·æº">Tokençš„èµ·æº&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>åœ¨ä»‹ç»åŸºäºtokençš„èº«ä»½éªŒè¯çš„åŸç†ä¸ä¼˜åŠ¿ä¹‹å‰ï¼Œä¸å¦¨å…ˆçœ‹çœ‹ä¹‹å‰çš„è®¤è¯éƒ½æ˜¯æ€ä¹ˆåšçš„&lt;/p>
&lt;pre>&lt;code> åŸºäºæœåŠ¡å™¨çš„éªŒè¯
æˆ‘ä»¬éƒ½æ˜¯çŸ¥é“HTTPåè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œè¿™ç§æ— çŠ¶æ€æ„å‘³ç€ç¨‹åºéœ€è¦éªŒè¯æ¯ä¸€æ¬¡è¯·æ±‚ï¼Œä»è€Œè¾¨åˆ«å®¢æˆ·ç«¯çš„èº«ä»½ã€‚
åœ¨è¿™ä¹‹å‰ï¼Œç¨‹åºéƒ½æ˜¯é€šè¿‡åœ¨æœåŠ¡ç«¯å­˜å‚¨çš„ç™»å½•ä¿¡æ¯æ¥è¾¨åˆ«è¯·æ±‚çš„ã€‚è¿™ç§æ–¹å¼ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡å­˜å‚¨Sessionæ¥å®Œæˆã€‚
éšç€Webï¼Œåº”ç”¨ç¨‹åºï¼Œå·²ç»ç§»åŠ¨ç«¯çš„å…´èµ·ï¼Œè¿™ç§éªŒè¯çš„æ–¹å¼é€æ¸æš´éœ²å‡ºäº†é—®é¢˜ã€‚å°¤å…¶æ˜¯åœ¨å¯æ‰©å±•æ€§æ–¹é¢ã€‚
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h2 id="åŸºäºæœåŠ¡å™¨çš„éªŒè¯æ–¹å¼æš´éœ²çš„ä¸€äº›é—®é¢˜">åŸºäºæœåŠ¡å™¨çš„éªŒè¯æ–¹å¼æš´éœ²çš„ä¸€äº›é—®é¢˜&lt;/h2>
&lt;pre>&lt;code>1ã€sessionï¼šæ¯æ¬¡è®¤è¯ç”¨æˆ·å‘èµ·è¯·æ±‚æ—¶ï¼Œ æœåŠ¡å™¨éœ€è¦å»åˆ›å»ºä¸€ä¸ªè®°å½•æ¥å­˜å‚¨ä¿¡æ¯ï¼Œ å½“è¶Šæ¥è¶Šå¤šçš„ç”¨æˆ·å‘è¯·æ±‚æ—¶ï¼Œ å†…å­˜çš„å¼€é”€ä¹Ÿä¼šä¸æ–­å¢åŠ 
2ã€å¯è·æŒ¯å…´ï¼šåœ¨æœåŠ¡ç«¯çš„å†…å­˜ä¸­ä½¿ç”¨sessionå­˜å‚¨çš„ç™»å½•ä¿¡æ¯ï¼ŒåŠæ‰€è€Œæ¥çš„æ˜¯å¯æ‰©å±•æ€§é—®é¢˜
3ã€CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰ï¼š å½“æˆ‘ä»¬éœ€è¦è®©æ•°æ®è·¨å¤šå°ç§»åŠ¨è®¾å¤‡ä¸Šä½¿ç”¨æ—¶ï¼Œ è·¨åŸŸèµ„æºå…±äº«å›äº‹ä¸€ä¸ªè®©äººå¤´ç–¼çš„é—®é¢˜ï¼Œ åœ¨ä½¿ç”¨ajaxæŠ“å–å¦ä¸€ä¸ªåŸŸçš„èµ„æºï¼Œå°±å¯ä»¥ä¼šå‡ºç°ç¦æ­¢è¯·æ±‚çš„æƒ…å†µ
4ã€CSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ï¼š ç”¨æˆ·åœ¨è®¿é—®é“¶è¡Œç½‘ç«™æ—¶ï¼Œ ä»–ä»¬å¾ˆå®¹æ˜“å—åˆ°è·¨ç«™è¯·æ±‚ä¼ªé€ çš„æ”»å‡»ï¼Œ å¹¶ä¸”èƒ½å¤Ÿè¢«åˆ©ç”¨å…¶è®¿é—®å…¶ä»–ç½‘ç«™
åœ¨è¿™äº›é—®é¢˜ä¸­ï¼Œå¯æ‰©å±•æ€§æ˜¯æœ€çªå‡ºï¼Œå› æ­¤æˆ‘ä»¬æœ‰å¿…è¦å»å¯»æ±‚ä¸€ç§æ›´æœ‰è¡Œä¹‹æœ‰æ•ˆçš„æ–¹æ³•
&lt;/code>&lt;/pre>
&lt;h2 id="åŸºäºtokençš„éªŒè¯åŸç†">åŸºäºTOKENçš„éªŒè¯åŸç†&lt;/h2>
&lt;pre>&lt;code>åŸºäºTokençš„èº«ä»½éªŒè¯æ˜¯æ— çŠ¶æ€çš„ï¼Œæˆ‘ä»¬ä¸å°†ç”¨æˆ·ä¿¡æ¯å­˜åœ¨æœåŠ¡å™¨æˆ–Sessionä¸­ã€‚
è¿™ç§æ¦‚å¿µè§£å†³äº†åœ¨æœåŠ¡ç«¯å­˜å‚¨ä¿¡æ¯æ—¶çš„è®¸å¤šé—®é¢˜
ã€€ã€€NoSessionæ„å‘³ç€ä½ çš„ç¨‹åºå¯ä»¥æ ¹æ®éœ€è¦å»å¢å‡æœºå™¨ï¼Œè€Œä¸ç”¨å»æ‹…å¿ƒç”¨æˆ·æ˜¯å¦ç™»å½•ã€‚
åŸºäºTokençš„èº«ä»½éªŒè¯çš„è¿‡ç¨‹å¦‚ä¸‹:
1.ç”¨æˆ·é€šè¿‡ç”¨æˆ·åå’Œå¯†ç å‘é€è¯·æ±‚ã€‚
2.ç¨‹åºéªŒè¯ã€‚
3.ç¨‹åºè¿”å›ä¸€ä¸ªç­¾åçš„token ç»™å®¢æˆ·ç«¯ã€‚
4.å®¢æˆ·ç«¯å‚¨å­˜token,å¹¶ä¸”æ¯æ¬¡ç”¨äºæ¯æ¬¡å‘é€è¯·æ±‚ã€‚
5.æœåŠ¡ç«¯éªŒè¯tokenå¹¶è¿”å›æ•°æ®ã€‚
æ¯ä¸€æ¬¡è¯·æ±‚éƒ½éœ€è¦tokenã€‚tokenåº”è¯¥åœ¨HTTPçš„å¤´éƒ¨å‘é€ä»è€Œä¿è¯äº†Httpè¯·æ±‚æ— çŠ¶æ€ã€‚æˆ‘ä»¬åŒæ ·é€šè¿‡è®¾ç½®æœåŠ¡å™¨å±æ€§Access-Control-Allow-Origin:* ï¼Œè®©æœåŠ¡å™¨èƒ½æ¥å—åˆ°æ¥è‡ªæ‰€æœ‰åŸŸçš„è¯·æ±‚ã€‚éœ€è¦ä¸»è¦çš„æ˜¯ï¼Œåœ¨ACAOå¤´éƒ¨æ ‡æ˜(designating)*æ—¶ï¼Œä¸å¾—å¸¦æœ‰åƒHTTPè®¤è¯ï¼Œå®¢æˆ·ç«¯SSLè¯ä¹¦å’Œcookiesçš„è¯ä¹¦ã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="ä»£ç å®ä¾‹æµç¨‹">ä»£ç å®ä¾‹æµç¨‹ï¼š&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">username&lt;/span> &lt;span class="nx">pwd&lt;/span> &lt;span class="nx">client_type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">//æ¥å£åˆ¤æ–­
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">token&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">uid&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">æŸ¥è¯¢tokenè¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">$token&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nx">where&lt;/span> &lt;span class="nx">uid&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="nx">uid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">$token&lt;/span>&lt;span class="o">==&lt;/span>&lt;span class="nx">token&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ç™»å½•æˆåŠŸ&lt;/span>&lt;span class="err">ï¼ï¼&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">è¿”å›token&lt;/span> &lt;span class="nx">å’Œ&lt;/span> &lt;span class="nx">uid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ç™»å½•å¤±è´¥&lt;/span>&lt;span class="err">ï¼ï¼&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">usename&lt;/span> &lt;span class="nx">powd&lt;/span> &lt;span class="nx">client_type&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">æ£€éªŒç”¨æˆ·åå’Œå¯†ç &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="nx">æ­£ç¡®&lt;/span>&lt;span class="err">ï¼‰&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">å¾—åˆ°uid&lt;/span> &lt;span class="nx">å¹¶&lt;/span> &lt;span class="nx">ç”Ÿæˆtoken&lt;/span>&lt;span class="err">ï¼ˆ&lt;/span>&lt;span class="nx">md5&lt;/span>&lt;span class="p">(&lt;/span> &lt;span class="nx">uid&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">pwd&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">time&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="nx">è‡ªå·±å®šä¹‰è§„åˆ™&lt;/span> &lt;span class="p">)&lt;/span>&lt;span class="err">ï¼‰&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">uidä¸å­˜åœ¨&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">into&lt;/span> &lt;span class="nx">token&lt;/span> &lt;span class="nx">è¡¨&lt;/span> &lt;span class="nx">id&lt;/span> &lt;span class="nx">uid&lt;/span> &lt;span class="nx">token&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">where&lt;/span> &lt;span class="nx">uid&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nx">$uid&lt;/span> &lt;span class="nx">ä¿®æ”¹token&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">è¿”å›token&lt;/span> &lt;span class="nx">å’Œ&lt;/span> &lt;span class="nx">uid&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">è¿”å›é”™è¯¯ä¿¡æ¯&lt;/span>&lt;span class="err">ï¼›&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="å®¢æˆ·ç«¯cè¿›è¡Œæ–‡ä»¶å­˜å‚¨uid-å’Œtoken">å®¢æˆ·ç«¯cè¿›è¡Œæ–‡ä»¶å­˜å‚¨uid å’Œtoken&lt;/h2>
&lt;pre>&lt;code>ä¸‹æ¬¡å†æ¬¡ç™»å½•æ—¶ä½¿ç”¨uidå’Œtoken
å®ç°äº†ç”¨æˆ·ç™»å½•çš„äº’è¸¢
å½“æˆ‘ä»¬åœ¨ç¨‹åºä¸­è®¤è¯äº†ä¿¡æ¯å¹¶å–å¾—tokenä¹‹åï¼Œæˆ‘ä»¬ä¾¿èƒ½é€šè¿‡è¿™ä¸ªTokenåšè®¸å¤šçš„äº‹æƒ…ã€‚
æˆ‘ä»¬ç”šè‡³èƒ½åŸºäºåˆ›å»ºä¸€ä¸ªåŸºäºæƒé™çš„tokenä¼ ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºï¼Œè¿™äº›ç¬¬ä¸‰æ–¹ç¨‹åºèƒ½å¤Ÿè·å–åˆ°æˆ‘ä»¬çš„æ•°æ®ï¼ˆå½“ç„¶åªæœ‰åœ¨æˆ‘ä»¬å…è®¸çš„ç‰¹å®šçš„tokenï¼‰
&lt;/code>&lt;/pre>
&lt;h2 id="tokensçš„ä¼˜åŠ¿">Tokensçš„ä¼˜åŠ¿&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>æ— çŠ¶æ€ã€å¯æ‰©å±•&lt;/p>
&lt;pre>&lt;code> åœ¨å®¢æˆ·ç«¯å­˜å‚¨çš„Tokensæ˜¯æ— çŠ¶æ€çš„ï¼Œå¹¶ä¸”èƒ½å¤Ÿè¢«æ‰©å±•ã€‚åŸºäºè¿™ç§æ— çŠ¶æ€å’Œä¸å­˜å‚¨Sessionä¿¡æ¯ï¼Œè´Ÿè½½è´Ÿè½½å‡è¡¡å™¨èƒ½å¤Ÿå°†ç”¨æˆ·ä¿¡æ¯ä»ä¸€ä¸ªæœåŠ¡ä¼ åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šã€‚
å¦‚æœæˆ‘ä»¬å°†å·²éªŒè¯çš„ç”¨æˆ·çš„ä¿¡æ¯ä¿å­˜åœ¨Sessionä¸­ï¼Œåˆ™æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦ç”¨æˆ·å‘å·²éªŒè¯çš„æœåŠ¡å™¨å‘é€éªŒè¯ä¿¡æ¯(ç§°ä¸ºSessionäº²å’Œæ€§)ã€‚ç”¨æˆ·é‡å¤§æ—¶ï¼Œå¯èƒ½ä¼šé€ æˆä¸€äº›æ‹¥å µã€‚ä½†æ˜¯ä¸è¦ç€æ€¥ã€‚ä½¿ç”¨tokensä¹‹åè¿™äº›é—®é¢˜éƒ½è¿åˆƒè€Œè§£ï¼Œå› ä¸ºtokensè‡ªå·±holdä½äº†ç”¨æˆ·çš„éªŒè¯ä¿¡æ¯ã€‚
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h2 id="å®‰å…¨æ€§">å®‰å…¨æ€§&lt;/h2>
&lt;pre>&lt;code>è¯·æ±‚ä¸­å‘é€tokenè€Œä¸å†æ˜¯å‘é€cookieèƒ½å¤Ÿé˜²æ­¢CSRF(è·¨ç«™è¯·æ±‚ä¼ªé€ )ã€‚å³ä½¿åœ¨å®¢æˆ·ç«¯ä½¿ç”¨cookieå­˜å‚¨tokenï¼Œcookieä¹Ÿä»…ä»…æ˜¯ä¸€ä¸ªå­˜å‚¨æœºåˆ¶è€Œä¸æ˜¯ç”¨äºè®¤è¯ã€‚ä¸å°†ä¿¡æ¯å­˜å‚¨åœ¨Sessionä¸­ï¼Œè®©æˆ‘ä»¬å°‘äº†å¯¹sessionæ“ä½œã€‚
tokenæ˜¯æœ‰æ—¶æ•ˆçš„ï¼Œä¸€æ®µæ—¶é—´ä¹‹åç”¨æˆ·éœ€è¦é‡æ–°éªŒè¯ã€‚æˆ‘ä»¬ä¹Ÿä¸ä¸€å®šéœ€è¦ç­‰åˆ°tokenè‡ªåŠ¨å¤±æ•ˆï¼Œtokenæœ‰æ’¤å›çš„æ“ä½œï¼Œé€šè¿‡token revocataionå¯ä»¥ä½¿ä¸€ä¸ªç‰¹å®šçš„tokenæˆ–æ˜¯ä¸€ç»„æœ‰ç›¸åŒè®¤è¯çš„tokenæ— æ•ˆã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="å¯æ‰©å±•æ€§">å¯æ‰©å±•æ€§ï¼ˆï¼‰&lt;/h2>
&lt;pre>&lt;code>Tokensèƒ½å¤Ÿåˆ›å»ºä¸å…¶å®ƒç¨‹åºå…±äº«æƒé™çš„ç¨‹åºã€‚ä¾‹å¦‚ï¼Œèƒ½å°†ä¸€ä¸ªéšä¾¿çš„ç¤¾äº¤å¸å·å’Œè‡ªå·±çš„å¤§å·(Fackbookæˆ–æ˜¯Twitter)è”ç³»èµ·æ¥ã€‚å½“é€šè¿‡æœåŠ¡ç™»å½•Twitter(æˆ‘ä»¬å°†è¿™ä¸ªè¿‡ç¨‹Buffer)æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›Bufferé™„åˆ°Twitterçš„æ•°æ®æµä¸Š(we are allowing Buffer to post to our Twitter stream)ã€‚
ä½¿ç”¨tokensæ—¶ï¼Œå¯ä»¥æä¾›å¯é€‰çš„æƒé™ç»™ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºã€‚å½“ç”¨æˆ·æƒ³è®©å¦ä¸€ä¸ªåº”ç”¨ç¨‹åºè®¿é—®å®ƒä»¬çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å»ºç«‹è‡ªå·±çš„APIï¼Œå¾—å‡ºç‰¹æ®Šæƒé™çš„tokensã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="å¤šå¹³å°è·¨åŸŸ">å¤šå¹³å°è·¨åŸŸ&lt;/h2>
&lt;pre>&lt;code>æˆ‘ä»¬æå‰å…ˆæ¥è°ˆè®ºä¸€ä¸‹CORS(è·¨åŸŸèµ„æºå…±äº«)ï¼Œå¯¹åº”ç”¨ç¨‹åºå’ŒæœåŠ¡è¿›è¡Œæ‰©å±•çš„æ—¶å€™ï¼Œéœ€è¦ä»‹å…¥å„ç§å„ç§çš„è®¾å¤‡å’Œåº”ç”¨ç¨‹åºã€‚
Having our API just serve data, we can also make the design choice to serve assets from a CDN. This eliminates the issues that CORS brings up after we set a quick header configuration for our application.
åªè¦ç”¨æˆ·æœ‰ä¸€ä¸ªé€šè¿‡äº†éªŒè¯çš„tokenï¼Œæ•°æ®å’Œèµ„æºå°±èƒ½å¤Ÿåœ¨ä»»ä½•åŸŸä¸Šè¢«è¯·æ±‚åˆ°ã€‚
&lt;/code>&lt;/pre>
&lt;p>&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted --> Access&lt;!-- raw HTML omitted -->-Control&lt;!-- raw HTML omitted -->-Allow&lt;!-- raw HTML omitted -->-Origin&lt;!-- raw HTML omitted -->: &lt;!-- raw HTML omitted -->* &lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;!-- raw HTML omitted -->&lt;/p>
&lt;h2 id="åŸºäºæ ‡å‡†">åŸºäºæ ‡å‡†&lt;/h2>
&lt;pre>&lt;code>åˆ›å»ºtokençš„æ—¶å€™ï¼Œä½ å¯ä»¥è®¾å®šä¸€äº›é€‰é¡¹ã€‚æˆ‘ä»¬åœ¨åç»­çš„æ–‡ç« ä¸­ä¼šè¿›è¡Œæ›´åŠ è¯¦å°½çš„æè¿°ï¼Œä½†æ˜¯æ ‡å‡†çš„ç”¨æ³•ä¼šåœ¨JSON Web Tokensä½“ç°ã€‚
æœ€è¿‘çš„ç¨‹åºå’Œæ–‡æ¡£æ˜¯ä¾›ç»™JSON Web Tokensçš„ã€‚å®ƒæ”¯æŒä¼—å¤šçš„è¯­è¨€ã€‚è¿™æ„å‘³åœ¨æœªæ¥çš„ä½¿ç”¨ä¸­ä½ å¯ä»¥çœŸæ­£çš„è½¬æ¢ä½ çš„è®¤è¯æœºåˆ¶ã€‚
&lt;/code>&lt;/pre>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;pre>&lt;code>è¿™ç¯‡æ–‡ç« ä»…ä»…æ˜¯ä»‹ç»äº†ä¸ºä»€ä¹ˆé€‰æ‹©åŸºäºTokençš„èº«ä»½éªŒè¯ï¼Œå¹¶ä¸”æ€æ ·ä½¿ç”¨å®ƒã€‚
&lt;/code>&lt;/pre></description></item><item><title>Djangoä¸­çš„FBVå’ŒCBV</title><link>https://sunnnner.github.io/django%E4%B8%AD%E7%9A%84fbv%E5%92%8Ccbv/</link><pubDate>Thu, 05 Sep 2019 11:34:25 +0800</pubDate><guid>https://sunnnner.github.io/django%E4%B8%AD%E7%9A%84fbv%E5%92%8Ccbv/</guid><description>&lt;h2 id="fbv">FBV&lt;/h2>
&lt;blockquote>
&lt;p>fbvå°±æ˜¯åœ¨urlä¸­ä¸€ä¸ªè·¯å¾„å¯¹åº”ä¸€ä¸ªå‡½æ•°&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">urlpatterns&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^admin/&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">admin&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">site&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">urls&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^index/&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">views&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è§†å›¾å‡½æ•°ä¸­">è§†å›¾å‡½æ•°ä¸­&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">index&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;index.html&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="cbv">CBV&lt;/h2>
&lt;blockquote>
&lt;p>cbvå°±æ˜¯åœ¨urlä¸­ä¸€ä¸ªè·¯å¾„å¯¹åº”ä¸€ä¸ªç±»&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">urlpatterns&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^admin/&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">admin&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">site&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">urls&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^index/&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">views&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">IndexView&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">as_views&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="c1"># æ‰§è¡Œç±»åé¢çš„as_view()æ–¹æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è§†å›¾å‡½æ•°ä¸­-1">è§†å›¾å‡½æ•°ä¸­&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.views&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">View&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">IndexView&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">View&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ä»¥getå½¢å¼è®¿é—®ä¼šæ‰§è¡Œgetå‡½æ•°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è·å–æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">keargs&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">HttpResponse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;6666&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ä»¥postå½¢å¼è®¿é—®çš„è¯ä¼šæ‰§è¡Œpostå‡½æ•°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å‘é€æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">post&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">kwargs&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">HttpResponse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;post ok&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ³¨æ„">æ³¨æ„:&lt;/h2>
&lt;pre>&lt;code>cbvå®šä¹‰ç±»çš„æ—¶å€™å¿…é¡»è¦ç»§æ‰¿view
åœ¨å†™URLçš„æ—¶å€™å¿…é¡»è¦åŠ as_view
ç±»é‡Œé¢ä½¿ç”¨formè¡¨å•æäº¤çš„è¯åªæœ‰getå’Œpostæ–¹æ³•
restfulè§„èŒƒï¼šâ€™getâ€™è·å–æ•°æ®, â€˜postâ€™åˆ›å»ºæ–°æ•°æ®, â€˜putâ€™æ›´æ–°, â€˜patchâ€™å±€éƒ¨æ›´æ–°, â€˜deleteâ€™åˆ é™¤, â€˜headâ€™, â€˜optionsâ€™, â€˜traceâ€™
&lt;/code>&lt;/pre>
&lt;h2 id="cbvé‡æ–°å®šä¹‰dispatchå‡½æ•°">CBVé‡æ–°å®šä¹‰dispatchå‡½æ•°&lt;/h2>
&lt;pre>&lt;code>æ‰€æœ‰çš„æ–¹æ³•æœ¬è´¨ä¸Šéƒ½æ˜¯é€šè¿‡dispatchè¿™ä¸ªå‡½æ•°åå°„æ‰§è¡Œï¼Œå¦‚æœæƒ³è¦åœ¨æ‰§è¡Œgetæˆ–postæ–¹æ³•å‰æ‰§è¡Œå…¶ä»–æ­¥éª¤ï¼Œå¯ä»¥é‡å†™dispatch&lt;/code>&lt;/pre></description></item><item><title>Djangoä¸­çš„FBVå’ŒCBV</title><link>https://sunnnner.github.io/p/django%E4%B8%AD%E7%9A%84fbv%E5%92%8Ccbv/</link><pubDate>Thu, 05 Sep 2019 11:34:25 +0800</pubDate><guid>https://sunnnner.github.io/p/django%E4%B8%AD%E7%9A%84fbv%E5%92%8Ccbv/</guid><description>&lt;h2 id="fbv">FBV&lt;/h2>
&lt;blockquote>
&lt;p>fbvå°±æ˜¯åœ¨urlä¸­ä¸€ä¸ªè·¯å¾„å¯¹åº”ä¸€ä¸ªå‡½æ•°&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">urlpatterns&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^admin/&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">admin&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">site&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">urls&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^index/&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">views&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è§†å›¾å‡½æ•°ä¸­">è§†å›¾å‡½æ•°ä¸­&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">index&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;index.html&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="cbv">CBV&lt;/h2>
&lt;blockquote>
&lt;p>cbvå°±æ˜¯åœ¨urlä¸­ä¸€ä¸ªè·¯å¾„å¯¹åº”ä¸€ä¸ªç±»&lt;/p>
&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">urlpatterns&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^admin/&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">admin&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">site&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">urls&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^index/&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">views&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">IndexView&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">as_views&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="c1"># æ‰§è¡Œç±»åé¢çš„as_view()æ–¹æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è§†å›¾å‡½æ•°ä¸­-1">è§†å›¾å‡½æ•°ä¸­&lt;/h3>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.views&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">View&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">IndexView&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">View&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ä»¥getå½¢å¼è®¿é—®ä¼šæ‰§è¡Œgetå‡½æ•°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è·å–æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">keargs&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">HttpResponse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;6666&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ä»¥postå½¢å¼è®¿é—®çš„è¯ä¼šæ‰§è¡Œpostå‡½æ•°ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å‘é€æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">post&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">kwargs&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">HttpResponse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;post ok&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="æ³¨æ„">æ³¨æ„:&lt;/h2>
&lt;pre>&lt;code>cbvå®šä¹‰ç±»çš„æ—¶å€™å¿…é¡»è¦ç»§æ‰¿view
åœ¨å†™URLçš„æ—¶å€™å¿…é¡»è¦åŠ as_view
ç±»é‡Œé¢ä½¿ç”¨formè¡¨å•æäº¤çš„è¯åªæœ‰getå’Œpostæ–¹æ³•
restfulè§„èŒƒï¼šâ€™getâ€™è·å–æ•°æ®, â€˜postâ€™åˆ›å»ºæ–°æ•°æ®, â€˜putâ€™æ›´æ–°, â€˜patchâ€™å±€éƒ¨æ›´æ–°, â€˜deleteâ€™åˆ é™¤, â€˜headâ€™, â€˜optionsâ€™, â€˜traceâ€™
&lt;/code>&lt;/pre>
&lt;h2 id="cbvé‡æ–°å®šä¹‰dispatchå‡½æ•°">CBVé‡æ–°å®šä¹‰dispatchå‡½æ•°&lt;/h2>
&lt;pre>&lt;code>æ‰€æœ‰çš„æ–¹æ³•æœ¬è´¨ä¸Šéƒ½æ˜¯é€šè¿‡dispatchè¿™ä¸ªå‡½æ•°åå°„æ‰§è¡Œï¼Œå¦‚æœæƒ³è¦åœ¨æ‰§è¡Œgetæˆ–postæ–¹æ³•å‰æ‰§è¡Œå…¶ä»–æ­¥éª¤ï¼Œå¯ä»¥é‡å†™dispatch&lt;/code>&lt;/pre></description></item><item><title>Djangoå®šä¹‰USERå››ä¸­æ–¹å¼</title><link>https://sunnnner.github.io/django%E5%AE%9A%E4%B9%89user%E5%9B%9B%E4%B8%AD%E6%96%B9%E5%BC%8F/</link><pubDate>Mon, 03 Sep 2018 10:30:05 +0800</pubDate><guid>https://sunnnner.github.io/django%E5%AE%9A%E4%B9%89user%E5%9B%9B%E4%B8%AD%E6%96%B9%E5%BC%8F/</guid><description>&lt;ul>
&lt;li>
&lt;p>è®¾è®¡user models&lt;/p>
&lt;/li>
&lt;li>
&lt;p>djangoæœ¬èº«çš„auth_user åªåŒ…å«äº†åŸºæœ¬çš„ä¿¡æ¯åŒ…æ‹¬ç”¨æˆ·åï¼Œå¯†ç ï¼Œé‚®ç®±ä»¥åŠæ³¨å†Œæ—¶é—´å’Œæœ€æ–°çš„ç™»å½•æ—¶é—´ï¼Œä½†æ˜¯è¿™äº›å­—æ®µå¾ˆéš¾æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ï¼Œæœ‰æ—¶æˆ‘ä»¬æƒ³è®°å½•ç”¨æˆ·æ›´å¤šçš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ‰‹æœºå·ç­‰ä¿¡æ¯ï¼Œè¿™æ—¶å°±éœ€è¦åœ¨auth_user çš„åŸºç¡€ä¸Šå¢åŠ å­—æ®µï¼Œdjangoè‡ªå®šä¹‰Userç½‘ä¸Šæœ‰å››ç§æ–¹æ³•ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ˜¯å®˜ç½‘ä¸Šæ¨èçš„æ–¹æ³•ï¼Œå°±æ˜¯å¢åŠ ä¸€ä¸ªè¡¨auth_profileï¼Œå…¶ä¸­ä»¥auth_user è¡¨ä¸­çš„idä½œä¸ºForgein Keyå°†ä¸¤ä¸ªè¡¨è¿‡å…³è”èµ·æ¥ï¼Œè¿™æ ·å¯ä»¥åœ¨auth_profile ä¸­å¢åŠ å¤šä¸ªç”¨æˆ·çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦å¤–ä¸€ç§æ˜¯ä¿®æ”¹djangoçš„æºç ï¼Œè¿™ç§æ–¹æ³•ç®€å•æš´åŠ›ç›´æ¥ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•å¯ç§»æ¤æ€§å·®ï¼Œä¸åˆ©äºå¤šé¡¹ç›®éƒ¨ç½²ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç»§æ‰¿django auth/models ä¸­çš„Userç»§ç»­å¢åŠ å­—æ®µï¼Œè¿™ç§æ–¹æ³•éœ€è¦ä¿®æ”¹settingä¸­çš„AUTH_USER_MODEL=â€˜app.Userâ€™ appä¸ºä½ è‡ªå®šä¹‰çš„appï¼ŒINSTALLED_APPä¸­è¦åŒ…å«Contenttypeså’Œauthä¸¤ä¸ªappï¼Œclass metaä¸­ db_table è¦æŒ‡å®šä¸ºauth_user, å¦‚æœè¦åœ¨adminä¸­ç®¡ç†ç”¨æˆ·çš„è¯ï¼Œéœ€è¦å°†app_label è¿›è¡ŒæŒ‡å®šã€‚è€Œä¸”è¦åœ¨adminä¸­é‡æ–°å®šä¹‰UserAdmin å°†æ–°æ·»åŠ çš„å­—æ®µå†™åœ¨list_displayå’Œadd_fieldsä¸­ã€‚è¯¦è§django.contrib.auth.adminä¸­ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é‡å†™Userï¼Œä¹Ÿå°±æ˜¯ç»§æ‰¿AbstractUserå’ŒPermissionsä¸¤ä¸ªç±»ï¼Œå…¶å®djangoçš„User Modelä¹Ÿæ˜¯ç»§æ‰¿è‡ªè¿™ä¸¤ä¸ªç±»ï¼Œå› æ­¤ä½ å¯ä»¥åšç±»ä¼¼Userçš„å®šä¹‰æ–¹æ³•å®šä¹‰Userã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è®°å½•æ˜¯å¦æ‰§è¡Œäº†è¿ç§»æ–‡ä»¶é çš„æ˜¯django_migrationsè¿™è¡¨&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Djangoå®šä¹‰USERå››ä¸­æ–¹å¼</title><link>https://sunnnner.github.io/p/django%E5%AE%9A%E4%B9%89user%E5%9B%9B%E4%B8%AD%E6%96%B9%E5%BC%8F/</link><pubDate>Mon, 03 Sep 2018 10:30:05 +0800</pubDate><guid>https://sunnnner.github.io/p/django%E5%AE%9A%E4%B9%89user%E5%9B%9B%E4%B8%AD%E6%96%B9%E5%BC%8F/</guid><description>&lt;ul>
&lt;li>
&lt;p>è®¾è®¡user models&lt;/p>
&lt;/li>
&lt;li>
&lt;p>djangoæœ¬èº«çš„auth_user åªåŒ…å«äº†åŸºæœ¬çš„ä¿¡æ¯åŒ…æ‹¬ç”¨æˆ·åï¼Œå¯†ç ï¼Œé‚®ç®±ä»¥åŠæ³¨å†Œæ—¶é—´å’Œæœ€æ–°çš„ç™»å½•æ—¶é—´ï¼Œä½†æ˜¯è¿™äº›å­—æ®µå¾ˆéš¾æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚ï¼Œæœ‰æ—¶æˆ‘ä»¬æƒ³è®°å½•ç”¨æˆ·æ›´å¤šçš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ‰‹æœºå·ç­‰ä¿¡æ¯ï¼Œè¿™æ—¶å°±éœ€è¦åœ¨auth_user çš„åŸºç¡€ä¸Šå¢åŠ å­—æ®µï¼Œdjangoè‡ªå®šä¹‰Userç½‘ä¸Šæœ‰å››ç§æ–¹æ³•ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ˜¯å®˜ç½‘ä¸Šæ¨èçš„æ–¹æ³•ï¼Œå°±æ˜¯å¢åŠ ä¸€ä¸ªè¡¨auth_profileï¼Œå…¶ä¸­ä»¥auth_user è¡¨ä¸­çš„idä½œä¸ºForgein Keyå°†ä¸¤ä¸ªè¡¨è¿‡å…³è”èµ·æ¥ï¼Œè¿™æ ·å¯ä»¥åœ¨auth_profile ä¸­å¢åŠ å¤šä¸ªç”¨æˆ·çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦å¤–ä¸€ç§æ˜¯ä¿®æ”¹djangoçš„æºç ï¼Œè¿™ç§æ–¹æ³•ç®€å•æš´åŠ›ç›´æ¥ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•å¯ç§»æ¤æ€§å·®ï¼Œä¸åˆ©äºå¤šé¡¹ç›®éƒ¨ç½²ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç»§æ‰¿django auth/models ä¸­çš„Userç»§ç»­å¢åŠ å­—æ®µï¼Œè¿™ç§æ–¹æ³•éœ€è¦ä¿®æ”¹settingä¸­çš„AUTH_USER_MODEL=â€˜app.Userâ€™ appä¸ºä½ è‡ªå®šä¹‰çš„appï¼ŒINSTALLED_APPä¸­è¦åŒ…å«Contenttypeså’Œauthä¸¤ä¸ªappï¼Œclass metaä¸­ db_table è¦æŒ‡å®šä¸ºauth_user, å¦‚æœè¦åœ¨adminä¸­ç®¡ç†ç”¨æˆ·çš„è¯ï¼Œéœ€è¦å°†app_label è¿›è¡ŒæŒ‡å®šã€‚è€Œä¸”è¦åœ¨adminä¸­é‡æ–°å®šä¹‰UserAdmin å°†æ–°æ·»åŠ çš„å­—æ®µå†™åœ¨list_displayå’Œadd_fieldsä¸­ã€‚è¯¦è§django.contrib.auth.adminä¸­ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é‡å†™Userï¼Œä¹Ÿå°±æ˜¯ç»§æ‰¿AbstractUserå’ŒPermissionsä¸¤ä¸ªç±»ï¼Œå…¶å®djangoçš„User Modelä¹Ÿæ˜¯ç»§æ‰¿è‡ªè¿™ä¸¤ä¸ªç±»ï¼Œå› æ­¤ä½ å¯ä»¥åšç±»ä¼¼Userçš„å®šä¹‰æ–¹æ³•å®šä¹‰Userã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>è®°å½•æ˜¯å¦æ‰§è¡Œäº†è¿ç§»æ–‡ä»¶é çš„æ˜¯django_migrationsè¿™è¡¨&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>Djangoç”¨æˆ·æ¨¡å—</title><link>https://sunnnner.github.io/django%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97/</link><pubDate>Fri, 01 Jun 2018 10:15:16 +0800</pubDate><guid>https://sunnnner.github.io/django%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97/</guid><description>&lt;h1 id="ç¬¬ä¸€æ­¥åˆ›å»ºdjangoé¡¹ç›®">ç¬¬ä¸€æ­¥åˆ›å»ºDjangoé¡¹ç›®&lt;/h1>
&lt;ul>
&lt;li>&lt;code>django-admin startproject blog&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="åˆ›å»ºç¬¬ä¸€ä¸ªåº”ç”¨user">åˆ›å»ºç¬¬ä¸€ä¸ªåº”ç”¨user&lt;/h2>
&lt;ul>
&lt;li>&lt;code>python manage.py startapp user&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="è®¾ç½®settingæ–‡ä»¶">è®¾ç½®settingæ–‡ä»¶&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">ALLOWED_HOSTS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="err">â€œ&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="err">â€&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">æ›´æ”¹ä¸ºæ‰€æœ‰éƒ½å¯ä»¥è®¿é—®ä¸Šçº¿æ¨¡å¼&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INSTALLEN_APPS&lt;/span>&lt;span class="err">â€”ã€‹&lt;/span>&lt;span class="n">åŠ å…¥ç¬¬ä¸€ä¸ªuseråº”ç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>åˆ›å»ºtemplatesæ–‡ä»¶å¤¹ å¹¶è®¾ç½®TEMPLATESé‡Œé¢æ–‡ä»¶å¤¹çš„è·¯å¾„os.path.join&lt;/li>
&lt;li>è®¾ç½®DATABASESçš„å‚¨å­˜ä¸ºmysql&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">å­—æ®µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DATABASES&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;default&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;ENGINE&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;django.db.backends.mysql&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;NAME&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;bookstore&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;USER&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s1">&amp;#39;root&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;PASSWORD&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s1">&amp;#39;123&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;HOST&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s1">&amp;#39;localhost&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;PORT&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3306&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ä¿®æ”¹è¯­è¨€ä¸æ—¶åŒº">ä¿®æ”¹è¯­è¨€ä¸æ—¶åŒº&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">LANGUAGE_CODE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;zh-Hans&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">TIME_ZONE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;Asia/Shanghai&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è®¾ç½®é™æ€æ–‡ä»¶æ”¶é›†staticæ–‡ä»¶å¤¹å¹¶åœ¨settingè®¾ç½®">è®¾ç½®é™æ€æ–‡ä»¶æ”¶é›†staticæ–‡ä»¶å¤¹å¹¶åœ¨settingè®¾ç½®&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">STATIC_URL&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;/static/&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">STATICFILES_DIRS&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BASE_DIR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;static&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è®¾ç½®ä¸»é¡µurlä¸è§†å›¾å‡½æ•°">è®¾ç½®ä¸»é¡µurlä¸è§†å›¾å‡½æ•°&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^$&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;index&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">index&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;index.html&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ç¼–å†™ç”¨æˆ·æ¨¡å—">ç¼–å†™ç”¨æˆ·æ¨¡å—&lt;/h2>
&lt;h2 id="ç¼–å†™æ³¨å†Œæ¨¡å—">ç¼–å†™æ³¨å†Œæ¨¡å—&lt;/h2>
&lt;ul>
&lt;li>é¦–å…ˆç¼–å†™æŠ½è±¡ç±»ï¼Œæ‰€è°“æŠ½è±¡ç±»å°±æ˜¯æ‰€æœ‰ç±»æ¨¡æ¿éƒ½èƒ½ç”¨ä¸Šçš„ç±»&lt;/li>
&lt;li>åœ¨æ ¹ç›®å½•åˆ›å»º&lt;code>db pythonFile&lt;/code>æ–‡ä»¶å¤¹&lt;/li>
&lt;/ul>
&lt;h2 id="åˆ›å»ºbase_modelæŠ½è±¡åŸºç±»æŠ½è±¡åŸºç±»ç»§æ‰¿modelsmodel">åˆ›å»ºbase_modelæŠ½è±¡åŸºç±»æŠ½è±¡åŸºç±»ç»§æ‰¿models.Model&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.db&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">models&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">BaseModel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Model&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;æ¨¡å‹æŠ½è±¡åŸºç±»&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">is_delete&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">BooleanField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ˜¯å¦åˆ é™¤&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">create_time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DateTimeField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">auto_now_add&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;åˆ›å»ºæ—¶é—´&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">update_time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DateTimeField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">auto_now&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ›´æ–°æ—¶é—´&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">class&lt;/span> &lt;span class="nc">Meta&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ç»§æ‰¿æŠ½è±¡ç±»&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">abstract&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">True&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æ ¹ç›®å½•åˆ›å»ºutilsæ–‡ä»¶å¤¹è¯¥æ–‡ä»¶å¤¹çš„ä½œç”¨ä½œä¸ºåŠ å¯†ç”¨æˆ·å¯†ç &lt;/li>
&lt;li>åˆ›å»ºget_hashæ–‡ä»¶å¤¹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">hashlib&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">sha256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">get_hash&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;å–ä¸€ä¸ªå­—ç¬¦ä¸²çš„hashå€¼&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sh&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sha256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sh&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">encode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">sh&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">hexdigest&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æ‰“å¼€appå†…çš„modelsæ¨¡å—å¼€å§‹ç¼–å†™ç”¨æˆ·æ¨¡å—&lt;/li>
&lt;li>å¯¼å…¥get_hashå‡½æ•°&lt;/li>
&lt;li>å¯¼å…¥æŠ½è±¡åŸºç±»&lt;/li>
&lt;li>åˆ›å»ºç”¨æˆ·å­—æ®µä½¿å…¶ç»§æ‰¿ä¸æŠ½è±¡åŸºç±»&lt;/li>
&lt;li>å…¶ä¸­db_tableçš„ä½œç”¨ä¸ºåˆ¶å®šåˆ›å»ºæ•°æ®åº“çš„åç§°&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Passport&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BaseModel&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CharField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_length&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ç”¨æˆ·åç§°&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">unique&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CharField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_length&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">40&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ç”¨æˆ·å¯†ç &amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">email&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">EmailField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ç”¨æˆ·é‚®ç®±&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">is_active&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">BooleanField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ¿€æ´»çŠ¶æ€&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># åˆ›å»ºç”¨æˆ·è¡¨çš„ç®¡ç†å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">object&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">PassportManager&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">class&lt;/span> &lt;span class="nc">Meta&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æŒ‡å®šæ•°æ®åº“åç§°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">db_table&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;s_user_accoumt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>åˆ›å»ºæ·»åŠ ç”¨æˆ·è·ŸæŸ¥æ‰¾ç”¨æˆ·æ¨¡å—æ³¨æ„æ­¤å­—æ®µå¿…é¡»åœ¨ç”¨æˆ·æ¨¡å—çš„ä¸Šæ–¹å› ä¸ºæ­¤å­—æ®µç»§æ‰¿çš„model.Manageræ¨¡å—åœ¨ç”¨æˆ·æ¨¡å—ä¹‹ä¸Š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">PassportManager&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Manager&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">add_user&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">email&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;æ·»åŠ ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># sä½¿ç”¨crateæ–¹æ³•æ·»åŠ ä¸€ä¸ªç”¨æˆ·&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">passport&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">create&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">get_hash&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">password&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">email&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å¹¶ä¸”è¿”å›å½“å‰çš„æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">passport&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">find_user&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;æ ¹æ®ç”¨æˆ·çš„ä¿¡æ¯è¿›è¡ŒæŸ¥æ‰¾ç”¨æˆ·&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">passport&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">get_hash&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">password&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DoesNotExist&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è´¦æˆ·ä¸å­˜åœ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;=======&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">passport&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">None&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è¿”å›å½“å‰çš„ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">passport&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>åˆ›å»ºå®Œæˆä¹‹åpython3 manage.py makemigrationsè¿ç§»åŒæ­¥&lt;/li>
&lt;li>ç¼–å†™ç”¨æˆ·æ³¨å†Œè§†å›¾å‡½æ•°&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="err">â€™&lt;/span>&lt;span class="o">^/&lt;/span>&lt;span class="n">register&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="err">$â€™&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">register&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="err">â€™&lt;/span>&lt;span class="n">register&lt;/span>&lt;span class="err">â€™&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">register&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">method&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;GET&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;register.html&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">POST&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;user_name&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">POST&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;pwd&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">POST&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cpwd&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">email&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">POST&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;email&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># allæ–¹æ³•è¿›è¡Œæ•°æ®æ ¡éªŒï¼Œå¦‚æœé‡Œé¢ä»»æ„å€¼ä¸ºç©ºï¼Œå°±ä¸é€šè¿‡æ ¡éªŒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="nb">all&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">password&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">password1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">]):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;register.html&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;msg&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s1">&amp;#39;ä¸èƒ½è¾“å…¥æœ‰ç©ºçš„å‚æ•°&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># é‚®ç®±æ­£åˆ™éªŒè¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">match&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;[a-z0-9][\w\.\-]*@[a-z0-9\-]+(\.[a-z]{2,5}){1,2}$&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">email&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;register.html&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;msg&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s1">&amp;#39;è¾“å…¥çš„é‚®ç®±ä¸æ­£ç¡®&amp;#39;&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># é€šè¿‡å‘æ•°æ®åº“æ·»åŠ ç”¨æˆ·ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è°ƒç”¨æ·»åŠ ç”¨æˆ·çš„æ–¹æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">passport&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Passport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_user&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">password&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">email&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">redirect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">reverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;user:register&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;cmsg&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s1">&amp;#39;æ³¨å†ŒæˆåŠŸ&amp;#39;&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ›å»ºç™»å½•æ¨¡å—">åˆ›å»ºç™»å½•æ¨¡å—&lt;/h2>
&lt;ul>
&lt;li>url(râ€™^login/$â€™, login, name=â€™loginâ€™),&lt;/li>
&lt;li>å› ä¸ºç™»å½•æ¨¡å—ç”¨åˆ°ajax æ‰€ä»¥æˆ‘ä»¬å…ˆå†™å‰ç«¯æ•°æ®&lt;/li>
&lt;li>é¦–å…ˆajaxä¼ è¾“ä¸ç”¨è¡¨å•æ•°æ®æˆ‘ä»¬å°±åˆ é™¤fromè¡¨å•&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;form_input&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {% csrf_token %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">input&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;text&amp;#34;&lt;/span> &lt;span class="na">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;username&amp;#34;&lt;/span> &lt;span class="na">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;{{ username }}&amp;#34;&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;name_input&amp;#34;&lt;/span> &lt;span class="na">placeholder&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;è¯·è¾“å…¥ç”¨æˆ·å&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;user_error&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>è¾“å…¥é”™è¯¯&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">input&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;password&amp;#34;&lt;/span> &lt;span class="na">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;pwd&amp;#34;&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;pass_input&amp;#34;&lt;/span> &lt;span class="na">placeholder&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;è¯·è¾“å…¥å¯†ç &amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;pwd_error&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>è¾“å…¥é”™è¯¯&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;more_input clearfix&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">input&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;checkbox&amp;#34;&lt;/span> &lt;span class="na">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;remember&amp;#34;&lt;/span> &lt;span class="na">checked&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">{{&lt;/span> &lt;span class="na">checked&lt;/span> &lt;span class="err">}}&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">label&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>è®°ä½ç”¨æˆ·å&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">label&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">a&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;#&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>å¿˜è®°å¯†ç &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">a&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">input&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;button&amp;#34;&lt;/span> &lt;span class="na">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;btnLogin&amp;#34;&lt;/span> &lt;span class="na">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;ç™»å½•&amp;#34;&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;input_submit&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AJAX
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;{% static &amp;#39;js/jquery-1.12.4.min.js&amp;#39; %}&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#btnLogin&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">click&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//è·å–ç”¨æˆ·åå’Œå¯†ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="err">#&lt;/span> &lt;span class="nx">ä½¿ç”¨jquayè·å–ç”¨æˆ·çš„ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">username&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#username&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">val&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">password&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#pwd&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">val&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">#&lt;/span> &lt;span class="nx">è®¾ç½®csrf_tokenä¸ºæ ‡ç­¾è®¾ç½®å…¶å±æ€§name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nx">csrfmiddlewaretokenå¹¶å°†è·å–åˆ°çš„cdrf_tokençš„å€¼èµ‹å€¼ç»™csrf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">csrf&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;input[name=&amp;#34;csrfmiddlewaretoken&amp;#34;]&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">val&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">#&lt;/span> &lt;span class="nx">è¿”å›å½“å‰è®°ä½ç”¨æˆ·çš„çŠ¶æ€true&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">remember&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#remember&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">prop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;checked&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//å‘èµ·ajaxè¯·æ±‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">params&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">username&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;password&amp;#39;&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">password&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;csrfmiddlewaretoken&amp;#39;&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">csrf&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;remember&amp;#39;&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">remember&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//ajaxå°†pythonå­—å…¸è½¬æ¢ä¸ºäº†jsonå­—ç¬¦ä¸²å‹å­—å…¸æ­¤æ—¶ç±»å‹ä¸ºjsonç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">$&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">post&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;{% url &amp;#34;user:login&amp;#34; %}&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">params&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//ç”¨æˆ·åå¯†ç é”™è¯¯{&amp;#39;res&amp;#39;:0}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//ç™»å½•æˆåŠŸ{&amp;#39;res&amp;#39;:1}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//çŠ¶æ€ç çŠ¶æ€ç ä¸º01ï¼Œ2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">res&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">alert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">res&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//è·³è½¬é¡µé¢ è·å–åç«¯next_url
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">location&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">href&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">next_url&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">res&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">alert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;è¯·å¡«å†™å®Œæ•´çš„ç”¨æˆ·åæˆ–è€…å¯†ç &amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åç«¯ä»£ç ">åç«¯ä»£ç &lt;/h2>
&lt;ul>
&lt;li>ç”¨æˆ·ç™»å½•æ ¡éªŒ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">login&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">method&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;GET&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è®°ä½ç”¨æˆ·ååŠŸèƒ½ checkedè¡¨ç¤ºå•é€‰æ¡†çŠ¶æ€&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">COOKIES&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;username&amp;#34;&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">COOKIES&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;username&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">checked&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">checked&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">context&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;checked&amp;#39;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">checked&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;login.html&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">context&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">method&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;POST&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æ­¤æ—¶postå–çš„æ˜¯å‰æ®µajaxæ•°æ®å¹¶ä¸æ˜¯è¡¨å•æ•°æ®å› ä¸ºè¡¨å•å·²ç»åˆ é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">POST&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">POST&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;password&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">remember&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">POST&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;remember&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æ•°æ®æ ¡éªŒ ä½¿ç”¨all()æ–¹æ³•è¿›è¡Œæ ¡éªŒåªæœ‰ä¸¤ä¸ªéƒ½ä¸ä¸ºç©ºæ—¶æ‰ä¸ºtrue&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="nb">all&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="p">]):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æ•°æ®ä¸ºç©º è¿”å›ajaxé‡Œé¢çš„çŠ¶æ€ç jsonæ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">JsonResponse&lt;/span>&lt;span class="p">({&lt;/span>&lt;span class="s1">&amp;#39;res&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è°ƒç”¨æŸ¥æ‰¾æ–¹æ³•åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">passport&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Passport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_user&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">password&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">passport&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ä¸¤ç§æ–¹æ³•éƒ½æ˜¯é‡å®šå‘åˆ°ä¸»é¡µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># next_url = request.session.get(&amp;#39;url_path&amp;#39;, reverse(&amp;#39;index&amp;#39;))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">next_url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;/&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;---------------&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ç™»å½•æˆåŠŸ è¿”å›çŠ¶æ€ç å¹¶è®¾ç½®next_urlæ•°æ®ä¼ è¾“åˆ°å‰æ®µéƒ½æ˜¯å­—å…¸æ¨¡å¼ä¼šè‡ªåŠ¨è½¬æ¢æˆjsonå­—ç¬¦ä¸²&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jire&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">JsonResponse&lt;/span>&lt;span class="p">({&lt;/span>&lt;span class="s1">&amp;#39;res&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;next_url&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">next_url&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å¦‚æœå•é€‰æ¡†é€‰ä¸­&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">remember&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;true&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è®°ä½ç”¨æˆ·åå¹¶è®¾ç½®cookieçš„ä¿å­˜æ—¶é—´&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jire&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">set_cookie&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">max_age&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">24&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">3600&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ä¸è¦è®°ä½ç”¨æˆ·åå¹¶åˆ é™¤cookie&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jire&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">delete_cookie&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è®°ä½ç”¨æˆ·åçš„çŠ¶æ€&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è®¾ç½®æ˜¯å¦ç™»å½•çŠ¶æ€å‰æ®µè¦ç”¨ç”¨sessionä¿å­˜åˆ°æœåŠ¡å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">session&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;islogin&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">session&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">username&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å½“å‰ç”¨æˆ·çš„å”¯ä¸€æ ‡ç¤º&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">session&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;passport_id&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">passport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">jire&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">JsonResponse&lt;/span>&lt;span class="p">({&lt;/span>&lt;span class="s1">&amp;#39;res&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="é€€å‡º">é€€å‡º&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="err">â€™&lt;/span>&lt;span class="o">^&lt;/span>&lt;span class="n">logout&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="err">$â€™&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">logout&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="err">â€™&lt;/span>&lt;span class="n">logout&lt;/span>&lt;span class="err">â€™&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">logout&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;ç”¨æˆ·é€€å‡ºæ“ä½œ&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æ¸…ç©ºç”¨æˆ·sessionæ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">session&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">flush&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ç„¶åè·³è½¬é¦–é¡µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">redirect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">reverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;index&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Djangoç”¨æˆ·æ¨¡å—</title><link>https://sunnnner.github.io/p/django%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97/</link><pubDate>Fri, 01 Jun 2018 10:15:16 +0800</pubDate><guid>https://sunnnner.github.io/p/django%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97/</guid><description>&lt;h1 id="ç¬¬ä¸€æ­¥åˆ›å»ºdjangoé¡¹ç›®">ç¬¬ä¸€æ­¥åˆ›å»ºDjangoé¡¹ç›®&lt;/h1>
&lt;ul>
&lt;li>&lt;code>django-admin startproject blog&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="åˆ›å»ºç¬¬ä¸€ä¸ªåº”ç”¨user">åˆ›å»ºç¬¬ä¸€ä¸ªåº”ç”¨user&lt;/h2>
&lt;ul>
&lt;li>&lt;code>python manage.py startapp user&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="è®¾ç½®settingæ–‡ä»¶">è®¾ç½®settingæ–‡ä»¶&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">ALLOWED_HOSTS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="err">â€œ&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="err">â€&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">æ›´æ”¹ä¸ºæ‰€æœ‰éƒ½å¯ä»¥è®¿é—®ä¸Šçº¿æ¨¡å¼&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">INSTALLEN_APPS&lt;/span>&lt;span class="err">â€”ã€‹&lt;/span>&lt;span class="n">åŠ å…¥ç¬¬ä¸€ä¸ªuseråº”ç”¨&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>åˆ›å»ºtemplatesæ–‡ä»¶å¤¹ å¹¶è®¾ç½®TEMPLATESé‡Œé¢æ–‡ä»¶å¤¹çš„è·¯å¾„os.path.join&lt;/li>
&lt;li>è®¾ç½®DATABASESçš„å‚¨å­˜ä¸ºmysql&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">å­—æ®µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DATABASES&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;default&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;ENGINE&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;django.db.backends.mysql&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;NAME&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;bookstore&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;USER&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s1">&amp;#39;root&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;PASSWORD&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s1">&amp;#39;123&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;HOST&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s1">&amp;#39;localhost&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;PORT&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3306&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ä¿®æ”¹è¯­è¨€ä¸æ—¶åŒº">ä¿®æ”¹è¯­è¨€ä¸æ—¶åŒº&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">LANGUAGE_CODE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;zh-Hans&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">TIME_ZONE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;Asia/Shanghai&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è®¾ç½®é™æ€æ–‡ä»¶æ”¶é›†staticæ–‡ä»¶å¤¹å¹¶åœ¨settingè®¾ç½®">è®¾ç½®é™æ€æ–‡ä»¶æ”¶é›†staticæ–‡ä»¶å¤¹å¹¶åœ¨settingè®¾ç½®&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">STATIC_URL&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;/static/&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">STATICFILES_DIRS&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BASE_DIR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;static&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è®¾ç½®ä¸»é¡µurlä¸è§†å›¾å‡½æ•°">è®¾ç½®ä¸»é¡µurlä¸è§†å›¾å‡½æ•°&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^$&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;index&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">index&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;index.html&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="ç¼–å†™ç”¨æˆ·æ¨¡å—">ç¼–å†™ç”¨æˆ·æ¨¡å—&lt;/h2>
&lt;h2 id="ç¼–å†™æ³¨å†Œæ¨¡å—">ç¼–å†™æ³¨å†Œæ¨¡å—&lt;/h2>
&lt;ul>
&lt;li>é¦–å…ˆç¼–å†™æŠ½è±¡ç±»ï¼Œæ‰€è°“æŠ½è±¡ç±»å°±æ˜¯æ‰€æœ‰ç±»æ¨¡æ¿éƒ½èƒ½ç”¨ä¸Šçš„ç±»&lt;/li>
&lt;li>åœ¨æ ¹ç›®å½•åˆ›å»º&lt;code>db pythonFile&lt;/code>æ–‡ä»¶å¤¹&lt;/li>
&lt;/ul>
&lt;h2 id="åˆ›å»ºbase_modelæŠ½è±¡åŸºç±»æŠ½è±¡åŸºç±»ç»§æ‰¿modelsmodel">åˆ›å»ºbase_modelæŠ½è±¡åŸºç±»æŠ½è±¡åŸºç±»ç»§æ‰¿models.Model&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.db&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">models&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">BaseModel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Model&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;æ¨¡å‹æŠ½è±¡åŸºç±»&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">is_delete&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">BooleanField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ˜¯å¦åˆ é™¤&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">create_time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DateTimeField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">auto_now_add&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;åˆ›å»ºæ—¶é—´&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">update_time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DateTimeField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">auto_now&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ›´æ–°æ—¶é—´&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">class&lt;/span> &lt;span class="nc">Meta&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ç»§æ‰¿æŠ½è±¡ç±»&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">abstract&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">True&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æ ¹ç›®å½•åˆ›å»ºutilsæ–‡ä»¶å¤¹è¯¥æ–‡ä»¶å¤¹çš„ä½œç”¨ä½œä¸ºåŠ å¯†ç”¨æˆ·å¯†ç &lt;/li>
&lt;li>åˆ›å»ºget_hashæ–‡ä»¶å¤¹&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">hashlib&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">sha256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">get_hash&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;å–ä¸€ä¸ªå­—ç¬¦ä¸²çš„hashå€¼&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sh&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sha256&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sh&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">update&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">str&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">encode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">sh&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">hexdigest&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æ‰“å¼€appå†…çš„modelsæ¨¡å—å¼€å§‹ç¼–å†™ç”¨æˆ·æ¨¡å—&lt;/li>
&lt;li>å¯¼å…¥get_hashå‡½æ•°&lt;/li>
&lt;li>å¯¼å…¥æŠ½è±¡åŸºç±»&lt;/li>
&lt;li>åˆ›å»ºç”¨æˆ·å­—æ®µä½¿å…¶ç»§æ‰¿ä¸æŠ½è±¡åŸºç±»&lt;/li>
&lt;li>å…¶ä¸­db_tableçš„ä½œç”¨ä¸ºåˆ¶å®šåˆ›å»ºæ•°æ®åº“çš„åç§°&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Passport&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BaseModel&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CharField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_length&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ç”¨æˆ·åç§°&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">unique&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CharField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_length&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">40&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ç”¨æˆ·å¯†ç &amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">email&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">EmailField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ç”¨æˆ·é‚®ç®±&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">is_active&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">BooleanField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;æ¿€æ´»çŠ¶æ€&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># åˆ›å»ºç”¨æˆ·è¡¨çš„ç®¡ç†å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">object&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">PassportManager&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">class&lt;/span> &lt;span class="nc">Meta&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æŒ‡å®šæ•°æ®åº“åç§°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">db_table&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;s_user_accoumt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>åˆ›å»ºæ·»åŠ ç”¨æˆ·è·ŸæŸ¥æ‰¾ç”¨æˆ·æ¨¡å—æ³¨æ„æ­¤å­—æ®µå¿…é¡»åœ¨ç”¨æˆ·æ¨¡å—çš„ä¸Šæ–¹å› ä¸ºæ­¤å­—æ®µç»§æ‰¿çš„model.Manageræ¨¡å—åœ¨ç”¨æˆ·æ¨¡å—ä¹‹ä¸Š&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">PassportManager&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Manager&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">add_user&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">email&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;æ·»åŠ ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># sä½¿ç”¨crateæ–¹æ³•æ·»åŠ ä¸€ä¸ªç”¨æˆ·&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">passport&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">create&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">get_hash&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">password&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">email&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å¹¶ä¸”è¿”å›å½“å‰çš„æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">passport&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">find_user&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;æ ¹æ®ç”¨æˆ·çš„ä¿¡æ¯è¿›è¡ŒæŸ¥æ‰¾ç”¨æˆ·&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">passport&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">get_hash&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">password&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DoesNotExist&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è´¦æˆ·ä¸å­˜åœ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;=======&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">passport&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">None&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è¿”å›å½“å‰çš„ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">passport&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>åˆ›å»ºå®Œæˆä¹‹åpython3 manage.py makemigrationsè¿ç§»åŒæ­¥&lt;/li>
&lt;li>ç¼–å†™ç”¨æˆ·æ³¨å†Œè§†å›¾å‡½æ•°&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="err">â€™&lt;/span>&lt;span class="o">^/&lt;/span>&lt;span class="n">register&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="err">$â€™&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">register&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="err">â€™&lt;/span>&lt;span class="n">register&lt;/span>&lt;span class="err">â€™&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">register&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">method&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;GET&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;register.html&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">POST&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;user_name&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">POST&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;pwd&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">POST&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cpwd&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">email&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">POST&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;email&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># allæ–¹æ³•è¿›è¡Œæ•°æ®æ ¡éªŒï¼Œå¦‚æœé‡Œé¢ä»»æ„å€¼ä¸ºç©ºï¼Œå°±ä¸é€šè¿‡æ ¡éªŒ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="nb">all&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">password&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">password1&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">]):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;register.html&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;msg&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s1">&amp;#39;ä¸èƒ½è¾“å…¥æœ‰ç©ºçš„å‚æ•°&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># é‚®ç®±æ­£åˆ™éªŒè¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">match&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;[a-z0-9][\w\.\-]*@[a-z0-9\-]+(\.[a-z]{2,5}){1,2}$&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">email&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;register.html&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;msg&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s1">&amp;#39;è¾“å…¥çš„é‚®ç®±ä¸æ­£ç¡®&amp;#39;&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># é€šè¿‡å‘æ•°æ®åº“æ·»åŠ ç”¨æˆ·ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è°ƒç”¨æ·»åŠ ç”¨æˆ·çš„æ–¹æ³•&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">passport&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Passport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_user&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">password&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">email&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">email&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">redirect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">reverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;user:register&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;cmsg&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="s1">&amp;#39;æ³¨å†ŒæˆåŠŸ&amp;#39;&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åˆ›å»ºç™»å½•æ¨¡å—">åˆ›å»ºç™»å½•æ¨¡å—&lt;/h2>
&lt;ul>
&lt;li>url(râ€™^login/$â€™, login, name=â€™loginâ€™),&lt;/li>
&lt;li>å› ä¸ºç™»å½•æ¨¡å—ç”¨åˆ°ajax æ‰€ä»¥æˆ‘ä»¬å…ˆå†™å‰ç«¯æ•°æ®&lt;/li>
&lt;li>é¦–å…ˆajaxä¼ è¾“ä¸ç”¨è¡¨å•æ•°æ®æˆ‘ä»¬å°±åˆ é™¤fromè¡¨å•&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;form_input&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {% csrf_token %}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">input&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;text&amp;#34;&lt;/span> &lt;span class="na">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;username&amp;#34;&lt;/span> &lt;span class="na">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;{{ username }}&amp;#34;&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;name_input&amp;#34;&lt;/span> &lt;span class="na">placeholder&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;è¯·è¾“å…¥ç”¨æˆ·å&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;user_error&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>è¾“å…¥é”™è¯¯&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">input&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;password&amp;#34;&lt;/span> &lt;span class="na">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;pwd&amp;#34;&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;pass_input&amp;#34;&lt;/span> &lt;span class="na">placeholder&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;è¯·è¾“å…¥å¯†ç &amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;pwd_error&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>è¾“å…¥é”™è¯¯&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;more_input clearfix&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">input&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;checkbox&amp;#34;&lt;/span> &lt;span class="na">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;remember&amp;#34;&lt;/span> &lt;span class="na">checked&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">{{&lt;/span> &lt;span class="na">checked&lt;/span> &lt;span class="err">}}&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">label&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>è®°ä½ç”¨æˆ·å&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">label&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">a&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;#&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>å¿˜è®°å¯†ç &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">a&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">input&lt;/span> &lt;span class="na">type&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;button&amp;#34;&lt;/span> &lt;span class="na">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;btnLogin&amp;#34;&lt;/span> &lt;span class="na">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;ç™»å½•&amp;#34;&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;input_submit&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AJAX
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;{% static &amp;#39;js/jquery-1.12.4.min.js&amp;#39; %}&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#btnLogin&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">click&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//è·å–ç”¨æˆ·åå’Œå¯†ç 
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="err">#&lt;/span> &lt;span class="nx">ä½¿ç”¨jquayè·å–ç”¨æˆ·çš„ä¿¡æ¯&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">username&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#username&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">val&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">password&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#pwd&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">val&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">#&lt;/span> &lt;span class="nx">è®¾ç½®csrf_tokenä¸ºæ ‡ç­¾è®¾ç½®å…¶å±æ€§name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nx">csrfmiddlewaretokenå¹¶å°†è·å–åˆ°çš„cdrf_tokençš„å€¼èµ‹å€¼ç»™csrf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">csrf&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;input[name=&amp;#34;csrfmiddlewaretoken&amp;#34;]&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">val&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="err">#&lt;/span> &lt;span class="nx">è¿”å›å½“å‰è®°ä½ç”¨æˆ·çš„çŠ¶æ€true&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="kc">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">var&lt;/span> &lt;span class="nx">remember&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">$&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#remember&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">prop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;checked&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//å‘èµ·ajaxè¯·æ±‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">params&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">username&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;password&amp;#39;&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">password&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;csrfmiddlewaretoken&amp;#39;&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">csrf&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;remember&amp;#39;&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">remember&lt;/span>&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//ajaxå°†pythonå­—å…¸è½¬æ¢ä¸ºäº†jsonå­—ç¬¦ä¸²å‹å­—å…¸æ­¤æ—¶ç±»å‹ä¸ºjsonç±»å‹
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">$&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">post&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;{% url &amp;#34;user:login&amp;#34; %}&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">params&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//ç”¨æˆ·åå¯†ç é”™è¯¯{&amp;#39;res&amp;#39;:0}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//ç™»å½•æˆåŠŸ{&amp;#39;res&amp;#39;:1}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="c1">//çŠ¶æ€ç çŠ¶æ€ç ä¸º01ï¼Œ2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">res&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">alert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">res&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//è·³è½¬é¡µé¢ è·å–åç«¯next_url
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">location&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">href&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">next_url&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">data&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">res&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">alert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;è¯·å¡«å†™å®Œæ•´çš„ç”¨æˆ·åæˆ–è€…å¯†ç &amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="åç«¯ä»£ç ">åç«¯ä»£ç &lt;/h2>
&lt;ul>
&lt;li>ç”¨æˆ·ç™»å½•æ ¡éªŒ&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">login&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">method&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;GET&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è®°ä½ç”¨æˆ·ååŠŸèƒ½ checkedè¡¨ç¤ºå•é€‰æ¡†çŠ¶æ€&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">COOKIES&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;username&amp;#34;&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">COOKIES&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;username&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">checked&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">checked&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">context&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;checked&amp;#39;&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">checked&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;login.html&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">context&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">method&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;POST&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æ­¤æ—¶postå–çš„æ˜¯å‰æ®µajaxæ•°æ®å¹¶ä¸æ˜¯è¡¨å•æ•°æ®å› ä¸ºè¡¨å•å·²ç»åˆ é™¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">POST&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">POST&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;password&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">remember&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">POST&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;remember&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æ•°æ®æ ¡éªŒ ä½¿ç”¨all()æ–¹æ³•è¿›è¡Œæ ¡éªŒåªæœ‰ä¸¤ä¸ªéƒ½ä¸ä¸ºç©ºæ—¶æ‰ä¸ºtrue&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="nb">all&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="p">]):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æ•°æ®ä¸ºç©º è¿”å›ajaxé‡Œé¢çš„çŠ¶æ€ç jsonæ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">JsonResponse&lt;/span>&lt;span class="p">({&lt;/span>&lt;span class="s1">&amp;#39;res&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è°ƒç”¨æŸ¥æ‰¾æ–¹æ³•åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">passport&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Passport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_user&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">password&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">passport&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ä¸¤ç§æ–¹æ³•éƒ½æ˜¯é‡å®šå‘åˆ°ä¸»é¡µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># next_url = request.session.get(&amp;#39;url_path&amp;#39;, reverse(&amp;#39;index&amp;#39;))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">next_url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;/&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;---------------&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ç™»å½•æˆåŠŸ è¿”å›çŠ¶æ€ç å¹¶è®¾ç½®next_urlæ•°æ®ä¼ è¾“åˆ°å‰æ®µéƒ½æ˜¯å­—å…¸æ¨¡å¼ä¼šè‡ªåŠ¨è½¬æ¢æˆjsonå­—ç¬¦ä¸²&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jire&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">JsonResponse&lt;/span>&lt;span class="p">({&lt;/span>&lt;span class="s1">&amp;#39;res&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;next_url&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">next_url&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å¦‚æœå•é€‰æ¡†é€‰ä¸­&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">remember&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;true&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è®°ä½ç”¨æˆ·åå¹¶è®¾ç½®cookieçš„ä¿å­˜æ—¶é—´&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jire&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">set_cookie&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">username&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">max_age&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">24&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="mi">3600&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ä¸è¦è®°ä½ç”¨æˆ·åå¹¶åˆ é™¤cookie&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">jire&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">delete_cookie&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è®°ä½ç”¨æˆ·åçš„çŠ¶æ€&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># è®¾ç½®æ˜¯å¦ç™»å½•çŠ¶æ€å‰æ®µè¦ç”¨ç”¨sessionä¿å­˜åˆ°æœåŠ¡å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">session&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;islogin&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">session&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">username&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å½“å‰ç”¨æˆ·çš„å”¯ä¸€æ ‡ç¤º&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">session&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;passport_id&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">passport&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">jire&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">JsonResponse&lt;/span>&lt;span class="p">({&lt;/span>&lt;span class="s1">&amp;#39;res&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="é€€å‡º">é€€å‡º&lt;/h2>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="err">â€™&lt;/span>&lt;span class="o">^&lt;/span>&lt;span class="n">logout&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="err">$â€™&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">logout&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="err">â€™&lt;/span>&lt;span class="n">logout&lt;/span>&lt;span class="err">â€™&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">logout&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;ç”¨æˆ·é€€å‡ºæ“ä½œ&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æ¸…ç©ºç”¨æˆ·sessionæ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">request&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">session&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">flush&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ç„¶åè·³è½¬é¦–é¡µ&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">redirect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">reverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;index&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>é¡µé¢å¼€å‘</title><link>https://sunnnner.github.io/%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91/</link><pubDate>Thu, 31 May 2018 18:47:29 +0800</pubDate><guid>https://sunnnner.github.io/%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91/</guid><description>&lt;ul>
&lt;li>é¦–å…ˆæ–°å»ºappâ€”&amp;gt;bookså¹¶æ·»åŠ settingsé‡Œé¢&lt;/li>
&lt;li>å› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨åå°adminä¸Šä¼ æ•°æ®æ‰€ä»¥æˆ‘ä»¬è¦åˆ›å»ºå¯Œæ–‡æœ¬ç®¡ç†å™¨å¹¶åœ¨settingè®¾ç½®ä»–çš„é€‰é¡¹&lt;/li>
&lt;li>å¯Œæ–‡æœ¬ç®¡ç†å™¨æ˜¯ä¸€ä¸ªæ’ä»¶æˆ‘ä»¬è¿™æ¬¡ä½¿ç”¨çš„æ˜¯tinymceå¹¶ä¸”æˆ‘ä»¬éœ€è¦å°†å®ƒåŠ å…¥åˆ°appsé‡Œé¢å› ä¸ºä»–æ˜¯ä¸€ä¸ªåº”ç”¨ï¼Œä½†æ˜¯è¿™ä¸ªåº”ç”¨æ˜¯éœ€è¦ä¸‹è½½çš„&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">TINTMCE_DEFAULT_CONFIG&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;theme&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;modern&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;wight&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">600&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;height&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">400&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>æˆ‘ä»¬éœ€è¦è®¾ç½®åˆ¶å®šä¸€ä¸ªåª’ä½“æ–‡ä»¶å¤¹æ¥å­˜æ”¾æˆ‘ä»¬çš„å›¾ç‰‡&lt;code>MEDIA_ROOT = os.path.join(BASE_DIR, 'static')&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ·»åŠ åº”ç”¨çš„urls``&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^books/&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">include&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;books.urls&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">namespace&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;books&amp;#39;&lt;/span>&lt;span class="p">)),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^tinymce/&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">include&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;tinymce.urls&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">namespace&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;tinymce&amp;#39;&lt;/span>&lt;span class="p">)),&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æˆ‘ä»¬å¼€å§‹å†™booksé‡Œé¢çš„å­—æ®µé¦–å…ˆæŸ¥çœ‹é¡µé¢æˆ‘ä»¬éœ€è¦ä»€ä¹ˆå­—æ®µ&lt;/li>
&lt;li>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºtinymacå¯Œæ–‡æœ¬éœ€è¦çš„å­—æ®µï¼Œè¿™é‡Œçš„å­—æ®µæ˜ å°„å…¨å±€&lt;/li>
&lt;li>åœ¨booksç›®å½•ä¸‹åˆ›å»ºä»»æ„çš„.pyæ–‡ä»¶è¿™é‡Œæˆ‘çš„æ˜¯emums.py&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ­¤å¤„1ï¼Œ2ï¼Œ3ï¼Œ4ä»£è¡¨ä¹¦æœ¬çš„id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">PYTHON&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">JAVASCRIPT&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ALGORITHMS&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">MACHINELEARNING&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">OPERATINSGYSTEM&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DATABASE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># BOOKS_TYPEä½œä¸ºä¸€ä¸ªå­—å…¸ä¼ è¾“åˆ°models&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">BOOKS_TYPE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">PYTHON&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;python&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">JAVASCRIPT&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;javascript&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ALGORITHMS&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;æ•°æ®åº“ç»“æ„ä¸ç®—æ³•&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MACHINELEARNING&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;æœºå™¨å­¦ä¹ &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">OPERATINSGYSTEM&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;æ“ä½œç³»ç»Ÿ&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DATABASE&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;æ•°æ®åº“&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä»£è¡¨å•†å“çš„ä¸Šçº¿æˆ–è€…ä¸‹çº¿çŠ¶æ€&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">OFFLINE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ONLINE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">STATUS_CHOICE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">OFFLINE&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;ä¸‹çº¿&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ONLINE&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;ä¸Šçº¿&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æˆ‘ä»¬å¼€å§‹å†™models.py&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.db&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">models&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">db.base_model&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">BaseModel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">tinymce.models&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">HTMLField&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">books.enums&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">BOOKS_TYPE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">STATUS_CHOICE&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">PYTHON&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">ONLINE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Create your models here.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">BookManager&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Manager&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;å•†å“æ¨¡å‹ç®¡ç†å™¨ç±»&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># type_id è¡¨ç¤ºå‰æ®µä¼ è¾“å•†å“idè¿›è¡ŒæŸ¥æ‰¾å•†å“. limitè¡¨ç¤ºè¿”å›å‡ ä¸ªä¹‹å‰çš„å•†å“çš„æ•°æ®, sortä»£è¡¨æ’åºçŠ¶æ€ï¼Œåˆå§‹å€¼é»˜è®¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">type_id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">limit&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;default&amp;#39;&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;æ ¹æ®å•†å“ç±»å‹idæŸ¥è¯¢å•†å“ä¿¡æ¯&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å¦‚æœæ˜¯æ–°å•†å“å°±æ ¹æ®ä»–çš„æ·»åŠ æ—¶é—´è¿›è¡Œæ’åº-ä»£è¡¨ä»å¤§åˆ°å°è¿›è¡Œæ’åº&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">sort&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">order_by&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;-create_time&amp;#39;&lt;/span>&lt;span class="p">,)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æ ¹æ®é”€é‡æœ€å¤šè¿›è¡Œæ’åº&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="n">sort&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;hot&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">order_by&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;-sales&amp;#39;&lt;/span>&lt;span class="p">,)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æ ¹æ®ä»·æ ¼è¿›è¡Œæ’åº&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="n">sort&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;price&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">order_by&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;price&amp;#39;&lt;/span>&lt;span class="p">,)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># pkå›½å¤–ä»£è¡¨ä¸€ç§ä¸»é”®çš„ç®€å†™ï¼Œåˆ«çš„åå­—ä¹Ÿè¡Œè¿™æ˜¯æ•´ä¸ªè¡¨çš„ä¸»é”®ï¼Œè¿™é‡Œä»£è¡¨çš„æ„æ€å°±æ˜¯é»˜è®¤æŒ‰ç…§ä¸»é”®primary_keyä»å¤§åˆ°å°é»˜è®¤è¿›è¡Œæ’åº&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">order_by&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;-pk&amp;#39;&lt;/span>&lt;span class="p">,)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æŸ¥è¯¢æ•°æ® filteræ˜¯è¿‡æ»¤æ•°æ®ï¼Œorder_byæ˜¯æ’åºï¼Œ(*order_by)æ˜¯å¯¹ä¸Šé¢çš„order_byè¿›è¡Œè§£åŒ…æˆåˆ—è¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å¯¹è§£åŒ…çš„æ•°æ®è¿›è¡Œè¿‡æ»¤æ’åºå¹¶è¿”å›ä¸€ä¸ªæ–°çš„åˆ—è¡¨books_li&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">books_li&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">filter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type_id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">type_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">order_by&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">order_by&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æŸ¥è¯¢ç»“æœé›†çš„é™åˆ¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">limit&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">books_li&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">books_li&lt;/span>&lt;span class="p">[:&lt;/span>&lt;span class="n">limit&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">books_li&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">get_books_by_id&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">books_id&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;æ ¹æ®å•†å“idè·å–å•†å“ä¿¡æ¯&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">books&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">books_id&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DoesNotExist&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å•†å“ä¸å­˜åœ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">books&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">None&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">books&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Books&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BaseModel&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;å•†å“æ¨¡å‹ç±»&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ä½¿ç”¨è¿­ä»£å™¨è¿›è¡Œæ•°æ®èµ‹å€¼ å› ä¸ºbooks_typeæ˜¯å­—å…¸æ‰€ä»¥è¦å–items&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">books_type_choices&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">BOOKS_TYPE&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status_choices&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">STATUS_CHOICE&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å®šä¹‰ä¹¦ç±çš„idä¸ä¹¦ç±çš„çŠ¶æ€&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type_id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SmallIntegerField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">PYTHON&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">choices&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">books_type_choices&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“ç§ç±»&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CharField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_length&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“åç§°&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">desc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CharField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_length&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“ç®€ä»‹&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># decimal_placesä»£è¡¨å°æ•°åä¸¤ä½&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">price&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DecimalField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_digits&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">decimal_places&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“ä»·æ ¼&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">unit&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CharField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_length&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“å•ä½&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">IntegerField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“åº“å­˜&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sales&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">IntegerField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“é”€é‡&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">detail&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">HTMLField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“è¯¦æƒ…&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># upload_toæ‰€ä»¥å¯ä»¥ç”¨uoload_toæ¥æŒ‡å®šæ–‡ä»¶å­˜æ”¾çš„å‰ç¼€è·¯å¾„&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å®é™…çš„è·¯å¾„å°±æ˜¯ MEDIA_ROOT/books/filename&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">image&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ImageField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">upload_to&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;books&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“å›¾ç‰‡&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SmallIntegerField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="n">ONLINE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">choices&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">status_choices&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“çŠ¶æ€&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__str__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">object&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">BookManager&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">class&lt;/span> &lt;span class="nc">Meta&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#åˆ¶å®šæ•°æ®åº“åç§°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">db_table&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;s_books&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>å°†ç”¨æˆ·æ¨¡å—æ³¨å†Œåˆ°admin&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.contrib&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">admin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">books.models&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Books&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Register your models here.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">admin&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">site&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">register&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Books&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>åˆ›å»ºç”¨æˆ·ä¸»é¡µè§†å›¾viewsä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.shortcuts&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">redirect&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">books.models&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Books&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">books.enums&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.core.urlresolvers&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">reverse&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.core.paginator&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Paginator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Create your views here.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">index&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;æ˜¾ç¤ºé¦–é¡µ&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">python_new&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">PYTHON&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">python_hot&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">PYTHON&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;hot&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">javascript_new&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JAVASCRIPT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">javascript_hot&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JAVASCRIPT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;hot&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">algorithms_new&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ALGORITHMS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">algorithms_hot&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ALGORITHMS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">machinelearning_new&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">MACHINELEARNING&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">machinelearning_hot&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">MACHINELEARNING&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;hot&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">operatingsystem_new&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">OPERATINSGYSTEM&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">operatingsystem_hot&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">OPERATINSGYSTEM&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;hot&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">database_new&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">DATABASE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">database_hot&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">DATABASE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;hot&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å®šä¹‰æ¨¡æ¿ä¸Šä¸‹æ–‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">content&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;python_new&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">python_new&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;python_hot&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">python_hot&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;javascript_new&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">javascript_new&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;javascript_hot&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">javascript_hot&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;algorithms_new&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">algorithms_new&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;algorithms_hot&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">algorithms_hot&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;machinelearning_new&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">machinelearning_new&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;machinelearning_hot&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">machinelearning_hot&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;operatingsystem_new&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">operatingsystem_new&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;operatingsystem_hot&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">operatingsystem_hot&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;database_new&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">database_new&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;database_hot&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">database_hot&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;index.html&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">content&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>åˆ›å»ºå•†å“è¯¦æƒ…é¡µ&lt;/li>
&lt;li>é¦–å…ˆåˆ›å»ºurl&lt;code>url(r'^(?P&amp;lt;books_id&amp;gt;\d+)/$',deatil,name='deatil')&lt;/code>&lt;/li>
&lt;li>åˆ›å»ºè§†å›¾&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">deatil&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">books_id&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;æ˜¾ç¤ºå•†å“çš„è¯¦ç»†ä¿¡æ¯&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">books&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_id&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">books_id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">books_id&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">books&lt;/span> &lt;span class="ow">is&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">redirect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">reverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;index&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æ–°å“æ¨è&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">books_li&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type_id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">type_id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">limit&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å®šä¹‰è¿”å›æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">content&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;books&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">books&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;books_li&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">books_li&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;detail.html&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">content&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>è®¾ç½®å‰ç«¯æ˜¾ç¤ºæ¨¡æ¿è¯­è¨€&lt;/li>
&lt;/ul></description></item><item><title>é¡µé¢å¼€å‘</title><link>https://sunnnner.github.io/p/%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91/</link><pubDate>Thu, 31 May 2018 18:47:29 +0800</pubDate><guid>https://sunnnner.github.io/p/%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91/</guid><description>&lt;ul>
&lt;li>é¦–å…ˆæ–°å»ºappâ€”&amp;gt;bookså¹¶æ·»åŠ settingsé‡Œé¢&lt;/li>
&lt;li>å› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨åå°adminä¸Šä¼ æ•°æ®æ‰€ä»¥æˆ‘ä»¬è¦åˆ›å»ºå¯Œæ–‡æœ¬ç®¡ç†å™¨å¹¶åœ¨settingè®¾ç½®ä»–çš„é€‰é¡¹&lt;/li>
&lt;li>å¯Œæ–‡æœ¬ç®¡ç†å™¨æ˜¯ä¸€ä¸ªæ’ä»¶æˆ‘ä»¬è¿™æ¬¡ä½¿ç”¨çš„æ˜¯tinymceå¹¶ä¸”æˆ‘ä»¬éœ€è¦å°†å®ƒåŠ å…¥åˆ°appsé‡Œé¢å› ä¸ºä»–æ˜¯ä¸€ä¸ªåº”ç”¨ï¼Œä½†æ˜¯è¿™ä¸ªåº”ç”¨æ˜¯éœ€è¦ä¸‹è½½çš„&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">TINTMCE_DEFAULT_CONFIG&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;theme&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;modern&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;wight&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">600&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;height&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">400&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>æˆ‘ä»¬éœ€è¦è®¾ç½®åˆ¶å®šä¸€ä¸ªåª’ä½“æ–‡ä»¶å¤¹æ¥å­˜æ”¾æˆ‘ä»¬çš„å›¾ç‰‡&lt;code>MEDIA_ROOT = os.path.join(BASE_DIR, 'static')&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ·»åŠ åº”ç”¨çš„urls``&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^books/&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">include&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;books.urls&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">namespace&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;books&amp;#39;&lt;/span>&lt;span class="p">)),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">url&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^tinymce/&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">include&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;tinymce.urls&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">namespace&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;tinymce&amp;#39;&lt;/span>&lt;span class="p">)),&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æˆ‘ä»¬å¼€å§‹å†™booksé‡Œé¢çš„å­—æ®µé¦–å…ˆæŸ¥çœ‹é¡µé¢æˆ‘ä»¬éœ€è¦ä»€ä¹ˆå­—æ®µ&lt;/li>
&lt;li>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºtinymacå¯Œæ–‡æœ¬éœ€è¦çš„å­—æ®µï¼Œè¿™é‡Œçš„å­—æ®µæ˜ å°„å…¨å±€&lt;/li>
&lt;li>åœ¨booksç›®å½•ä¸‹åˆ›å»ºä»»æ„çš„.pyæ–‡ä»¶è¿™é‡Œæˆ‘çš„æ˜¯emums.py&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># æ­¤å¤„1ï¼Œ2ï¼Œ3ï¼Œ4ä»£è¡¨ä¹¦æœ¬çš„id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">PYTHON&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">JAVASCRIPT&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ALGORITHMS&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">MACHINELEARNING&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">OPERATINSGYSTEM&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">DATABASE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># BOOKS_TYPEä½œä¸ºä¸€ä¸ªå­—å…¸ä¼ è¾“åˆ°models&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">BOOKS_TYPE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">PYTHON&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;python&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">JAVASCRIPT&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;javascript&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ALGORITHMS&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;æ•°æ®åº“ç»“æ„ä¸ç®—æ³•&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MACHINELEARNING&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;æœºå™¨å­¦ä¹ &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">OPERATINSGYSTEM&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;æ“ä½œç³»ç»Ÿ&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">DATABASE&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;æ•°æ®åº“&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä»£è¡¨å•†å“çš„ä¸Šçº¿æˆ–è€…ä¸‹çº¿çŠ¶æ€&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">OFFLINE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ONLINE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">STATUS_CHOICE&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">OFFLINE&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;ä¸‹çº¿&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ONLINE&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;ä¸Šçº¿&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>æˆ‘ä»¬å¼€å§‹å†™models.py&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.db&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">models&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">db.base_model&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">BaseModel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">tinymce.models&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">HTMLField&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">books.enums&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">BOOKS_TYPE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">STATUS_CHOICE&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">PYTHON&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">ONLINE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Create your models here.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">BookManager&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Manager&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;å•†å“æ¨¡å‹ç®¡ç†å™¨ç±»&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># type_id è¡¨ç¤ºå‰æ®µä¼ è¾“å•†å“idè¿›è¡ŒæŸ¥æ‰¾å•†å“. limitè¡¨ç¤ºè¿”å›å‡ ä¸ªä¹‹å‰çš„å•†å“çš„æ•°æ®, sortä»£è¡¨æ’åºçŠ¶æ€ï¼Œåˆå§‹å€¼é»˜è®¤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">type_id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">limit&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;default&amp;#39;&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;æ ¹æ®å•†å“ç±»å‹idæŸ¥è¯¢å•†å“ä¿¡æ¯&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å¦‚æœæ˜¯æ–°å•†å“å°±æ ¹æ®ä»–çš„æ·»åŠ æ—¶é—´è¿›è¡Œæ’åº-ä»£è¡¨ä»å¤§åˆ°å°è¿›è¡Œæ’åº&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">sort&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">order_by&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;-create_time&amp;#39;&lt;/span>&lt;span class="p">,)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æ ¹æ®é”€é‡æœ€å¤šè¿›è¡Œæ’åº&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="n">sort&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;hot&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">order_by&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;-sales&amp;#39;&lt;/span>&lt;span class="p">,)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æ ¹æ®ä»·æ ¼è¿›è¡Œæ’åº&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="n">sort&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;price&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">order_by&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;price&amp;#39;&lt;/span>&lt;span class="p">,)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># pkå›½å¤–ä»£è¡¨ä¸€ç§ä¸»é”®çš„ç®€å†™ï¼Œåˆ«çš„åå­—ä¹Ÿè¡Œè¿™æ˜¯æ•´ä¸ªè¡¨çš„ä¸»é”®ï¼Œè¿™é‡Œä»£è¡¨çš„æ„æ€å°±æ˜¯é»˜è®¤æŒ‰ç…§ä¸»é”®primary_keyä»å¤§åˆ°å°é»˜è®¤è¿›è¡Œæ’åº&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">order_by&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;-pk&amp;#39;&lt;/span>&lt;span class="p">,)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æŸ¥è¯¢æ•°æ® filteræ˜¯è¿‡æ»¤æ•°æ®ï¼Œorder_byæ˜¯æ’åºï¼Œ(*order_by)æ˜¯å¯¹ä¸Šé¢çš„order_byè¿›è¡Œè§£åŒ…æˆåˆ—è¡¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å¯¹è§£åŒ…çš„æ•°æ®è¿›è¡Œè¿‡æ»¤æ’åºå¹¶è¿”å›ä¸€ä¸ªæ–°çš„åˆ—è¡¨books_li&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">books_li&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">filter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type_id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">type_id&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">order_by&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">order_by&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æŸ¥è¯¢ç»“æœé›†çš„é™åˆ¶&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">limit&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">books_li&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">books_li&lt;/span>&lt;span class="p">[:&lt;/span>&lt;span class="n">limit&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">books_li&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">get_books_by_id&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">books_id&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;æ ¹æ®å•†å“idè·å–å•†å“ä¿¡æ¯&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">books&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">books_id&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DoesNotExist&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å•†å“ä¸å­˜åœ¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">books&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">None&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">books&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">Books&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BaseModel&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;å•†å“æ¨¡å‹ç±»&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ä½¿ç”¨è¿­ä»£å™¨è¿›è¡Œæ•°æ®èµ‹å€¼ å› ä¸ºbooks_typeæ˜¯å­—å…¸æ‰€ä»¥è¦å–items&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">books_type_choices&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">BOOKS_TYPE&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status_choices&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">((&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">STATUS_CHOICE&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å®šä¹‰ä¹¦ç±çš„idä¸ä¹¦ç±çš„çŠ¶æ€&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type_id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SmallIntegerField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">PYTHON&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">choices&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">books_type_choices&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“ç§ç±»&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CharField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_length&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“åç§°&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">desc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CharField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_length&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">128&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“ç®€ä»‹&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># decimal_placesä»£è¡¨å°æ•°åä¸¤ä½&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">price&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DecimalField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_digits&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">decimal_places&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“ä»·æ ¼&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">unit&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CharField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_length&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“å•ä½&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">stock&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">IntegerField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“åº“å­˜&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sales&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">IntegerField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“é”€é‡&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">detail&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">HTMLField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“è¯¦æƒ…&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># upload_toæ‰€ä»¥å¯ä»¥ç”¨uoload_toæ¥æŒ‡å®šæ–‡ä»¶å­˜æ”¾çš„å‰ç¼€è·¯å¾„&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å®é™…çš„è·¯å¾„å°±æ˜¯ MEDIA_ROOT/books/filename&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">image&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ImageField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">upload_to&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;books&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“å›¾ç‰‡&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">models&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SmallIntegerField&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">default&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="n">ONLINE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">choices&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">status_choices&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">verbose_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;å•†å“çŠ¶æ€&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__str__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">object&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">BookManager&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">class&lt;/span> &lt;span class="nc">Meta&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#åˆ¶å®šæ•°æ®åº“åç§°&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">db_table&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;s_books&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>å°†ç”¨æˆ·æ¨¡å—æ³¨å†Œåˆ°admin&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.contrib&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">admin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">books.models&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Books&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Register your models here.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">admin&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">site&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">register&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Books&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>åˆ›å»ºç”¨æˆ·ä¸»é¡µè§†å›¾viewsä¿¡æ¯&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.shortcuts&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">redirect&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">books.models&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Books&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">books.enums&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.core.urlresolvers&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">reverse&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">django.core.paginator&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Paginator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Create your views here.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">index&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;æ˜¾ç¤ºé¦–é¡µ&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">python_new&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">PYTHON&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">python_hot&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">PYTHON&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;hot&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">javascript_new&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JAVASCRIPT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">javascript_hot&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">JAVASCRIPT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;hot&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">algorithms_new&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ALGORITHMS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">algorithms_hot&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ALGORITHMS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">machinelearning_new&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">MACHINELEARNING&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">machinelearning_hot&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">MACHINELEARNING&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;hot&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">operatingsystem_new&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">OPERATINSGYSTEM&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">operatingsystem_hot&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">OPERATINSGYSTEM&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;hot&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">database_new&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">DATABASE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">database_hot&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">DATABASE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;hot&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å®šä¹‰æ¨¡æ¿ä¸Šä¸‹æ–‡&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">content&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;python_new&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">python_new&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;python_hot&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">python_hot&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;javascript_new&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">javascript_new&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;javascript_hot&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">javascript_hot&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;algorithms_new&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">algorithms_new&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;algorithms_hot&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">algorithms_hot&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;machinelearning_new&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">machinelearning_new&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;machinelearning_hot&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">machinelearning_hot&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;operatingsystem_new&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">operatingsystem_new&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;operatingsystem_hot&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">operatingsystem_hot&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;database_new&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">database_new&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;database_hot&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">database_hot&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;index.html&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">content&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>åˆ›å»ºå•†å“è¯¦æƒ…é¡µ&lt;/li>
&lt;li>é¦–å…ˆåˆ›å»ºurl&lt;code>url(r'^(?P&amp;lt;books_id&amp;gt;\d+)/$',deatil,name='deatil')&lt;/code>&lt;/li>
&lt;li>åˆ›å»ºè§†å›¾&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">deatil&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">books_id&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;æ˜¾ç¤ºå•†å“çš„è¯¦ç»†ä¿¡æ¯&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">books&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_id&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">books_id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">books_id&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">books&lt;/span> &lt;span class="ow">is&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">redirect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">reverse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;index&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># æ–°å“æ¨è&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">books_li&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_books_by_type&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">type_id&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">books&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">type_id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">limit&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sort&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># å®šä¹‰è¿”å›æ•°æ®&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">content&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;books&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">books&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;books_li&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">books_li&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">render&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;detail.html&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">content&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>è®¾ç½®å‰ç«¯æ˜¾ç¤ºæ¨¡æ¿è¯­è¨€&lt;/li>
&lt;/ul></description></item></channel></rss>